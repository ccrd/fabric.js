var fabric=fabric||{version:"1.4.9"};"undefined"!==typeof exports&&(exports.fabric=fabric);"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow());fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;
fabric.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");fabric.DPI=96;
var Cufon=function(){function e(b){var f=this.face=b.face;this.glyphs=b.glyphs;this.w=b.w;this.baseSize=parseInt(f["units-per-em"],10);this.family=f["font-family"].toLowerCase();this.weight=f["font-weight"];this.style=f["font-style"]||"normal";this.viewBox=function(){var b=f.bbox.split(/\s+/),b={minX:parseInt(b[0],10),minY:parseInt(b[1],10),maxX:parseInt(b[2],10),maxY:parseInt(b[3],10)};b.width=b.maxX-b.minX;b.height=b.maxY-b.minY;b.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};
return b}();this.ascent=-parseInt(f.ascent,10);this.descent=-parseInt(f.descent,10);this.height=-this.ascent+this.descent}function a(){var b={},f={oblique:"italic",italic:"oblique"};this.add=function(f){(b[f.style]||(b[f.style]={}))[f.weight]=f};this.get=function(a,c){var d=b[a]||b[f[a]]||b.normal||b.italic||b.oblique;if(!d)return null;c={normal:400,bold:700}[c]||parseInt(c,10);if(d[c])return d[c];var g={1:1,99:0}[c%100],h=[],l,e;void 0===g&&(g=400<c);500==c&&(c=400);for(var k in d){k=parseInt(k,
10);if(!l||k<l)l=k;if(!e||k>e)e=k;h.push(k)}c<l&&(c=l);c>e&&(c=e);h.sort(function(b,f){return(g?b>c&&f>c?b<f:b>f:b<c&&f<c?b>f:b<f)?-1:1});return d[h[0]]}}function d(b){var f={},a={};this.get=function(a){return void 0!=f[a]?f[a]:b[a]};this.getSize=function(b,f){return a[b]||(a[b]=new n.Size(this.get(b),f))};this.extend=function(b){for(var a in b)f[a]=b[a];return this}}function c(b,f,a){b.addEventListener?b.addEventListener(f,a,!1):b.attachEvent&&b.attachEvent("on"+f,function(){return a.call(b,fabric.window.event)})}
function b(b){var f={};return function(a){f.hasOwnProperty(a)||(f[a]=b.apply(null,arguments));return f[a]}}function g(b){return fabric.document.getElementsByTagName(b)}function f(){for(var b={},f,a=0,c=arguments.length;a<c;++a)for(f in arguments[a])b[f]=arguments[a][f];return b}function h(b,f,a,c,d,g){var h=c.separate;if("none"==h)return s[c.engine].apply(null,arguments);var l=fabric.document.createDocumentFragment(),e=f.split(y[h]),k="words"==h;k&&p&&(/^\s/.test(f)&&e.unshift(""),/\s$/.test(f)&&
e.push(""));for(var q=0,m=e.length;q<m;++q)(h=s[c.engine](b,k?n.textAlign(e[q],a,q,m):e[q],a,c,d,g,q<m-1))&&l.appendChild(h);return l}function l(b,f){var a,c,d,g;d=q.get(b);d.options||(f.hover&&f.hoverables[b.nodeName.toLowerCase()]&&t.attach(b),d.options=f);for(var l=b.firstChild;l;l=d){d=l.nextSibling;g=!1;if(1==l.nodeType){if(!l.firstChild)continue;if(/cufon/.test(l.className))g=!0;else{arguments.callee(l,f);continue}}c||(c=n.getStyle(b).extend(f));if(!a)a:{(a=c)||(a=n.getStyle(b));for(var e=n.quotedList(a.get("fontFamily").toLowerCase()),
k=void 0,m=0,p=e.length;m<p;++m)if(k=e[m],r[k]){a=r[k].get(a.get("fontStyle"),a.get("fontWeight"));break a}a=null}if(a)if(g)s[f.engine](a,null,c,f,l,b);else g=l.data,"undefined"!=typeof G_vmlCanvasManager&&(g=g.replace(/\r/g,"\n")),""!==g&&((g=h(a,g,c,f,l,b))?l.parentNode.replaceChild(g,l):l.parentNode.removeChild(l))}}var k=function(){return k.replace.apply(null,arguments)},m=k.DOM={ready:function(){var b=!1,f={loaded:1,complete:1},a=[],d=function(){if(!b){b=!0;for(var f;f=a.shift();f());}};fabric.document.addEventListener&&
(fabric.document.addEventListener("DOMContentLoaded",d,!1),fabric.window.addEventListener("pageshow",d,!1));!fabric.window.opera&&fabric.document.readyState&&function(){f[fabric.document.readyState]?d():setTimeout(arguments.callee,10)}();fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left"),d()}catch(b){setTimeout(arguments.callee,1)}}();c(fabric.window,"load",d);return function(f){arguments.length?b?f():a.push(f):d()}}()},n=k.CSS={Size:function(b,
f){this.value=parseFloat(b);this.unit=String(b).match(/[a-z%]*$/)[0]||"px";this.convert=function(b){return b/f*this.value};this.convertFrom=function(b){return b/this.value*f};this.toString=function(){return this.value+this.unit}},getStyle:function(b){return new d(b.style)},quotedList:b(function(b){for(var f=[],a=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,c;c=a.exec(b);)f.push(c[3]||c[1]);return f}),ready:function(){var b=!1,f=[],a=Object.prototype.propertyIsEnumerable?g("style"):{length:0},c=g("link");
m.ready(function(){for(var d=0,g,h=0,l=c.length;g=c[h],h<l;++h)g.disabled||"stylesheet"!=g.rel.toLowerCase()||++d;if(fabric.document.styleSheets.length>=a.length+d)for(b=!0;d=f.shift();d());else setTimeout(arguments.callee,10)});return function(a){b?a():f.push(a)}}(),supports:function(b,f){var a=fabric.document.createElement("span").style;if(void 0===a[b])return!1;a[b]=f;return a[b]===f},textAlign:function(b,f,a,c){"right"==f.get("textAlign")?0<a&&(b=" "+b):a<c-1&&(b+=" ");return b},textDecoration:function(b,
f){f||(f=this.getStyle(b));for(var a={underline:null,overline:null,"line-through":null},c=b;c.parentNode&&1==c.parentNode.nodeType;){var d=!0,g;for(g in a)a[g]||(-1!=f.get("textDecoration").indexOf(g)&&(a[g]=f.get("color")),d=!1);if(d)break;f=this.getStyle(c=c.parentNode)}return a},textShadow:b(function(b){if("none"==b)return null;for(var f=[],a={},c,d=0,g=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;c=g.exec(b);)","==c[0]?(f.push(a),a={},d=0):c[1]?a.color=c[1]:a[["offX","offY","blur"][d++]]=
c[2];f.push(a);return f}),color:b(function(b){var f={};f.color=b.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(b,a,c){f.opacity=parseFloat(c);return"rgb("+a+")"});return f}),textTransform:function(b,f){return b[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[f.get("textTransform")]||"toString"]()}},p=0==" ".split(/\s+/).length,q=new function(){var b={},f=0;this.get=function(a){a=a.cufid||(a.cufid=++f);return b[a]||(b[a]={})}},t=new function(){function b(f){f=f.relatedTarget;var c;(c=!f)||(c=this.contains?
this.contains(f):this.compareDocumentPosition(f)&16);c||a(this)}function f(b){a(this)}function a(b){setTimeout(function(){k.replace(b,q.get(b).options,!0)},10)}this.attach=function(a){void 0===a.onmouseenter?(c(a,"mouseover",b),c(a,"mouseout",b)):(c(a,"mouseenter",f),c(a,"mouseleave",f))}},x=[],s={},r={},C={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(b){return jQuery(b)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(b){return $$(b)}||
fabric.window.$&&function(b){return $(b)}||fabric.document.querySelectorAll&&function(b){return fabric.document.querySelectorAll(b)}||g,separate:"words",textShadow:"none"},y={words:/\s+/,characters:""};k.now=function(){m.ready();return k};k.refresh=function(){for(var b=x.splice(0,x.length),f=0,a=b.length;f<a;++f)k.replace.apply(null,b[f]);return k};k.registerEngine=function(b,f){if(!f)return k;s[b]=f;return k.set("engine",b)};k.registerFont=function(b){b=new e(b);var f=b.family;r[f]||(r[f]=new a);
r[f].add(b);return k.set("fontFamily",'"'+f+'"')};k.replace=function(b,a,c){a=f(C,a);if(!a.engine)return k;"string"==typeof a.textShadow&&a.textShadow&&(a.textShadow=n.textShadow(a.textShadow));c||x.push(arguments);if(b.nodeType||"string"==typeof b)b=[b];n.ready(function(){for(var f=0,c=b.length;f<c;++f){var d=b[f];"string"==typeof d?k.replace(a.selector(d),a,!0):l(d,a)}});return k};k.replaceElement=function(b,a){a=f(C,a);"string"==typeof a.textShadow&&a.textShadow&&(a.textShadow=n.textShadow(a.textShadow));
return l(b,a)};k.engines=s;k.fonts=r;k.getOptions=function(){return f(C)};k.set=function(b,f){C[b]=f;return k};return k}();
Cufon.registerEngine("canvas",function(){var e=Cufon.CSS.supports("display","inline-block"),a=!e&&("BackCompat"==fabric.document.compatMode||/frameset|transitional/i.test(fabric.document.doctype.publicId)),d=fabric.document.createElement("style");d.type="text/css";a=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(a?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+
(e?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{d.appendChild(a)}catch(c){d.setAttribute("type","text/css"),d.styleSheet.cssText=a.data}fabric.document.getElementsByTagName("head")[0].appendChild(d);return function(b,a,f,c,d,k){function m(a){z.fillStyle=a||Cufon.textOptions.color||f.get("color");var d=a=0;"right"===c.textAlign?
z.translate(G[d],0):"center"===c.textAlign&&z.translate(G[d]/2,0);for(var g=0,l=D.length;g<l;++g)if("\n"===D[g]){d++;var e=-b.ascent-b.ascent/5*c.lineHeight;"right"===c.textAlign?(z.translate(-B,e),z.translate(G[d],0)):"center"===c.textAlign?(z.translate(-a-G[d-1]/2,e),z.translate(G[d]/2,0)):z.translate(-a,e);a=0}else{var k=b.glyphs[D[g]]||b.missingGlyph;if(k){e=Number(k.w||b.w)+t;I&&(z.save(),z.strokeStyle=z.fillStyle,z.lineWidth+=z.lineWidth,z.beginPath(),I.underline&&(z.moveTo(0,-b.face["underline-position"]+
0.5),z.lineTo(e,-b.face["underline-position"]+0.5)),I.overline&&(z.moveTo(0,b.ascent+0.5),z.lineTo(e,b.ascent+0.5)),I["line-through"]&&(z.moveTo(0,-b.descent+0.5),z.lineTo(e,-b.descent+0.5)),z.stroke(),z.restore());J&&(z.save(),z.transform(1,0,-0.25,1,0,0));z.beginPath();if(k.d)if(k.code)for(var q=k.code,k=z,n=0,m=q.length;n<m;++n){var p=q[n];k[p.m].apply(k,p.a)}else{var q=k,k="m"+k.d,n=z,p=m=0,r=[],x=/([mrvxe])([^a-z]*)/g,s=void 0,A=0;a:for(;s=x.exec(k);++A){var w=s[2].split(",");switch(s[1]){case "v":r[A]=
{m:"bezierCurveTo",a:[m+~~w[0],p+~~w[1],m+~~w[2],p+~~w[3],m+=~~w[4],p+=~~w[5]]};break;case "r":r[A]={m:"lineTo",a:[m+=~~w[0],p+=~~w[1]]};break;case "m":r[A]={m:"moveTo",a:[m=~~w[0],p=~~w[1]]};break;case "x":r[A]={m:"closePath",a:[]};break;case "e":break a}n[r[A].m].apply(n,r[A].a)}q.code=r}z.fill();c.strokeStyle&&(z.closePath(),z.save(),z.lineWidth=c.strokeWidth,z.strokeStyle=c.strokeStyle,z.stroke(),z.restore());J&&z.restore();z.translate(e,0);a+=e}}}var n=null===a,p=b.viewBox,q=f.getSize("fontSize",
b.baseSize),t=f.get("letterSpacing"),t="normal"==t?0:q.convertFrom(parseInt(t,10)),x=k=0,s=0,r=c.textShadow,C=[];Cufon.textOptions.shadowOffsets=[];Cufon.textOptions.shadows=null;if(r){Cufon.textOptions.shadows=r;for(var y=0,v=r.length;y<v;++y){var u=r[y],A=q.convertFrom(parseFloat(u.offX)),u=q.convertFrom(parseFloat(u.offY));C[y]=[A,u]}}for(var D=Cufon.CSS.textTransform(n?d.alt:a,f).split(""),B=0,u=null,A=0,w=1,E=[],y=0,v=D.length;y<v;++y)if("\n"===D[y])w++,B>A&&(A=B),E.push(B),B=0;else{var H=b.glyphs[D[y]]||
b.missingGlyph;H&&(B+=u=Number(H.w||b.w)+t)}E.push(B);for(var B=Math.max(A,B),G=[],y=E.length;y--;)G[y]=B-E[y];if(null===u)return null;x+=p.width-u;s+=p.minX;n?(n=d,d=d.firstChild):(n=fabric.document.createElement("span"),n.className="cufon cufon-canvas",n.alt=a,d=fabric.document.createElement("canvas"),n.appendChild(d),c.printable&&(y=fabric.document.createElement("span"),y.className="cufon-alt",y.appendChild(fabric.document.createTextNode(a)),n.appendChild(y)));a=n.style;v=d.style||{};u=q.convert(p.height-
k+0);y=Math.ceil(u);u=y/u;d.width=Math.ceil(q.convert(B+x-s)*u);d.height=y;k+=p.minY;v.top=Math.round(q.convert(k-b.ascent))+"px";v.left=Math.round(q.convert(s))+"px";x=Math.ceil(q.convert(B*u));v=x+"px";u=q.convert(b.height);q=(c.lineHeight-1)*q.convert(-b.ascent/5)*(w-1);Cufon.textOptions.width=x;Cufon.textOptions.height=u*w+q;Cufon.textOptions.lines=w;Cufon.textOptions.totalLineHeight=q;e?(a.width=v,a.height=u+"px"):(a.paddingLeft=v,a.paddingBottom=u-1+"px");var z=Cufon.textOptions.context||d.getContext("2d"),
F=y/p.height;Cufon.textOptions.fontAscent=b.ascent*F;Cufon.textOptions.boundaries=null;p=Cufon.textOptions.shadowOffsets;for(y=C.length;y--;)p[y]=[C[y][0]*F,C[y][1]*F];z.save();z.scale(F,F);z.translate(-s-1/F*d.width/2+(Cufon.fonts[b.family].offsetLeft||0),-k-Cufon.textOptions.height/F/2+(Cufon.fonts[b.family].offsetTop||0));z.lineWidth=b.face["underline-thickness"];z.save();var I=Cufon.getTextDecoration(c),J="italic"===c.fontStyle;z.save();(function(){z.save();var f=0,a=0,d=[{left:0}];c.backgroundColor&&
(z.save(),z.fillStyle=c.backgroundColor,z.translate(0,b.ascent),z.fillRect(0,0,B+10,(-b.ascent+b.descent)*w),z.restore());"right"===c.textAlign?(z.translate(G[a],0),d[0].left=G[a]*F):"center"===c.textAlign&&(z.translate(G[a]/2,0),d[0].left=G[a]/2*F);for(var g=0,l=D.length;g<l;++g)if("\n"===D[g]){a++;var e=-b.ascent-b.ascent/5*c.lineHeight,k=d[d.length-1],q={left:0};k.width=f*F;k.height=(-b.ascent+b.descent)*F;"right"===c.textAlign?(z.translate(-B,e),z.translate(G[a],0),q.left=G[a]*F):"center"===c.textAlign?
(z.translate(-f-G[a-1]/2,e),z.translate(G[a]/2,0),q.left=G[a]/2*F):z.translate(-f,e);d.push(q);f=0}else if(e=b.glyphs[D[g]]||b.missingGlyph)e=Number(e.w||b.w)+t,c.textBackgroundColor&&(z.save(),z.fillStyle=c.textBackgroundColor,z.translate(0,b.ascent),z.fillRect(0,0,e+10,-b.ascent+b.descent),z.restore()),z.translate(e,0),f+=e,g==l-1&&(d[d.length-1].width=f*F,d[d.length-1].height=(-b.ascent+b.descent)*F);z.restore();Cufon.textOptions.boundaries=d})();if(r)for(y=0,v=r.length;y<v;++y)u=r[y],z.save(),
z.translate.apply(z,C[y]),m(u.color),z.restore();m();z.restore();z.restore();z.restore();return n}}());
Cufon.registerEngine("vml",function(){function e(a,c){if(/px$/i.test(c))return parseFloat(c);var b=a.style.left,g=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=c;var f=a.style.pixelLeft;a.style.left=b;a.runtimeStyle.left=g;return f}if(fabric.document.namespaces){var a=fabric.document.createElement("canvas");if(!(a&&a.getContext&&a.getContext.apply)&&(null==fabric.document.namespaces.cvml&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml"),a=fabric.document.createElement("cvml:shape"),
a.style.behavior="url(#default#VML)",a.coordsize))return a=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>'),
function(a,c,b,g,f,h,l){var k=null===c;k&&(c=f.alt);var m=a.viewBox,n;if(!(n=b.computedFontSize)){n=Cufon.CSS.Size;var p;p=b.get("fontSize");p=e(h,/(?:em|ex|%)$/i.test(p)?"1em":p);n=b.computedFontSize=new n(p+"px",a.baseSize)}p=b.computedLSpacing;void 0==p&&(p=b.get("letterSpacing"),b.computedLSpacing=p="normal"==p?0:~~n.convertFrom(e(h,p)));if(k)h=f,f=f.firstChild;else{h=fabric.document.createElement("span");h.className="cufon cufon-vml";h.alt=c;f=fabric.document.createElement("span");f.className=
"cufon-vml-canvas";h.appendChild(f);if(g.printable){var q=fabric.document.createElement("span");q.className="cufon-alt";q.appendChild(fabric.document.createTextNode(c));h.appendChild(q)}l||h.appendChild(fabric.document.createElement("cvml:shape"))}l=h.style;var t=f.style,x=n.convert(m.height),q=Math.ceil(x),x=q/x,s=m.minX,r=m.minY;t.height=q;t.top=Math.round(n.convert(r-a.ascent));t.left=Math.round(n.convert(s));l.height=n.convert(a.height)+"px";Cufon.getTextDecoration(g);t=b.get("color");c=Cufon.CSS.textTransform(c,
b).split("");var C=b=0,y=null,v;g=g.textShadow;for(var u=0,A=0,D=c.length;u<D;++u)(v=a.glyphs[c[u]]||a.missingGlyph)&&(b+=y=~~(v.w||a.w)+p);if(null===y)return null;v=-s+b+(m.width-y);for(var u=n.convert(v*x),y=Math.round(u),B=v+","+m.height,w,E="r"+B+"nsnf",u=0;u<D;++u)if(v=a.glyphs[c[u]]||a.missingGlyph){k?(m=f.childNodes[A],m.firstChild&&m.removeChild(m.firstChild)):(m=fabric.document.createElement("cvml:shape"),f.appendChild(m));m.stroked="f";m.coordsize=B;m.coordorigin=w=s-C+","+r;m.path=(v.d?
"m"+v.d+"xe":"")+"m"+w+E;m.fillcolor=t;w=m.style;w.width=y;w.height=q;if(g){w=g[0];var H=g[1],G=Cufon.CSS.color(w.color),z,F=fabric.document.createElement("cvml:shadow");F.on="t";F.color=G.color;F.offset=w.offX+","+w.offY;H&&(z=Cufon.CSS.color(H.color),F.type="double",F.color2=z.color,F.offset2=H.offX+","+H.offY);F.opacity=G.opacity||z&&z.opacity||1;m.appendChild(F)}C+=~~(v.w||a.w)+p;++A}l.width=Math.max(Math.ceil(n.convert(b*x)),0);return h}}}());
Cufon.getTextDecoration=function(e){return{underline:"underline"===e.textDecoration,overline:"overline"===e.textDecoration,"line-through":"line-through"===e.textDecoration}};"undefined"!=typeof exports&&(exports.Cufon=Cufon);"object"!==typeof JSON&&(JSON={});
(function(){function e(b){return 10>b?"0"+b:b}function a(f){b.lastIndex=0;return b.test(f)?'"'+f.replace(b,function(b){var f=h[b];return"string"===typeof f?f:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+f+'"'}function d(b,c){var h,e,q,t,x=g,s,r=c[b];r&&"object"===typeof r&&"function"===typeof r.toJSON&&(r=r.toJSON(b));"function"===typeof l&&(r=l.call(c,b,r));switch(typeof r){case "string":return a(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);
case "object":if(!r)return"null";g+=f;s=[];if("[object Array]"===Object.prototype.toString.apply(r)){t=r.length;for(h=0;h<t;h+=1)s[h]=d(h,r)||"null";q=0===s.length?"[]":g?"[\n"+g+s.join(",\n"+g)+"\n"+x+"]":"["+s.join(",")+"]";g=x;return q}if(l&&"object"===typeof l)for(t=l.length,h=0;h<t;h+=1)"string"===typeof l[h]&&(e=l[h],(q=d(e,r))&&s.push(a(e)+(g?": ":":")+q));else for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(q=d(e,r))&&s.push(a(e)+(g?": ":":")+q);q=0===s.length?"{}":g?"{\n"+g+s.join(",\n"+
g)+"\n"+x+"}":"{"+s.join(",")+"}";g=x;return q}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var c,b,g,f,h,l;"function"!==typeof JSON.stringify&&(b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(b,a,c){var h;f=g="";if("number"===typeof c)for(h=0;h<c;h+=1)f+=" ";else"string"===typeof c&&(f=c);if((l=a)&&"function"!==typeof a&&("object"!==typeof a||"number"!==typeof a.length))throw Error("JSON.stringify");return d("",{"":b})});"function"!==typeof JSON.parse&&(c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(b,
f){function a(b,c){var d,g,h=b[c];if(h&&"object"===typeof h)for(d in h)Object.prototype.hasOwnProperty.call(h,d)&&(g=a(h,d),void 0!==g?h[d]=g:delete h[d]);return f.call(b,c,h)}var d;b=String(b);c.lastIndex=0;c.test(b)&&(b=b.replace(c,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=
eval("("+b+")"),"function"===typeof f?a({"":d},""):d;throw new SyntaxError("JSON.parse");})})();if("undefined"===typeof Event)var Event={};if("undefined"===typeof eventjs)var eventjs=Event;
(function(e){e.modifyEventListener=!1;e.modifySelectors=!1;e.add=function(b,f,a,c){return d(b,f,a,c,"add")};e.remove=function(b,f,a,c){return d(b,f,a,c,"remove")};e.stop=function(b){b&&(b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0,b.bubble=0)};e.prevent=function(b){b&&(b.preventDefault&&b.preventDefault(),b.preventManipulation&&b.preventManipulation(),b.returnValue=!1)};e.cancel=function(b){e.stop(b);e.prevent(b)};e.getEventSupport=function(b,f){"string"===typeof b&&(f=b,b=window);f="on"+
f;if(f in b)return!0;b.setAttribute||(b=document.createElement("div"));if(b.setAttribute&&b.removeAttribute){b.setAttribute(f,"");var a="function"===typeof b[f];"undefined"!==typeof b[f]&&(b[f]=null);b.removeAttribute(f);return a}};var a=function(b){if(!b||"object"!==typeof b)return b;var f=new b.constructor,c;for(c in b)f[c]=b[c]&&"object"===typeof b[c]?a(b[c]):b[c];return f},d=function(f,g,k,s,r,C){s=s||{};if("[object Object]"===String(f)){var y=f;f=y.target;g=y.type;k=y.listener;delete y.target;
delete y.type;delete y.listener;for(var v in y)s[v]=y[v]}if(f&&g&&k)if("string"===typeof f&&"ready"===g)var u=(new Date).getTime(),A=s.timeout,D=window.setInterval(function(){(new Date).getTime()-u>A&&window.clearInterval(D);document.querySelector(f)&&(window.clearInterval(D),setTimeout(k,1))},s.interval||1E3/60);else{if("string"===typeof f){f=document.querySelectorAll(f);if(0===f.length)return b("Missing target on listener!",arguments);1===f.length&&(f=f[0])}var B,y={};if(0<f.length&&f!==window){v=
0;for(var w=f.length;v<w;v++)(B=d(f[v],g,k,a(s),r))&&(y[v]=B);return c(y)}g.indexOf&&-1!==g.indexOf(" ")&&(g=g.split(" "));g.indexOf&&-1!==g.indexOf(",")&&(g=g.split(","));if("string"!==typeof g){if("number"===typeof g.length)for(v=0,w=g.length;v<w;v++)(B=d(f,g[v],k,a(s),r))&&(y[g[v]]=B);else for(v in g)(B="function"===typeof g[v]?d(f,v,g[v],a(s),r):d(f,v,g[v].listener,a(g[v]),r))&&(y[v]=B);return c(y)}if("object"!==typeof f)return b("Target is not defined!",arguments);if("function"!==typeof k)return b("Listener is not a function!",
arguments);y=s.useCapture||!1;v=m(f)+"."+m(k)+"."+(y?1:0);if(e.Gesture&&e.Gesture._gestureHandlers[g]){v=g+v;if("remove"===r){if(!l[v])return;l[v].remove();delete l[v]}else if("add"===r){if(l[v])return l[v].add(),l[v];if(s.useCall&&!e.modifyEventListener){var E=k;k=function(b,a){for(var c in a)b[c]=a[c];return E.call(f,b)}}s.gesture=g;s.target=f;s.listener=k;s.fromOverwrite=C;l[v]=e.proxy[g](s)}return l[v]}for(var H=h(g),w=0;w<H.length;w++)if(g=H[w],B=g+"."+v,"remove"===r)l[B]&&(f[p](g,k,y),delete l[B]);
else if("add"===r){if(l[B])break;f[n](g,k,y);l[B]={id:B,type:g,target:f,listener:k,remove:function(){for(var b=0;b<H.length;b++)e.remove(f,H[b],k,s)}}}return l[B]}},c=function(b){return{remove:function(){for(var f in b)b[f].remove()},add:function(){for(var f in b)b[f].add()}}},b=function(b,f){"undefined"!==typeof console&&"undefined"!==typeof console.error&&console.error(b,f)},g={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown",
"mousemove","mouseup"]},f={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2};e.supports={};window.navigator.msPointerEnabled&&(e.supports.msPointer=!0);e.getEventSupport("touchstart")&&(e.supports.touch=!0);e.getEventSupport("mousedown")&&(e.supports.mouse=!0);var h=function(){return function(b){var a=document.addEventListener?"":"on",c=f[b];if(isFinite(c)){b=[];for(var d in e.supports)b.push(a+g[d][c]);return b}return[a+b]}}(),l=
{},k=0,m=function(b){if(b===window)return"#window";if(b===document)return"#document";b.uniqueID||(b.uniqueID="e"+k++);return b.uniqueID},n=document.addEventListener?"addEventListener":"attachEvent",p=document.removeEventListener?"removeEventListener":"detachEvent";e.createPointerEvent=function(b,f,a){var c=f.gesture,d=f.target,g=b.changedTouches||e.proxy.getCoords(b);if(g.length){var h=g[0];f.pointers=a?[]:g;f.pageX=h.pageX;f.pageY=h.pageY;f.x=f.pageX;f.y=f.pageY}a=document.createEvent("Event");a.initEvent(c,
!0,!0);a.originalEvent=b;for(var l in f)"target"!==l&&(a[l]=f[l]);b=a.type;e.Gesture&&e.Gesture._gestureHandlers[b]&&f.oldListener.call(d,a,f,!1)};e.modifyEventListener&&window.HTMLElement&&function(){var b=function(b){var f=function(f){var a=f+"EventListener",c=b[a];b[a]=function(b,a,g){if(e.Gesture&&e.Gesture._gestureHandlers[b]){var l=g;"object"===typeof g?l.useCall=!0:l={useCall:!0,useCapture:g};d(this,b,a,l,f,!0)}else for(b=h(b),l=0;l<b.length;l++)c.call(this,b[l],a,g)}};f("add");f("remove")};
navigator.userAgent.match(/Firefox/)?(b(HTMLDivElement.prototype),b(HTMLCanvasElement.prototype)):b(HTMLElement.prototype);b(document);b(window)}();e.modifySelectors&&function(){var b=NodeList.prototype;b.removeEventListener=function(b,f,a){for(var c=0,g=this.length;c<g;c++)this[c].removeEventListener(b,f,a)};b.addEventListener=function(b,f,a){for(var c=0,g=this.length;c<g;c++)this[c].addEventListener(b,f,a)}}();return e})(Event);"undefined"===typeof Event&&(Event={});
"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.pointerSetup=function(a,c){a.doc=a.target.ownerDocument||a.target;a.minFingers=a.minFingers||a.fingers||1;a.maxFingers=a.maxFingers||a.fingers||Infinity;a.position=a.position||"relative";delete a.fingers;c=c||{};c.enabled=!0;c.gesture=a.gesture;c.target=a.target;c.env=a.env;Event.modifyEventListener&&a.fromOverwrite&&(a.oldListener=a.listener,a.listener=Event.createPointerEvent);var b=0,g=0===c.gesture.indexOf("pointer")&&Event.modifyEventListener?"pointer":"mouse";a.oldListener&&
(c.oldListener=a.oldListener);c.listener=a.listener;c.proxy=function(b){c.defaultListener=a.listener;a.listener=b;b(a.event,c)};c.add=function(){!0!==c.enabled&&(a.onPointerDown&&Event.add(a.target,g+"down",a.onPointerDown),a.onPointerMove&&Event.add(a.doc,g+"move",a.onPointerMove),a.onPointerUp&&Event.add(a.doc,g+"up",a.onPointerUp),c.enabled=!0)};c.remove=function(){!1!==c.enabled&&(a.onPointerDown&&Event.remove(a.target,g+"down",a.onPointerDown),a.onPointerMove&&Event.remove(a.doc,g+"move",a.onPointerMove),
a.onPointerUp&&Event.remove(a.doc,g+"up",a.onPointerUp),c.reset(),c.enabled=!1)};c.pause=function(f){!a.onPointerMove||f&&!f.move||Event.remove(a.doc,g+"move",a.onPointerMove);!a.onPointerUp||f&&!f.up||Event.remove(a.doc,g+"up",a.onPointerUp);b=a.fingers;a.fingers=0};c.resume=function(f){!a.onPointerMove||f&&!f.move||Event.add(a.doc,g+"move",a.onPointerMove);!a.onPointerUp||f&&!f.up||Event.add(a.doc,g+"up",a.onPointerUp);a.fingers=b};c.reset=function(){a.tracker={};a.fingers=0};return c};var a=Event.supports;
Event.pointerType=a.mouse?"mouse":a.touch?"touch":"mspointer";e.pointerStart=function(a,c,b){var g=(a.type||"mousedown").toUpperCase();0===g.indexOf("MOUSE")?Event.pointerType="mouse":0===g.indexOf("TOUCH")?Event.pointerType="touch":0===g.indexOf("MSPOINTER")&&(Event.pointerType="mspointer");var f=function(f,a){var c=b.bbox,g=h[a]={};switch(b.position){case "absolute":g.offsetX=0;g.offsetY=0;break;case "differenceFromLast":g.offsetX=f.pageX;g.offsetY=f.pageY;break;case "difference":g.offsetX=f.pageX;
g.offsetY=f.pageY;break;case "move":g.offsetX=f.pageX-c.x1;g.offsetY=f.pageY-c.y1;break;default:g.offsetX=c.x1,g.offsetY=c.y1}if("relative"===b.position)var d=f.pageX+c.scrollLeft-g.offsetX,c=f.pageY+c.scrollTop-g.offsetY;else d=f.pageX-g.offsetX,c=f.pageY-g.offsetY;g.rotation=0;g.scale=1;g.startTime=g.moveTime=(new Date).getTime();g.move={x:d,y:c};g.start={x:d,y:c};b.fingers++};b.event=a;c.defaultListener&&(b.listener=c.defaultListener,delete c.defaultListener);var g=!b.fingers,h=b.tracker;a=a.changedTouches||
e.getCoords(a);for(var l=a.length,k=0;k<l;k++){var m=a[k],n=m.identifier||Infinity;if(b.fingers){if(b.fingers>=b.maxFingers){var p=[];for(n in b.tracker)p.push(n);c.identifier=p.join(",");return g}var q=0;for(p in h){if(h[p].up){delete h[p];f(m,n);b.cancel=!0;break}q++}h[n]||f(m,n)}else h=b.tracker={},c.bbox=b.bbox=e.getBoundingBox(b.target),b.fingers=0,b.cancel=!1,f(m,n)}p=[];for(n in b.tracker)p.push(n);c.identifier=p.join(",");return g};e.pointerEnd=function(a,c,b,g){var f=a.touches||[],h=f.length;
a={};for(var e=0;e<h;e++){var k=f[e].identifier;a[k||Infinity]=!0}for(k in b.tracker)f=b.tracker[k],a[k]||f.up||(g&&g({pageX:f.pageX,pageY:f.pageY,changedTouches:[{pageX:f.pageX,pageY:f.pageY,identifier:"Infinity"===k?Infinity:k}]},"up"),f.up=!0,b.fingers--);if(0!==b.fingers)return!1;g=[];b.gestureFingers=0;for(k in b.tracker)b.gestureFingers++,g.push(k);c.identifier=g.join(",");return!0};e.getCoords=function(a){e.getCoords="undefined"!==typeof a.pageX?function(a){return Array({type:"mouse",x:a.pageX,
y:a.pageY,pageX:a.pageX,pageY:a.pageY,identifier:a.pointerId||Infinity})}:function(a){a=a||window.event;return Array({type:"mouse",x:a.clientX+document.documentElement.scrollLeft,y:a.clientY+document.documentElement.scrollTop,pageX:a.clientX+document.documentElement.scrollLeft,pageY:a.clientY+document.documentElement.scrollTop,identifier:Infinity})};return e.getCoords(a)};e.getCoord=function(a){if("ontouchstart"in window){var c=0,b=0;e.getCoord=function(a){return(a=a.changedTouches)&&a.length?{x:c=
a[0].pageX,y:b=a[0].pageY}:{x:c,y:b}}}else e.getCoord="undefined"!==typeof a.pageX&&"undefined"!==typeof a.pageY?function(b){return{x:b.pageX,y:b.pageY}}:function(b){b=b||window.event;return{x:b.clientX+document.documentElement.scrollLeft,y:b.clientY+document.documentElement.scrollTop}};return e.getCoord(a)};e.getBoundingBox=function(a){if(a===window||a===document)a=document.body;var c={},b=a.getBoundingClientRect();c.width=b.width;c.height=b.height;c.x1=b.left;c.y1=b.top;c.x2=c.x1+c.width;c.y2=c.y1+
c.height;c.scaleX=b.width/a.offsetWidth||1;c.scaleY=b.height/a.offsetHeight||1;c.scrollLeft=0;c.scrollTop=0;for(a=a.parentNode;null!==a&&a!==document.body&&void 0!==a.scrollTop;){b=window.getComputedStyle(a).getPropertyValue("position");if("absolute"===b)break;else if("fixed"===b){c.scrollTop-=a.parentNode.scrollTop;break}else c.scrollLeft+=a.scrollLeft,c.scrollTop+=a.scrollTop;a=a.parentNode}return c};(function(){var a=navigator.userAgent.toLowerCase(),c=-1!==a.indexOf("macintosh"),b=c&&-1!==a.indexOf("khtml")?
{91:!0,93:!0}:c&&-1!==a.indexOf("firefox")?{224:!0}:{17:!0};e.metaTrackerReset=function(){e.metaKey=!1;e.ctrlKey=!1;e.shiftKey=!1;e.altKey=!1};e.metaTracker=function(a){var f=!!b[a.keyCode];f&&(e.metaKey="keydown"===a.type);e.ctrlKey=a.ctrlKey;e.shiftKey=a.shiftKey;e.altKey=a.altKey;return f}})();return e}(Event.proxy);"undefined"===typeof Event&&(Event={});
Event.MutationObserver=function(){var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,a=function(){var a=document.createElement("p"),c=!1,b=function(){c=!0};if(a.addEventListener)a.addEventListener("DOMAttrModified",b,!1);else if(a.attachEvent)a.attachEvent("onDOMAttrModified",b);else return!1;a.setAttribute("id","target");return c}();return function(d,c){e?(new e(function(b){b.forEach(function(b){c.call(b.target,b.attributeName)})})).observe(d,{subtree:!1,attributes:!0}):
a?Event.add(d,"DOMAttrModified",function(b){c.call(d,b.attrName)}):"onpropertychange"in document.body&&Event.add(d,"propertychange",function(b){c.call(d,window.event.propertyName)})}}();"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.click=function(a){a.gesture=a.gesture||"click";a.maxFingers=a.maxFingers||a.fingers||1;var d;a.onPointerDown=function(b){e.pointerStart(b,c,a)&&(Event.add(a.doc,"mousemove",a.onPointerMove).listener(b),Event.add(a.doc,"mouseup",a.onPointerUp))};a.onPointerMove=function(b){d=b};a.onPointerUp=function(b){if(e.pointerEnd(b,c,a)&&(Event.remove(a.doc,"mousemove",a.onPointerMove),Event.remove(a.doc,"mouseup",a.onPointerUp),!(d.cancelBubble&&1<++d.bubble))){var g=(d.changedTouches||
e.getCoords(d))[0];b=a.bbox;var f=e.getBoundingBox(a.target);if("relative"===a.position)var h=g.pageX+b.scrollLeft-b.x1,g=g.pageY+b.scrollTop-b.y1;else h=g.pageX-b.x1,g=g.pageY-b.y1;if(0<h&&h<b.width&&0<g&&g<b.height&&b.scrollTop===f.scrollTop){for(var l in a.tracker)break;l=a.tracker[l];c.x=l.start.x;c.y=l.start.y;a.listener(d,c)}}};var c=e.pointerSetup(a);c.state="click";Event.add(a.target,"mousedown",a.onPointerDown);return c};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||
{};Event.Gesture._gestureHandlers.click=e.click;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.dbltap=e.dblclick=function(a){a.gesture=a.gesture||"dbltap";a.maxFingers=a.maxFingers||a.fingers||1;var d,c,b,g,f;a.onPointerDown=function(l){var k=l.changedTouches||e.getCoords(l);d&&!c?(f=k[0],c=(new Date).getTime()-d):(g=k[0],d=(new Date).getTime(),c=0,clearTimeout(b),b=setTimeout(function(){d=0},700));e.pointerStart(l,h,a)&&(Event.add(a.doc,"mousemove",a.onPointerMove).listener(l),Event.add(a.doc,"mouseup",a.onPointerUp))};a.onPointerMove=function(h){d&&!c&&(f=(h.changedTouches||
e.getCoords(h))[0]);h=a.bbox;if("relative"===a.position)var k=f.pageX+h.scrollLeft-h.x1,m=f.pageY+h.scrollTop-h.y1;else k=f.pageX-h.x1,m=f.pageY-h.y1;0<k&&k<h.width&&0<m&&m<h.height&&25>=Math.abs(f.pageX-g.pageX)&&25>=Math.abs(f.pageY-g.pageY)||(Event.remove(a.doc,"mousemove",a.onPointerMove),clearTimeout(b),d=c=0)};a.onPointerUp=function(f){e.pointerEnd(f,h,a)&&(Event.remove(a.doc,"mousemove",a.onPointerMove),Event.remove(a.doc,"mouseup",a.onPointerUp));if(d&&c){if(700>=c&&!(f.cancelBubble&&1<++f.bubble)){h.state=
a.gesture;for(var g in a.tracker)break;g=a.tracker[g];h.x=g.start.x;h.y=g.start.y;a.listener(f,h)}clearTimeout(b);d=c=0}};var h=e.pointerSetup(a);h.state="dblclick";Event.add(a.target,"mousedown",a.onPointerDown);return h};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.dbltap=e.dbltap;Event.Gesture._gestureHandlers.dblclick=e.dblclick;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});
"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.dragElement=function(a,d){e.drag({event:d,target:a,position:"move",listener:function(c,b){a.style.left=b.x+"px";a.style.top=b.y+"px";Event.prevent(c)}})};e.drag=function(a){a.gesture="drag";a.onPointerDown=function(c){e.pointerStart(c,d,a)&&!a.monitor&&(Event.add(a.doc,"mousemove",a.onPointerMove),Event.add(a.doc,"mouseup",a.onPointerUp));a.onPointerMove(c,"down")};a.onPointerMove=function(c,b){if(!a.tracker)return a.onPointerDown(c);for(var g=a.bbox,f=c.changedTouches||
e.getCoords(c),h=f.length,l=0;l<h;l++){var k=f[l],m=k.identifier||Infinity,n=a.tracker[m];n&&(n.pageX=k.pageX,n.pageY=k.pageY,d.state=b||"move",d.identifier=m,d.start=n.start,d.fingers=a.fingers,"differenceFromLast"===a.position?(d.x=n.pageX-n.offsetX,d.y=n.pageY-n.offsetY,n.offsetX=n.pageX,n.offsetY=n.pageY):"relative"===a.position?(d.x=n.pageX+g.scrollLeft-n.offsetX,d.y=n.pageY+g.scrollTop-n.offsetY):(d.x=n.pageX-n.offsetX,d.y=n.pageY-n.offsetY),a.listener(c,d))}};a.onPointerUp=function(c){e.pointerEnd(c,
d,a,a.onPointerMove)&&!a.monitor&&(Event.remove(a.doc,"mousemove",a.onPointerMove),Event.remove(a.doc,"mouseup",a.onPointerUp))};var d=e.pointerSetup(a);if(a.event)a.onPointerDown(a.event);else Event.add(a.target,"mousedown",a.onPointerDown),a.monitor&&(Event.add(a.doc,"mousemove",a.onPointerMove),Event.add(a.doc,"mouseup",a.onPointerUp));return d};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.drag=e.drag;return e}(Event.proxy);
"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){var a=Math.PI/180;e.gesture=function(d){d.gesture=d.gesture||"gesture";d.minFingers=d.minFingers||d.fingers||2;d.onPointerDown=function(b){var a=d.fingers;e.pointerStart(b,c,d)&&(Event.add(d.doc,"mousemove",d.onPointerMove),Event.add(d.doc,"mouseup",d.onPointerUp));if(d.fingers===d.minFingers&&a!==d.fingers){c.fingers=d.minFingers;c.scale=1;c.rotation=0;c.state="start";var a="",f;for(f in d.tracker)a+=f;c.identifier=parseInt(a);d.listener(b,c)}};d.onPointerMove=function(b,
g){for(var f=d.bbox,h=d.tracker,l=b.changedTouches||e.getCoords(b),k=l.length,m=0;m<k;m++){var n=l[m],p=n.identifier||Infinity,q=h[p];q&&("relative"===d.position?(q.move.x=n.pageX+f.scrollLeft-f.x1,q.move.y=n.pageY+f.scrollTop-f.y1):(q.move.x=n.pageX-f.x1,q.move.y=n.pageY-f.y1))}if(!(d.fingers<d.minFingers)){var l=[],t=q=m=f=0,k=0;for(p in h)n=h[p],n.up||(q+=n.move.x,t+=n.move.y,k++);q/=k;t/=k;for(p in h)if(n=h[p],!n.up){k=n.start;if(!k.distance){var x=k.x-q,s=k.y-t;k.distance=Math.sqrt(x*x+s*s);
k.angle=Math.atan2(x,s)/a}var x=n.move.x-q,s=n.move.y-t,r=Math.sqrt(x*x+s*s),f=f+r/k.distance,x=Math.atan2(x,s)/a,k=(k.angle-x+360)%360-180;n.DEG2=n.DEG1;n.DEG1=0<k?k:-k;"undefined"!==typeof n.DEG2&&(n.rotation=0<k?n.rotation+(n.DEG1-n.DEG2):n.rotation-(n.DEG1-n.DEG2),m+=n.rotation);l.push(n.move)}c.touches=l;c.fingers=d.fingers;c.scale=f/d.fingers;c.rotation=m/d.fingers;c.state="change";d.listener(b,c)}};d.onPointerUp=function(b){var a=d.fingers;e.pointerEnd(b,c,d)&&(Event.remove(d.doc,"mousemove",
d.onPointerMove),Event.remove(d.doc,"mouseup",d.onPointerUp));a===d.minFingers&&d.fingers<d.minFingers&&(c.fingers=d.fingers,c.state="end",d.listener(b,c))};var c=e.pointerSetup(d);Event.add(d.target,"mousedown",d.onPointerDown);return c};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.gesture=e.gesture;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.pointerdown=e.pointermove=e.pointerup=function(a){a.gesture=a.gesture||"pointer";if(!a.target.isPointerEmitter){var d=!0;a.onPointerDown=function(b){d=!1;c.gesture="pointerdown";a.listener(b,c)};a.onPointerMove=function(b){c.gesture="pointermove";a.listener(b,c,d)};a.onPointerUp=function(b){d=!0;c.gesture="pointerup";a.listener(b,c,!0)};var c=e.pointerSetup(a);Event.add(a.target,"mousedown",a.onPointerDown);Event.add(a.target,"mousemove",a.onPointerMove);Event.add(a.doc,
"mouseup",a.onPointerUp);a.target.isPointerEmitter=!0;return c}};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.pointerdown=e.pointerdown;Event.Gesture._gestureHandlers.pointermove=e.pointermove;Event.Gesture._gestureHandlers.pointerup=e.pointerup;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.shake=function(a){var d={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:a.target,listener:a.listener,remove:function(){window.removeEventListener("devicemotion",f,!1)}},c=(new Date).getTime(),b={x:0,y:0,z:0},g={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},f=function(f){var e=f.accelerationIncludingGravity;b.x=0.8*b.x+(1-0.8)*e.x;b.y=0.8*b.y+(1-0.8)*e.y;b.z=0.8*b.z+(1-0.8)*e.z;d.accelerationIncludingGravity=b;d.acceleration.x=
e.x-b.x;d.acceleration.y=e.y-b.y;d.acceleration.z=e.z-b.z;if("devicemotion"===a.gesture)a.listener(f,d);else for(var e=(new Date).getTime(),k=0;3>k;k++){var m="xyz"[k],n=d.acceleration[m],m=g[m],p=Math.abs(n);!(1E3>e-c)&&4<p&&(n=e*n/p,p=Math.abs(n+m.value),m.value&&200>p?(m.value=n,m.count++,3===m.count&&(a.listener(f,d),c=e,m.value=0,m.count=0)):(m.value=n,m.count=1))}};if(window.addEventListener)return window.addEventListener("devicemotion",f,!1),d};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=
Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.shake=e.shake;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){var a=Math.PI/180;e.swipe=function(d){d.snap=d.snap||90;d.threshold=d.threshold||1;d.gesture=d.gesture||"swipe";d.onPointerDown=function(b){e.pointerStart(b,c,d)&&(Event.add(d.doc,"mousemove",d.onPointerMove).listener(b),Event.add(d.doc,"mouseup",d.onPointerUp))};d.onPointerMove=function(b){b=b.changedTouches||e.getCoords(b);for(var a=b.length,f=0;f<a;f++){var c=b[f],l=d.tracker[c.identifier||Infinity];l&&(l.move.x=c.pageX,l.move.y=c.pageY,l.moveTime=(new Date).getTime())}};
d.onPointerUp=function(b){if(e.pointerEnd(b,c,d)){Event.remove(d.doc,"mousemove",d.onPointerMove);Event.remove(d.doc,"mouseup",d.onPointerUp);var g,f,h,l,k={x:0,y:0},m=0,n=0,p=0,q;for(q in d.tracker){var t=d.tracker[q];l=t.move.x-t.start.x;var x=t.move.y-t.start.y,m=m+t.move.x,n=n+t.move.y;k.x+=t.start.x;k.y+=t.start.y;p++;f=Math.sqrt(l*l+x*x);t=t.moveTime-t.startTime;l=Math.atan2(l,x)/a+180;f=t?f/t:0;if("undefined"===typeof h)h=l,g=f;else if(20>=Math.abs(l-h))h=(h+l)/2,g=(g+f)/2;else return}q=d.gestureFingers;
d.minFingers<=q&&d.maxFingers>=q&&g>d.threshold&&(k.x/=p,k.y/=p,c.start=k,c.x=m/p,c.y=n/p,c.angle=-(((h/d.snap+0.5>>0)*d.snap||360)-360),c.velocity=g,c.fingers=q,c.state="swipe",d.listener(b,c))}};var c=e.pointerSetup(d);Event.add(d.target,"mousedown",d.onPointerDown);return c};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.swipe=e.swipe;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});
"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.longpress=function(a){a.gesture="longpress";return e.tap(a)};e.tap=function(a){a.delay=a.delay||500;a.timeout=a.timeout||250;a.driftDeviance=a.driftDeviance||10;a.gesture=a.gesture||"tap";var d,c;a.onPointerDown=function(g){e.pointerStart(g,b,a)&&(d=(new Date).getTime(),Event.add(a.doc,"mousemove",a.onPointerMove).listener(g),Event.add(a.doc,"mouseup",a.onPointerUp),"longpress"===a.gesture&&(c=setTimeout(function(){if(!(g.cancelBubble&&1<++g.bubble)){var f=0,c;for(c in a.tracker){var d=
a.tracker[c];if(!0===d.end||a.cancel)return;f++}a.minFingers<=f&&a.maxFingers>=f&&(b.state="start",b.fingers=f,b.x=d.start.x,b.y=d.start.y,a.listener(g,b))}},a.delay)))};a.onPointerMove=function(b){var f=a.bbox;b=b.changedTouches||e.getCoords(b);for(var c=b.length,d=0;d<c;d++){var k=b[d],m=a.tracker[k.identifier||Infinity];if(m){if("relative"===a.position)var n=k.pageX+f.scrollLeft-f.x1,k=k.pageY+f.scrollTop-f.y1;else n=k.pageX-f.x1,k=k.pageY-f.y1;var p=n-m.start.x,m=k-m.start.y,m=Math.sqrt(p*p+m*
m);if(!(0<n&&n<f.width&&0<k&&k<f.height&&m<=a.driftDeviance)){Event.remove(a.doc,"mousemove",a.onPointerMove);a.cancel=!0;break}}}};a.onPointerUp=function(g){if(e.pointerEnd(g,b,a)&&(clearTimeout(c),Event.remove(a.doc,"mousemove",a.onPointerMove),Event.remove(a.doc,"mouseup",a.onPointerUp),!(g.cancelBubble&&1<++g.bubble)))if("longpress"===a.gesture)"start"===b.state&&(b.state="end",a.listener(g,b));else if(!(a.cancel||(new Date).getTime()-d>a.timeout)){var f=a.gestureFingers;a.minFingers<=f&&a.maxFingers>=
f&&(b.state="tap",b.fingers=a.gestureFingers,a.listener(g,b))}};var b=e.pointerSetup(a);Event.add(a.target,"mousedown",a.onPointerDown);return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.tap=e.tap;Event.Gesture._gestureHandlers.longpress=e.longpress;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.wheel=function(a){var d,c=a.timeout||150,b=0,g={gesture:"wheel",state:"start",wheelDelta:0,target:a.target,listener:a.listener,preventElasticBounce:function(){var b=this.target,f=b.scrollTop;f+b.offsetHeight===b.scrollHeight&&0>=this.wheelDelta?Event.cancel(event):0===f&&0<=this.wheelDelta&&Event.cancel(event);Event.stop(event)},add:function(){a.target[h](k,f,!1)},remove:function(){a.target[e](k,f,!1)}},f=function(f){f=f||window.event;g.state=b++?"change":"start";g.wheelDelta=
f.detail?-20*f.detail:f.wheelDelta;a.listener(f,g);clearTimeout(d);d=setTimeout(function(){b=0;g.state="end";g.wheelDelta=0;a.listener(f,g)},c)},h=document.addEventListener?"addEventListener":"attachEvent",e=document.removeEventListener?"removeEventListener":"detachEvent",k=Event.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";a.target[h](k,f,!1);return g};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.wheel=
e.wheel;return e}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(e){e.orientation=function(a){var d={gesture:"orientationchange",previous:null,current:window.orientation,target:a.target,listener:a.listener,remove:function(){window.removeEventListener("orientationchange",c,!1)}},c=function(b){d.previous=d.current;d.current=window.orientation;null!==d.previous&&d.previous!=d.current&&a.listener(b,d)};window.DeviceOrientationEvent&&window.addEventListener("orientationchange",c,!1);return d};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=
Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.orientation=e.orientation;return e}(Event.proxy);
(function(){function e(b,a){this.__eventListeners[b]&&(a?fabric.util.removeFromArray(this.__eventListeners[b],a):this.__eventListeners[b].length=0)}function a(b,a){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var f in b)this.on(f,b[f]);else this.__eventListeners[b]||(this.__eventListeners[b]=[]),this.__eventListeners[b].push(a);return this}function d(b,a){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===
typeof arguments[0])for(var f in b)e.call(this,f,b[f]);else e.call(this,b,a);return this}}function c(b,a){if(this.__eventListeners){var f=this.__eventListeners[b];if(f){for(var c=0,d=f.length;c<d;c++)f[c].call(this,a||{});return this}}}fabric.Observable={observe:a,stopObserving:d,fire:c,on:a,off:d,trigger:c}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var e=0,a=arguments.length;e<a;e++)this._onObjectAdded(arguments[e]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(e,a,d){var c=this.getObjects();d?c[a]=e:c.splice(a,0,e);this._onObjectAdded(e);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var e=this.getObjects(),a,d=0,c=arguments.length;d<c;d++)a=e.indexOf(arguments[d]),-1!==a&&(e.splice(a,1),this._onObjectRemoved(arguments[d]));
this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(e,a){for(var d=this.getObjects(),c=d.length;c--;)e.call(a,d[c],c,d);return this},getObjects:function(e){return"undefined"===typeof e?this._objects:this._objects.filter(function(a){return a.type===e})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(e){return-1<this.getObjects().indexOf(e)},complexity:function(){return this.getObjects().reduce(function(e,
a){return e+=a.complexity?a.complexity():0},0)},getObjectsInsideRect:function(e){return this._objects.filter(function(a){return fabric.util.doCoordinatesIntersect(e,a.getCoords())})},indexForObject:function(e){return this._objects.indexOf(e)},iterativelyGetObjectsInsideRect:function(e,a){for(var d=[],c=this._objects.filter(function(b){return b.visible&&-1===a.indexOf(b)}),b=[{getCoords:function(){return e}}],g,f,h,l;0<b.length;){g=b.shift();d.push(g);l=[];for(f=0;f<c.length;f++)h=c[f],fabric.util.doCoordinatesIntersect(g.getCoords(),
h.getCoords())&&this.indexForObject(h)>this.indexForObject(g)?b.push(h):l.push(h);c=l}d.shift();return d}};
(function(e){var a=Math.sqrt,d=Math.atan2,c=Math.PI/180;fabric.util={removeFromArray:function(b,a){var f=b.indexOf(a);-1!==f&&b.splice(f,1);return b},getRandomInt:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},degreesToRadians:function(b){return b*c},radiansToDegrees:function(b){return b/c},rotatePoint:function(b,a,f){var c=Math.sin(f);f=Math.cos(f);b.subtractEquals(a);return(new fabric.Point(b.x*f-b.y*c,b.x*c+b.y*f)).addEquals(a)},transformPoint:function(b,a,f){return f?new fabric.Point(a[0]*
b.x+a[1]*b.y,a[2]*b.x+a[3]*b.y):new fabric.Point(a[0]*b.x+a[1]*b.y+a[4],a[2]*b.x+a[3]*b.y+a[5])},invertTransform:function(b){var a=b.slice(),a=1/(b[0]*b[3]-b[1]*b[2]),a=[a*b[3],-a*b[1],-a*b[2],a*b[0],0,0];b=fabric.util.transformPoint({x:b[4],y:b[5]},a);a[4]=-b.x;a[5]=-b.y;return a},toFixed:function(b,a){return parseFloat(Number(b).toFixed(a))},parseUnit:function(b){var a=/\D{0,2}$/.exec(b);b=parseFloat(b);switch(a[0]){case "mm":return b*fabric.DPI/25.4;case "cm":return b*fabric.DPI/2.54;case "in":return b*
fabric.DPI;case "pt":return b*fabric.DPI/72;case "pc":return 12*(b*fabric.DPI/72);default:return b}},falseFunction:function(){return!1},getKlass:function(b,a){b=fabric.util.string.camelize(b.charAt(0).toUpperCase()+b.slice(1));return fabric.util.resolveNamespace(a)[b]},resolveNamespace:function(b){if(!b)return fabric;b=b.split(".");for(var a=b.length,f=e||fabric.window,c=0;c<a;++c)f=f[b[c]];return f},loadImage:function(b,a,f,c){if(b){var d=fabric.util.createImage();d.onload=function(){a&&a.call(f,
d);d=d.onload=d.onerror=null};d.onerror=function(){fabric.log("Error loading "+d.src);a&&a.call(f,null,!0);d=d.onload=d.onerror=null};0!==b.indexOf("data")&&"undefined"!==typeof c&&(d.crossOrigin=c);d.src=b}else a&&a.call(f,b)},enlivenObjects:function(b,a,f,c){function d(){++m===n&&a&&a(e)}b=b||[];var e=[],m=0,n=b.length;n?b.forEach(function(b,a){if(b&&b.type){var g=fabric.util.getKlass(b.type,f);g.async?g.fromObject(b,function(f,g){g||(e[a]=f,c&&c(b,e[a]));d()}):(e[a]=g.fromObject(b),c&&c(b,e[a]),
d())}else d()}):a&&a(e)},groupSVGElements:function(b,a,f){b=new fabric.PathGroup(b,a);"undefined"!==typeof f&&b.setSourcePath(f);return b},populateWithProperties:function(b,a,f){if(f&&"[object Array]"===Object.prototype.toString.call(f))for(var c=0,d=f.length;c<d;c++)f[c]in b&&(a[f[c]]=b[f[c]])},drawDashedLine:function(b,c,f,h,e,k){h-=c;var m=e-f;e=a(h*h+m*m);h=d(m,h);var m=k.length,n=0,p=!0;b.save();b.translate(c,f);b.moveTo(0,0);b.rotate(h);for(c=0;e>c;)c+=k[n++%m],c>e&&(c=e),b[p?"lineTo":"moveTo"](c,
0),p=!p;b.restore()},createCanvasElement:function(b){b||(b=fabric.document.createElement("canvas"));b.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(b);return b},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(b){b=b.prototype;for(var a=b.stateProperties.length;a--;){var f=b.stateProperties[a],c=f.charAt(0).toUpperCase()+f.slice(1),d="set"+c,c="get"+c;b[c]||(b[c]=new Function('return this.get("'+
f+'")'));b[d]||(b[d]=new Function("value",'return this.set("'+f+'", value)'))}},clipContext:function(b,a){a.save();a.beginPath();b.clipTo(a);a.clip()},multiplyTransformMatrices:function(b,a){for(var f=[[b[0],b[2],b[4]],[b[1],b[3],b[5]],[0,0,1]],c=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],d=[],e=0;3>e;e++){d[e]=[];for(var m=0;3>m;m++){for(var n=0,p=0;3>p;p++)n+=f[e][p]*c[p][m];d[e][m]=n}}return[d[0][0],d[1][0],d[0][1],d[1][1],d[0][2],d[1][2]]},getFunctionBody:function(b){return(String(b).match(/function[^{]*\{([\s\S]*)\}/)||
{})[1]},normalizePoints:function(b,a){for(var f=fabric.util.array.min(b,"x"),c=fabric.util.array.min(b,"y"),f=0>f?f:0,c=0>f?c:0,d=0,e=b.length;d<e;d++)b[d].x-=a.width/2+f||0,b[d].y-=a.height/2+c||0},isTransparent:function(b,a,f,c){0<c&&(a=a>c?a-c:0,f=f>c?f-c:0);var d=!0;b=b.getImageData(a,f,2*c||1,2*c||1);a=3;for(f=b.data.length;a<f&&(d=0>=b.data[a],!1!==d);a+=4);return d},doCoordinatesIntersect:function(b,a){return b.x2<a.x1||b.x1>a.x2||b.y2<a.y1||b.y1>a.y2?!1:!0}}})("undefined"!==typeof exports?
exports:this);
(function(){function e(a,c,e,k,m,n,p,q,t){var x,s,r,C,y,v;g=b.call(arguments);if(d[g])return d[g];var u=e;x=k;s=q;r=t;var A=a;C=c;v=p*(Math.PI/180);y=Math.sin(v);v=Math.cos(v);u=Math.abs(u);x=Math.abs(x);var D=v*(s-A)+y*(r-C),B=v*(r-C)-y*(s-A),D=0.25*(D*D/(u*u)+B*B/(x*x));1<D&&(D=Math.sqrt(D),u*=D,x*=D);var D=v/u,B=y/u,u=-y/x,w=v/x;x=D*s+B*r;s=u*s+w*r;r=D*A+B*C;C=u*A+w*C;A=1/((r-x)*(r-x)+(C-s)*(C-s))-0.25;0>A&&(A=0);D=Math.sqrt(A);n===m&&(D=-D);A=0.5*(x+r)-D*(C-s);D=0.5*(s+C)+D*(r-x);x=Math.atan2(s-
D,x-A);C=Math.atan2(C-D,r-A)-x;0>C&&1===n?C+=2*Math.PI:0<C&&0===n&&(C-=2*Math.PI);s=Math.ceil(Math.abs(C/(0.5*Math.PI+0.001)));r=[];for(u=0;u<s;u++)r[u]=[A,D,x+u*C/s,x+(u+1)*C/s,e,k,y,v];return d[g]=r}function a(a,d,e,k,m,n,p,q){g=b.call(arguments);if(c[g])return c[g];var t=Math.sin(e),x=Math.cos(e),s=Math.sin(k),r=Math.cos(k),C=q*m,y=-p*n,v=p*m,u=q*n,A=0.25*(k-e),D=8/3*Math.sin(A)*Math.sin(A)/Math.sin(2*A),A=a+x-D*t,t=d+t+D*x,x=a+r,B=d+s,s=x+D*s,r=B-D*r;c[g]=[C*A+y*t,v*A+u*t,C*s+y*r,v*s+u*r,C*x+
y*B,v*x+u*B];return c[g]}var d={},c={},b=Array.prototype.join,g;fabric.util.drawArc=function(b,c,d,g){c=e(g[5],g[6],g[0],g[1],g[3],g[4],g[2],c,d);for(d=0;d<c.length;d++)g=a.apply(this,c[d]),b.bezierCurveTo.apply(b,g)}})();
(function(){function e(a,c,b){if(a&&0!==a.length){var g=a.length-1,f=c?a[g][c]:a[g];if(c)for(;g--;)b(a[g][c],f)&&(f=a[g][c]);else for(;g--;)b(a[g],f)&&(f=a[g]);return f}}var a=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var c=Object(this),b=c.length>>>0;if(0===b)return-1;var g=0;0<arguments.length&&(g=Number(arguments[1]),g!==g?g=0:0!==g&&g!==Number.POSITIVE_INFINITY&&g!==Number.NEGATIVE_INFINITY&&(g=(0<g||-1)*
Math.floor(Math.abs(g))));if(g>=b)return-1;for(g=0<=g?g:Math.max(b-Math.abs(g),0);g<b;g++)if(g in c&&c[g]===a)return g;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(a,c){for(var b=0,g=this.length>>>0;b<g;b++)b in this&&a.call(c,this[b],b,this)});Array.prototype.map||(Array.prototype.map=function(a,c){for(var b=[],g=0,f=this.length>>>0;g<f;g++)g in this&&(b[g]=a.call(c,this[g],g,this));return b});Array.prototype.every||(Array.prototype.every=function(a,c){for(var b=0,g=this.length>>>
0;b<g;b++)if(b in this&&!a.call(c,this[b],b,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(a,c){for(var b=0,g=this.length>>>0;b<g;b++)if(b in this&&a.call(c,this[b],b,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(a,c){for(var b=[],g,f=0,h=this.length>>>0;f<h;f++)f in this&&(g=this[f],a.call(c,g,f,this)&&b.push(g));return b});Array.prototype.reduce||(Array.prototype.reduce=function(a){var c=this.length>>>0,b=0,g;if(1<arguments.length)g=
arguments[1];else{do{if(b in this){g=this[b++];break}if(++b>=c)throw new TypeError;}while(1)}for(;b<c;b++)b in this&&(g=a.call(null,g,this[b],b,this));return g});fabric.util.array={invoke:function(d,c){for(var b=a.call(arguments,2),g=[],f=0,h=d.length;f<h;f++)g[f]=b.length?d[f][c].apply(d[f],b):d[f][c].call(d[f]);return g},min:function(a,c){return e(a,c,function(b,a){return b<a})},max:function(a,c){return e(a,c,function(b,a){return b>=a})}}})();
(function(){function e(a,d){for(var c in d)a[c]=d[c];return a}fabric.util.object={extend:e,clone:function(a){return e({},a)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(e){return e.replace(/-+(.)?/g,function(a,d){return d?d.toUpperCase():""})},capitalize:function(e,a){return e.charAt(0).toUpperCase()+(a?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var e=Array.prototype.slice,a=Function.prototype.apply,d=function(){};Function.prototype.bind||(Function.prototype.bind=function(c){var b=this,g=e.call(arguments,1),f;f=g.length?function(){return a.call(b,this instanceof d?this:c,g.concat(e.call(arguments)))}:function(){return a.call(b,this instanceof d?this:c,arguments)};d.prototype=this.prototype;f.prototype=new d;return f})})();
(function(){function e(){}function a(b){var a=this.constructor.superclass.prototype[b];return 1<arguments.length?a.apply(this,d.call(arguments,1)):a.call(this)}var d=Array.prototype.slice,c=function(){},b=function(){for(var b in{toString:1})if("toString"===b)return!1;return!0}(),g=function(a,c,d){for(var g in c)g in a.prototype&&"function"===typeof a.prototype[g]&&-1<(c[g]+"").indexOf("callSuper")?a.prototype[g]=function(b){return function(){var a=this.constructor.superclass;this.constructor.superclass=
d;var f=c[b].apply(this,arguments);this.constructor.superclass=a;if("initialize"!==b)return f}}(g):a.prototype[g]=c[g],b&&(c.toString!==Object.prototype.toString&&(a.prototype.toString=c.toString),c.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=c.valueOf))};fabric.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var h=null,l=d.call(arguments,0);"function"===typeof l[0]&&(h=l.shift());b.superclass=h;b.subclasses=[];h&&(e.prototype=h.prototype,b.prototype=new e,
h.subclasses.push(b));for(var k=0,m=l.length;k<m;k++)g(b,l[k],h);b.prototype.initialize||(b.prototype.initialize=c);b.prototype.constructor=b;b.prototype.callSuper=a;return b}})();
(function(){function e(b){var a=Array.prototype.slice.call(arguments,1),f,c,d=a.length;for(c=0;c<d;c++)if(f=typeof b[a[c]],!/^(?:function|object|unknown)$/.test(f))return!1;return!0}function a(a,f){return function(c){f.call(b(a),c||fabric.window.event)}}function d(b,a){return function(f){if(m[b]&&m[b][a])for(var c=m[b][a],d=0,g=c.length;d<g;d++)c[d].call(this,f||fabric.window.event)}}function c(b,a,f){var c="touchend"===b.type?"changedTouches":"touches";return b[c]&&b[c][0]?b[c][0][a]-(b[c][0][a]-
b[c][0][f])||b[f]:b[f]}var b,g,f=function(){var b=0;return function(a){return a.__uniqueID||(a.__uniqueID="uniqueID__"+b++)}}();(function(){var a={};b=function(b){return a[b]};g=function(b,f){a[b]=f}})();var h=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),l=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),k={},m={};h?(h=function(b,a,f){b.addEventListener(a,
f,!1)},l=function(b,a,f){b.removeEventListener(a,f,!1)}):l?(h=function(b,c,d){var h=f(b);g(h,b);k[h]||(k[h]={});k[h][c]||(k[h][c]=[]);d={handler:d,wrappedHandler:a(h,d)};k[h][c].push(d);b.attachEvent("on"+c,d.wrappedHandler)},l=function(b,a,c){var d=f(b),g;if(k[d]&&k[d][a])for(var h=0,e=k[d][a].length;h<e;h++)(g=k[d][a][h])&&g.handler===c&&(b.detachEvent("on"+a,g.wrappedHandler),k[d][a][h]=null)}):(h=function(b,a,c){var g=f(b);m[g]||(m[g]={});if(!m[g][a]){m[g][a]=[];var h=b["on"+a];h&&m[g][a].push(h);
b["on"+a]=d(g,a)}m[g][a].push(c)},l=function(b,a,c){b=f(b);if(m[b]&&m[b][a]){a=m[b][a];b=0;for(var d=a.length;b<d;b++)a[b]===c&&a.splice(b,1)}});fabric.util.addListener=h;fabric.util.removeListener=l;var n=function(b){return"unknown"!==typeof b.clientX?b.clientX:0},p=function(b){return"unknown"!==typeof b.clientY?b.clientY:0};fabric.isTouchSupported&&(n=function(b){return c(b,"pageX","clientX")},p=function(b){return c(b,"pageY","clientY")});fabric.util.getPointer=function(b,a){b||(b=fabric.window.event);
var f=fabric.util.getScrollLeftTop(b.target||("unknown"!==typeof b.srcElement?b.srcElement:null),a);return{x:n(b)+f.left,y:p(b)+f.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var e=fabric.document.createElement("div"),a="string"===typeof e.style.filter,d=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(b){return b};"string"===typeof e.style.opacity?c=function(b,a){b.style.opacity=a;return b}:a&&(c=function(b,a){var f=b.style;b.currentStyle&&!b.currentStyle.hasLayout&&(f.zoom=1);d.test(f.filter)?f.filter=f.filter.replace(d,0.9999<=a?"":"alpha(opacity="+100*a+")"):f.filter+=" alpha(opacity="+100*a+")";return b});fabric.util.setStyle=function(b,a){var f=b.style;
if(!f)return b;if("string"===typeof a)return b.style.cssText+=";"+a,-1<a.indexOf("opacity")?c(b,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):b;for(var d in a)"opacity"===d?c(b,a[d]):f["float"===d||"cssFloat"===d?"undefined"===typeof f.styleFloat?"cssFloat":"styleFloat":d]=a[d];return b}})();
(function(){function e(b,a){var c=fabric.document.createElement(b),d;for(d in a)"class"===d?c.className=a[d]:"for"===d?c.htmlFor=a[d]:c.setAttribute(d,a[d]);return c}var a=Array.prototype.slice,d,c=function(b){return a.call(b,0)};try{d=c(fabric.document.childNodes)instanceof Array}catch(b){}d||(c=function(b){for(var a=Array(b.length),c=b.length;c--;)a[c]=b[c];return a});var g;g=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(b,a){return fabric.document.defaultView.getComputedStyle(b,
null)[a]}:function(b,a){var c=b.style[a];!c&&b.currentStyle&&(c=b.currentStyle[a]);return c};(function(){var b=fabric.document.documentElement.style,a="userSelect"in b?"userSelect":"MozUserSelect"in b?"MozUserSelect":"WebkitUserSelect"in b?"WebkitUserSelect":"KhtmlUserSelect"in b?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(b){"undefined"!==typeof b.onselectstart&&(b.onselectstart=fabric.util.falseFunction);a?b.style[a]="none":"string"===typeof b.unselectable&&(b.unselectable=
"on");return b};fabric.util.makeElementSelectable=function(b){"undefined"!==typeof b.onselectstart&&(b.onselectstart=null);a?b.style[a]="":"string"===typeof b.unselectable&&(b.unselectable="");return b}})();(function(){fabric.util.getScript=function(b,a){var c=fabric.document.getElementsByTagName("head")[0],d=fabric.document.createElement("script"),g=!0;d.onload=d.onreadystatechange=function(b){!g||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(g=!1,
a(b||fabric.window.event),d=d.onload=d.onreadystatechange=null)};d.src=b;c.appendChild(d)}})();fabric.util.getById=function(b){return"string"===typeof b?fabric.document.getElementById(b):b};fabric.util.toArray=c;fabric.util.makeElement=e;fabric.util.addClass=function(b,a){b&&-1===(" "+b.className+" ").indexOf(" "+a+" ")&&(b.className+=(b.className?" ":"")+a)};fabric.util.wrapElement=function(b,a,c){"string"===typeof a&&(a=e(a,c));b.parentNode&&b.parentNode.replaceChild(a,b);a.appendChild(b);return a};
fabric.util.getScrollLeftTop=function(b,a){var c,d,g=0,e=0,p=fabric.document.documentElement,q=fabric.document.body||{scrollLeft:0,scrollTop:0};for(d=b;b&&b.parentNode&&!c;)b=b.parentNode,b!==fabric.document&&"fixed"===fabric.util.getElementStyle(b,"position")&&(c=b),b!==fabric.document&&d!==a&&"absolute"===fabric.util.getElementStyle(b,"position")?e=g=0:b===fabric.document?(g=q.scrollLeft||p.scrollLeft||0,e=q.scrollTop||p.scrollTop||0):(g+=b.scrollLeft||0,e+=b.scrollTop||0);return{left:g,top:e}};
fabric.util.getElementOffset=function(b){var a;a=b&&b.ownerDocument;var c={left:0,top:0},d={left:0,top:0},e={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!a)return{left:0,top:0};for(var n in e)d[e[n]]+=parseInt(g(b,n),10)||0;a=a.documentElement;"undefined"!==typeof b.getBoundingClientRect&&(c=b.getBoundingClientRect());b=fabric.util.getScrollLeftTop(b,null);return{left:c.left+b.left-(a.clientLeft||0)+d.left,top:c.top+b.top-(a.clientTop||0)+d.top}};fabric.util.getElementStyle=
g})();
(function(){function e(){}var a=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=a.length;c--;)try{if(a[c]())return a[c]}catch(b){}}();fabric.util.request=function(d,c){c||(c={});var b=c.method?c.method.toUpperCase():"GET",g=c.onComplete||function(){},f=a(),h;f.onreadystatechange=function(){4===f.readyState&&(g(f),
f.onreadystatechange=e)};"GET"===b&&(h=null,"string"===typeof c.parameters&&(d=d+(/\?/.test(d)?"&":"?")+c.parameters));f.open(b,d,!0);"POST"!==b&&"PUT"!==b||f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.send(h);return f}})();fabric.log=function(){};fabric.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(e){"undefined"!==typeof console[e]&&console[e].apply&&(fabric[e]=function(){return console[e].apply(console,arguments)})});
(function(){function e(){return a.apply(fabric.window,arguments)}var a=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1E3/60)};fabric.util.animate=function(a){e(function(c){a||(a={});var b=c||+new Date,g=a.duration||500,f=b+g,h,l=a.onChange||function(){},k=a.abort||function(){return!1},m=a.easing||function(b,a,
f,c){return-f*Math.cos(b/c*(Math.PI/2))+f+a},n="startValue"in a?a.startValue:0;c="endValue"in a?a.endValue:100;var p=a.byValue||c-n;a.onStart&&a.onStart();(function t(c){h=c||+new Date;c=h>f?g:h-b;k()?a.onComplete&&a.onComplete():(l(m(c,n,p,g)),h>f?a.onComplete&&a.onComplete():e(t))})(b)})};fabric.util.requestAnimFrame=e})();
(function(){function e(b,a,f,c){b<Math.abs(a)?(b=a,c=f/4):c=f/(2*Math.PI)*Math.asin(a/b);return{a:b,c:a,p:f,s:c}}function a(b,a,f){return b.a*Math.pow(2,10*(a-=1))*Math.sin(2*(a*f-b.s)*Math.PI/b.p)}function d(b,a,f,d){return f-c(d-b,0,f,d)+a}function c(b,a,f,c){return(b/=c)<1/2.75?7.5625*f*b*b+a:b<2/2.75?f*(7.5625*(b-=1.5/2.75)*b+0.75)+a:b<2.5/2.75?f*(7.5625*(b-=2.25/2.75)*b+0.9375)+a:f*(7.5625*(b-=2.625/2.75)*b+0.984375)+a}fabric.util.ease={easeInQuad:function(b,a,f,c){return f*(b/=c)*b+a},easeOutQuad:function(b,
a,f,c){return-f*(b/=c)*(b-2)+a},easeInOutQuad:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b+a:-f/2*(--b*(b-2)-1)+a},easeInCubic:function(b,a,f,c){return f*(b/=c)*b*b+a},easeOutCubic:function(b,a,f,c){return f*((b=b/c-1)*b*b+1)+a},easeInOutCubic:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b*b+a:f/2*((b-=2)*b*b+2)+a},easeInQuart:function(b,a,f,c){return f*(b/=c)*b*b*b+a},easeOutQuart:function(b,a,f,c){return-f*((b=b/c-1)*b*b*b-1)+a},easeInOutQuart:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b*b*b+a:-f/2*
((b-=2)*b*b*b-2)+a},easeInQuint:function(b,a,f,c){return f*(b/=c)*b*b*b*b+a},easeOutQuint:function(b,a,f,c){return f*((b=b/c-1)*b*b*b*b+1)+a},easeInOutQuint:function(b,a,f,c){b/=c/2;return 1>b?f/2*b*b*b*b*b+a:f/2*((b-=2)*b*b*b*b+2)+a},easeInSine:function(b,a,f,c){return-f*Math.cos(b/c*(Math.PI/2))+f+a},easeOutSine:function(b,a,f,c){return f*Math.sin(b/c*(Math.PI/2))+a},easeInOutSine:function(b,a,f,c){return-f/2*(Math.cos(Math.PI*b/c)-1)+a},easeInExpo:function(b,a,f,c){return 0===b?a:f*Math.pow(2,
10*(b/c-1))+a},easeOutExpo:function(b,a,f,c){return b===c?a+f:f*(-Math.pow(2,-10*b/c)+1)+a},easeInOutExpo:function(b,a,f,c){if(0===b)return a;if(b===c)return a+f;b/=c/2;return 1>b?f/2*Math.pow(2,10*(b-1))+a:f/2*(-Math.pow(2,-10*--b)+2)+a},easeInCirc:function(b,a,f,c){return-f*(Math.sqrt(1-(b/=c)*b)-1)+a},easeOutCirc:function(b,a,f,c){return f*Math.sqrt(1-(b=b/c-1)*b)+a},easeInOutCirc:function(b,a,f,c){b/=c/2;return 1>b?-f/2*(Math.sqrt(1-b*b)-1)+a:f/2*(Math.sqrt(1-(b-=2)*b)+1)+a},easeInElastic:function(b,
c,f,d){var l=0;if(0===b)return c;b/=d;if(1===b)return c+f;l||(l=0.3*d);f=e(f,f,l,1.70158);return-a(f,b,d)+c},easeOutElastic:function(b,a,f,c){var d=0;if(0===b)return a;b/=c;if(1===b)return a+f;d||(d=0.3*c);f=e(f,f,d,1.70158);return f.a*Math.pow(2,-10*b)*Math.sin(2*(b*c-f.s)*Math.PI/f.p)+f.c+a},easeInOutElastic:function(b,c,f,d){var l=0;if(0===b)return c;b/=d/2;if(2===b)return c+f;l||(l=0.3*1.5*d);f=e(f,f,l,1.70158);return 1>b?-0.5*a(f,b,d)+c:0.5*f.a*Math.pow(2,-10*(b-=1))*Math.sin(2*(b*d-f.s)*Math.PI/
f.p)+f.c+c},easeInBack:function(b,a,f,c,d){void 0===d&&(d=1.70158);return f*(b/=c)*b*((d+1)*b-d)+a},easeOutBack:function(b,a,f,c,d){void 0===d&&(d=1.70158);return f*((b=b/c-1)*b*((d+1)*b+d)+1)+a},easeInOutBack:function(b,a,f,c,d){void 0===d&&(d=1.70158);b/=c/2;return 1>b?f/2*b*b*(((d*=1.525)+1)*b-d)+a:f/2*((b-=2)*b*(((d*=1.525)+1)*b+d)+2)+a},easeInBounce:d,easeOutBounce:c,easeInOutBounce:function(b,a,f,h){return b<h/2?0.5*d(2*b,0,f,h)+a:0.5*c(2*b-h,0,f,h)+0.5*f+a}}})();
(function(e){function a(b){return b in y?y[b]:b}function d(b,a,f){var c="[object Array]"===Object.prototype.toString.call(a),d;"fill"!==b&&"stroke"!==b||"none"!==a?"fillRule"===b?a="evenodd"===a?"destination-over":a:"strokeDashArray"===b?a=a.replace(/,/g," ").split(/\s+/).map(function(b){return parseInt(b)}):"transformMatrix"===b?a=f&&f.transformMatrix?C(f.transformMatrix,p.parseTransformAttribute(a)):p.parseTransformAttribute(a):"visible"===b?(a="none"===a||"hidden"===a?!1:!0,f&&!1===f.visible&&
(a=!1)):"originX"===b?a="start"===a?"left":"end"===a?"right":"center":d=c?a.map(r):r(a):a="";return!c&&isNaN(d)?a:d}function c(b){for(var a in v)if(b[a]&&"undefined"!==typeof b[v[a]]&&0!==b[a].indexOf("url(")){var f=new p.Color(b[a]);b[a]=f.setAlpha(s(f.getAlpha()*b[v[a]],2)).toRgba()}return b}function b(b,a){var f=b.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(f){var c=f[1],d=f[3],g=
f[4],h=f[5],f=f[6];c&&(a.fontStyle=c);d&&(a.fontWeight=isNaN(parseFloat(d))?d:parseFloat(d));g&&(a.fontSize=parseFloat(g));f&&(a.fontFamily=f);h&&(a.lineHeight="normal"===h?1:h)}}function g(f,c){var g,h;f.replace(/;$/,"").split(";").forEach(function(f){f=f.split(":");g=a(f[0].trim().toLowerCase());h=d(g,f[1].trim());"font"===g?b(h,c):c[g]=h})}function f(b){var a={},f;for(f in p.cssRules){var c=b,d=f.split(" "),g=void 0,e=!0;if((g=h(c,d.pop()))&&d.length){for(var e=d,l=void 0,k=!0;c.parentNode&&1===
c.parentNode.nodeType&&e.length;)k&&(l=e.pop()),c=c.parentNode,k=h(c,l);e=0===e.length}if(g&&e&&0===d.length)for(var n in p.cssRules[f])a[n]=p.cssRules[f][n]}return a}function h(b,a){var f=b.nodeName,c=b.getAttribute("class"),d=b.getAttribute("id"),f=RegExp("^"+f,"i");a=a.replace(f,"");d&&a.length&&(f=RegExp("#"+d+"(?![a-zA-Z\\-]+)","i"),a=a.replace(f,""));if(c&&a.length)for(c=c.split(" "),d=c.length;d--;)f=RegExp("\\."+c[d]+"(?![a-zA-Z\\-]+)","i"),a=a.replace(f,"");return 0===a.length}function l(b){for(var a=
b.getElementsByTagName("use");a.length;){for(var f=a[0],c=f.getAttribute("xlink:href").substr(1),d=f.getAttribute("x")||0,g=f.getAttribute("y")||0,c=b.getElementById(c).cloneNode(!0),d=(f.getAttribute("transform")||"")+" translate("+d+", "+g+")",g=0,h=f.attributes,e=h.length;g<e;g++){var l=h.item(g);"x"!==l.nodeName&&"y"!==l.nodeName&&"xlink:href"!==l.nodeName&&("transform"===l.nodeName?d=d+" "+l.nodeValue:c.setAttribute(l.nodeName,l.nodeValue))}c.setAttribute("transform",d);c.removeAttribute("id");
f.parentNode.replaceChild(c,f)}}function k(b,a){a[3]=a[0]=a[0]>a[3]?a[3]:a[0];if(1!==a[0]||1!==a[3]||0!==a[4]||0!==a[5]){for(var f=b.ownerDocument.createElement("g");null!=b.firstChild;)f.appendChild(b.firstChild);f.setAttribute("transform","matrix("+a[0]+" "+a[1]+" "+a[2]+" "+a[3]+" "+a[4]+" "+a[5]+")");b.appendChild(f)}}function m(b){var a=b.objects;b=b.options;a=a.map(function(b){return p[t(b.type)].fromObject(b)});return{objects:a,options:b}}function n(b,a,f){a[f]&&a[f].toSVG&&b.push('<pattern x="0" y="0" id="',
f,'Pattern" ','width="',a[f].source.width,'" height="',a[f].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',a[f].source.width,'" height="',a[f].source.height,'" xlink:href="',a[f].source.src,'"></image></pattern>')}var p=e.fabric||(e.fabric={}),q=p.util.object.extend,t=p.util.string.capitalize,x=p.util.object.clone,s=p.util.toFixed,r=p.util.parseUnit,C=p.util.multiplyTransformMatrices,y={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",
transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},v={stroke:"strokeOpacity",fill:"fillOpacity"};p.parseTransformAttribute=
function(){function b(a,f){var c=f[0];a[0]=Math.cos(c);a[1]=Math.sin(c);a[2]=-Math.sin(c);a[3]=Math.cos(c)}function a(b,f){var c=2===f.length?f[1]:f[0];b[0]=f[0];b[3]=c}function f(b,a){b[4]=a[0];2===a.length&&(b[5]=a[1])}var c=[1,0,0,1,0,0],d=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
g=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\)))",
"g");return function(h){var e=c.concat(),l=[];if(!h||h&&!d.test(h))return e;h.replace(g,function(d){var g=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?))\\s*\\)))").exec(d).filter(function(b){return""!==
b&&null!=b});d=g[1];g=g.slice(2).map(parseFloat);switch(d){case "translate":f(e,g);break;case "rotate":g[0]=p.util.degreesToRadians(g[0]);b(e,g);break;case "scale":a(e,g);break;case "skewX":e[2]=g[0];break;case "skewY":e[1]=g[0];break;case "matrix":e=g}l.push(e.concat());e=c.concat()});for(h=l[0];1<l.length;)l.shift(),h=p.util.multiplyTransformMatrices(h,l[0]);return h}}();p.parseSVGDocument=function(){var b=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,a=RegExp("^\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)+)\\s*$");
return function(f,c,d){if(f){var g=new Date;l(f);var h=f.getAttribute("viewBox"),e=parseFloat(f.getAttribute("width")),n=parseFloat(f.getAttribute("height")),m,q;if(h&&(h=h.match(a))){var r=parseFloat(h[1]),t=parseFloat(h[2]),s=1,v=1;m=parseFloat(h[3]);q=parseFloat(h[4]);e&&e!==m&&(s=e/m);n&&n!==q&&(v=n/q);k(f,[s,0,0,v,-r,-t])}h=p.util.toArray(f.getElementsByTagName("*"));if(0===h.length&&p.isLikelyNode){h=f.selectNodes('//*[name(.)!="svg"]');r=[];t=0;for(s=h.length;t<s;t++)r[t]=h[t];h=r}h=h.filter(function(a){var f;
if(f=b.test(a.tagName)){a:{for(f=/^(?:pattern|defs)$/;a&&(a=a.parentNode);)if(f.test(a.nodeName)){a=!0;break a}a=!1}f=!a}return f});if(!h||h&&!h.length)c&&c([],{});else{var y={width:e?e:m,height:n?n:q,widthAttr:e,heightAttr:n};p.gradientDefs=p.getGradientDefs(f);p.cssRules=p.getCSSRules(f);p.parseElements(h,function(b){p.documentParsingTime=new Date-g;c&&c(b,y)},x(y),d)}}}}();var u={has:function(b,a){a(!1)},get:function(){},set:function(){}};q(p,{resolveGradients:function(b){for(var a=b.length;a--;){var f=
b[a].get("fill");/^url\(/.test(f)&&(f=f.slice(5,f.length-1),p.gradientDefs[f]&&b[a].set("fill",p.Gradient.fromElement(p.gradientDefs[f],b[a])))}},getGradientDefs:function(b){var a=b.getElementsByTagName("linearGradient");b=b.getElementsByTagName("radialGradient");var f,c,d={};for(c=a.length;c--;)f=a[c],d[f.getAttribute("id")]=f;for(c=b.length;c--;)f=b[c],d[f.getAttribute("id")]=f;return d},parseAttributes:function(b,g){if(b){var h,e={};b.parentNode&&/^[g|a]$/i.test(b.parentNode.nodeName)&&(e=p.parseAttributes(b.parentNode,
g));var l=g.reduce(function(f,c){if(h=b.getAttribute(c))c=a(c),h=d(c,h,e),f[c]=h;return f},{}),l=q(l,q(f(b),p.parseStyleAttribute(b)));return c(q(e,l))}},parseElements:function(b,a,f,c){(new p.ElementsParser(b,a,f,c)).parse()},parseStyleAttribute:function(f){var c={};f=f.getAttribute("style");if(!f)return c;if("string"===typeof f)g(f,c);else{var h,e,l;for(l in f)"undefined"!==typeof f[l]&&(h=a(l.toLowerCase()),e=d(h,f[l]),"font"===h?b(e,c):c[h]=e)}return c},parsePointsAttribute:function(b){if(!b)return null;
b=b.replace(/,/g," ").trim();b=b.split(/\s+/);var a=[],f,c;f=0;for(c=b.length;f<c;f+=2)a.push({x:parseFloat(b[f]),y:parseFloat(b[f+1])});return a},getCSSRules:function(b){b=b.getElementsByTagName("style");for(var f={},c,g=0,h=b.length;g<h;g++)c=b[0].textContent,c=c.replace(/\/\*[\s\S]*?\*\//g,""),c=c.match(/[^{]*\{[\s\S]*?\}/g),c=c.map(function(b){return b.trim()}),c.forEach(function(b){b=b.match(/([\s\S]*?)\s*\{([^}]*)\}/);for(var c={},g=b[2].trim().replace(/;$/,"").split(/\s*;\s*/),h=0,e=g.length;h<
e;h++){var l=g[h].split(/\s*:\s*/),k=a(l[0]),l=d(k,l[1],l[0]);c[k]=l}b=b[1];b.split(",").forEach(function(b){f[b.trim()]=p.util.object.clone(c)})});return f},loadSVGFromURL:function(b,a,f){function c(d){var g=d.responseXML;g&&!g.documentElement&&p.window.ActiveXObject&&d.responseText&&(g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(d.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));g&&g.documentElement&&p.parseSVGDocument(g.documentElement,function(f,c){u.set(b,{objects:p.util.array.invoke(f,
"toObject"),options:c});a(f,c)},f)}b=b.replace(/^\n\s*/,"").trim();u.has(b,function(f){f?u.get(b,function(b){b=m(b);a(b.objects,b.options)}):new p.util.request(b,{method:"get",onComplete:c})})},loadSVGFromString:function(b,a,f){b=b.trim();var c;if("undefined"!==typeof DOMParser){var d=new DOMParser;d&&d.parseFromString&&(c=d.parseFromString(b,"text/xml"))}else p.window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,
"")));p.parseSVGDocument(c.documentElement,function(b,f){a(b,f)},f)},createSVGFontFacesMarkup:function(b){for(var a="",f=0,c=b.length;f<c;f++)"text"===b[f].type&&b[f].path&&(a+=["@font-face {font-family: ",b[f].fontFamily,"; src: url('",b[f].path,"')}"].join(""));a&&(a=['<style type="text/css"><![CDATA[',a,"]]\x3e</style>"].join(""));return a},createSVGRefElementsMarkup:function(b){var a=[];n(a,b,"backgroundColor");n(a,b,"overlayColor");return a.join("")}})})("undefined"!==typeof exports?exports:
this);fabric.ElementsParser=function(e,a,d,c){this.elements=e;this.callback=a;this.options=d;this.reviver=c};fabric.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var e=0,a=this.elements.length;e<a;e++)(function(a,c){setTimeout(function(){a.createObject(a.elements[c],c)},0)})(this,e)};
fabric.ElementsParser.prototype.createObject=function(e,a){var d=fabric[fabric.util.string.capitalize(e.tagName)];if(d&&d.fromElement)try{this._createObject(d,e,a)}catch(c){fabric.log(c)}else this.checkIfDone()};fabric.ElementsParser.prototype._createObject=function(e,a,d){e.async?e.fromElement(a,this.createCallback(d,a),this.options):(e=e.fromElement(a,this.options),this.reviver&&this.reviver(a,e),this.instances[d]=e,this.checkIfDone())};
fabric.ElementsParser.prototype.createCallback=function(e,a){var d=this;return function(c){d.reviver&&d.reviver(a,c);d.instances[e]=c;d.checkIfDone()}};fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(e){return null!=e}),fabric.resolveGradients(this.instances),this.callback(this.instances))};
(function(e){function a(a,c){this.x=a;this.y=c}e=e.fabric||(e.fabric={});e.Point?e.warn("fabric.Point is already defined"):(e.Point=a,a.prototype={constructor:a,add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},
scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>
a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(d,c){return new a(this.x+(d.x-this.x)*c,this.y+(d.y-this.y)*c)},distanceFrom:function(a){var c=this.x-a.x;a=this.y-a.y;return Math.sqrt(c*c+a*a)},midPointFrom:function(d){return new a(this.x+(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},
setXY:function(a,c){this.x=a;this.y=c},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var c=this.x,b=this.y;this.x=a.x;this.y=a.y;a.x=c;a.y=b}})})("undefined"!==typeof exports?exports:this);
(function(e){function a(a){this.status=a;this.points=[]}var d=e.fabric||(e.fabric={});d.Intersection?d.warn("fabric.Intersection is already defined"):(d.Intersection=a,d.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},d.Intersection.intersectLineLine=function(c,b,g,f){var h,e=(f.x-g.x)*(c.y-g.y)-(f.y-g.y)*(c.x-g.x);h=(b.x-c.x)*(c.y-g.y)-(b.y-c.y)*(c.x-g.x);g=(f.y-g.y)*(b.x-c.x)-(f.x-g.x)*(b.y-c.y);0!==g?(e/=g,h/=g,0<=
e&&1>=e&&0<=h&&1>=h?(h=new a("Intersection"),h.points.push(new d.Point(c.x+e*(b.x-c.x),c.y+e*(b.y-c.y)))):h=new a):h=0===e||0===h?new a("Coincident"):new a("Parallel");return h},d.Intersection.intersectLinePolygon=function(c,b,d){for(var f=new a,h=d.length,e=0;e<h;e++){var k=a.intersectLineLine(c,b,d[e],d[(e+1)%h]);f.appendPoints(k.points)}0<f.points.length&&(f.status="Intersection");return f},d.Intersection.intersectPolygonPolygon=function(c,b){for(var d=new a,f=c.length,h=0;h<f;h++){var e=a.intersectLinePolygon(c[h],
c[(h+1)%f],b);d.appendPoints(e.points)}0<d.points.length&&(d.status="Intersection");return d},d.Intersection.intersectPolygonRectangle=function(c,b,g){var f=b.min(g),h=b.max(g);g=new d.Point(h.x,f.y);var e=new d.Point(f.x,h.y);b=a.intersectLinePolygon(f,g,c);g=a.intersectLinePolygon(g,h,c);h=a.intersectLinePolygon(h,e,c);c=a.intersectLinePolygon(e,f,c);f=new a;f.appendPoints(b.points);f.appendPoints(g.points);f.appendPoints(h.points);f.appendPoints(c.points);0<f.points.length&&(f.status="Intersection");
return f})})("undefined"!==typeof exports?exports:this);
(function(e){function a(b){b?this._tryParsingColor(b):this.setSource([0,0,0,1])}function d(b,a,f){0>f&&(f+=1);1<f&&(f-=1);return f<1/6?b+6*(a-b)*f:0.5>f?a:f<2/3?b+6*(a-b)*(2/3-f):b}var c=e.fabric||(e.fabric={});c.Color?c.warn("fabric.Color is already defined."):(c.Color=a,c.Color.prototype={_tryParsingColor:function(b){var c;b in a.colorNameMap&&(b=a.colorNameMap[b]);"transparent"===b?this.setSource([255,255,255,0]):((c=a.sourceFromHex(b))||(c=a.sourceFromRgb(b)),c||(c=a.sourceFromHsl(b)),c&&this.setSource(c))},
_rgbToHsl:function(b,a,f){b/=255;a/=255;f/=255;var d,e,k,m=c.util.array.max([b,a,f]);e=c.util.array.min([b,a,f]);k=(m+e)/2;if(m===e)d=e=0;else{var n=m-e;e=0.5<k?n/(2-m-e):n/(m+e);switch(m){case b:d=(a-f)/n+(a<f?6:0);break;case a:d=(f-b)/n+2;break;case f:d=(b-a)/n+4}d/=6}return[Math.round(360*d),Math.round(100*e),Math.round(100*k)]},getSource:function(){return this._source},setSource:function(b){this._source=b},toRgb:function(){var b=this.getSource();return"rgb("+b[0]+","+b[1]+","+b[2]+")"},toRgba:function(){var b=
this.getSource();return"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"},toHsl:function(){var b=this.getSource(),b=this._rgbToHsl(b[0],b[1],b[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var b=this.getSource(),a=this._rgbToHsl(b[0],b[1],b[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+b[3]+")"},toHex:function(){var b=this.getSource(),a,f;a=b[0].toString(16);a=1===a.length?"0"+a:a;f=b[1].toString(16);f=1===f.length?"0"+f:f;b=b[2].toString(16);b=1===b.length?"0"+b:b;return a.toUpperCase()+
f.toUpperCase()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(b){var a=this.getSource();a[3]=b;this.setSource(a);return this},toGrayscale:function(){var b=this.getSource(),a=parseInt((0.3*b[0]+0.59*b[1]+0.11*b[2]).toFixed(0),10);this.setSource([a,a,a,b[3]]);return this},toBlackWhite:function(b){var a=this.getSource(),f=(0.3*a[0]+0.59*a[1]+0.11*a[2]).toFixed(0),a=a[3],f=Number(f)<Number(b||127)?0:255;this.setSource([f,f,f,a]);return this},overlayWith:function(b){b instanceof
a||(b=new a(b));var c=[],f=this.getAlpha(),d=this.getSource();b=b.getSource();for(var e=0;3>e;e++)c.push(Math.round(0.5*d[e]+0.5*b[e]));c[3]=f;this.setSource(c);return this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",
black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(b){return a.fromSource(a.sourceFromRgb(b))},c.Color.sourceFromRgb=function(b){if(b=b.match(a.reRGBa)){var c=parseInt(b[1],10)/(/%$/.test(b[1])?100:1)*(/%$/.test(b[1])?255:1),f=parseInt(b[2],10)/(/%$/.test(b[2])?100:1)*(/%$/.test(b[2])?
255:1),d=parseInt(b[3],10)/(/%$/.test(b[3])?100:1)*(/%$/.test(b[3])?255:1);return[parseInt(c,10),parseInt(f,10),parseInt(d,10),b[4]?parseFloat(b[4]):1]}},c.Color.fromRgba=a.fromRgb,c.Color.fromHsl=function(b){return a.fromSource(a.sourceFromHsl(b))},c.Color.sourceFromHsl=function(b){if(b=b.match(a.reHSLa)){var c=(parseFloat(b[1])%360+360)%360/360,f=parseFloat(b[2])/(/%$/.test(b[2])?100:1),h=parseFloat(b[3])/(/%$/.test(b[3])?100:1);if(0===f)h=f=c=h;else var e=0.5>=h?h*(f+1):h+f-h*f,k=2*h-e,h=d(k,e,
c+1/3),f=d(k,e,c),c=d(k,e,c-1/3);return[Math.round(255*h),Math.round(255*f),Math.round(255*c),b[4]?parseFloat(b[4]):1]}},c.Color.fromHsla=a.fromHsl,c.Color.fromHex=function(b){return a.fromSource(a.sourceFromHex(b))},c.Color.sourceFromHex=function(b){if(b.match(a.reHex)){var c=b.slice(b.indexOf("#")+1),f=3===c.length;b=f?c.charAt(0)+c.charAt(0):c.substring(0,2);var d=f?c.charAt(1)+c.charAt(1):c.substring(2,4),c=f?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(b,16),parseInt(d,16),parseInt(c,
16),1]}},c.Color.fromSource=function(b){var c=new a;c.setSource(b);return c})})("undefined"!==typeof exports?exports:this);
(function(){function e(b){var a=b.getAttribute("style"),f=b.getAttribute("offset"),c,d,f=parseFloat(f)/(/%$/.test(f)?100:1);if(a){a=a.split(/\s*;\s*/);""===a[a.length-1]&&a.pop();for(var e=a.length;e--;){var m=a[e].split(/\s*:\s*/),n=m[0].trim(),m=m[1].trim();"stop-color"===n?c=m:"stop-opacity"===n&&(d=m)}}c||(c=b.getAttribute("stop-color")||"rgb(0,0,0)");d||(d=b.getAttribute("stop-opacity"));c=(new fabric.Color(c)).toRgb();return{offset:f,color:c,opacity:isNaN(parseFloat(d))?1:parseFloat(d)}}function a(b,
a){for(var f in a){if("string"===typeof a[f]&&/^\d+%$/.test(a[f])){var c=parseFloat(a[f],10);if("x1"===f||"x2"===f||"r2"===f)a[f]=fabric.util.toFixed(b.width*c/100,2);else if("y1"===f||"y2"===f)a[f]=fabric.util.toFixed(b.height*c/100,2)}d(a,f,b)}}function d(b,a,f){if("x1"===a||"x2"===a)b[a]-=fabric.util.toFixed(f.width/2,2);else if("y1"===a||"y2"===a)b[a]-=fabric.util.toFixed(f.height/2,2)}function c(a,c){for(var f in c)if(d(c,f,a),"x1"===f||"x2"===f||"r2"===f)c[f]=fabric.util.toFixed(100*(c[f]/a.width),
2)+"%";else if("y1"===f||"y2"===f)c[f]=fabric.util.toFixed(100*(c[f]/a.height),2)+"%"}fabric.Gradient=fabric.util.createClass({initialize:function(a){a||(a={});var c={};this.id=fabric.Object.__uid++;this.type=a.type||"linear";c={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0};"radial"===this.type&&(c.r1=a.coords.r1||0,c.r2=a.coords.r2||0);this.coords=c;this.gradientUnits=a.gradientUnits||"objectBoundingBox";this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var c in a){var f=
new fabric.Color(a[c]);this.colorStops.push({offset:c,color:f.toRgb(),opacity:f.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(a,d){var f=fabric.util.object.clone(this.coords),h;this.colorStops.sort(function(a,b){return a.offset-b.offset});d&&"userSpaceOnUse"===this.gradientUnits?(f.x1+=a.width/2,f.y1+=a.height/2,f.x2+=a.width/2,f.y2+=a.height/2):"objectBoundingBox"===this.gradientUnits&&
c(a,f);"linear"===this.type?h=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,'">']:"radial"===this.type&&(h=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',f.x2,'" cy="',f.y2,'" r="',f.r2,'" fx="',f.x1,'" fy="',f.y1,'">']);for(f=0;f<this.colorStops.length;f++)h.push("<stop ",'offset="',100*this.colorStops[f].offset+"%",'" style="stop-color:',this.colorStops[f].color,this.colorStops[f].opacity?
";stop-opacity: "+this.colorStops[f].opacity:";",'"/>');h.push("linear"===this.type?"</linearGradient>":"</radialGradient>");return h.join("")},toLive:function(a){var c;if(this.type){"linear"===this.type?c=a.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):"radial"===this.type&&(c=a.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2));a=0;for(var f=this.colorStops.length;a<f;a++){var d=this.colorStops[a].color,
e=this.colorStops[a].opacity,k=this.colorStops[a].offset;"undefined"!==typeof e&&(d=(new fabric.Color(d)).setAlpha(e).toRgba());c.addColorStop(parseFloat(k),d)}return c}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(b,c){var f=b.getElementsByTagName("stop"),d="linearGradient"===b.nodeName?"linear":"radial",l=b.getAttribute("gradientUnits")||"objectBoundingBox",k=[],m={};"linear"===d?m={x1:b.getAttribute("x1")||0,y1:b.getAttribute("y1")||0,x2:b.getAttribute("x2")||"100%",y2:b.getAttribute("y2")||
0}:"radial"===d&&(m={x1:b.getAttribute("fx")||b.getAttribute("cx")||"50%",y1:b.getAttribute("fy")||b.getAttribute("cy")||"50%",r1:0,x2:b.getAttribute("cx")||"50%",y2:b.getAttribute("cy")||"50%",r2:b.getAttribute("r")||"50%"});for(var n=f.length;n--;)k.push(e(f[n]));a(c,m);return new fabric.Gradient({type:d,coords:m,gradientUnits:l,colorStops:k})},forObject:function(b,c){c||(c={});a(b,c);return new fabric.Gradient(c)}})})();
fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(e){e||(e={});this.id=fabric.Object.__uid++;if(e.source)if("string"===typeof e.source)if("undefined"!==typeof fabric.util.getFunctionBody(e.source))this.source=new Function(fabric.util.getFunctionBody(e.source));else{var a=this;this.source=fabric.util.createImage();fabric.util.loadImage(e.source,function(d){a.source=d})}else this.source=e.source;e.repeat&&(this.repeat=e.repeat);e.offsetX&&(this.offsetX=
e.offsetX);e.offsetY&&(this.offsetY=e.offsetY)},toObject:function(){var e;"function"===typeof this.source?e=String(this.source):"string"===typeof this.source.src&&(e=this.source.src);return{source:e,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(e){var a="function"===typeof this.source?this.source():this.source,d=a.width/e.getWidth();e=a.height/e.getHeight();var c="";a.src?c=a.src:a.toDataURL&&(c=a.toDataURL());return'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+
'" y="'+this.offsetY+'" width="'+d+'" height="'+e+'"><image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+c+'"></image></pattern>'},toLive:function(e){var a="function"===typeof this.source?this.source():this.source;return a&&("undefined"===typeof a.src||a.complete&&0!==a.naturalWidth&&0!==a.naturalHeight)?e.createPattern(a,this.repeat):""}});
(function(e){var a=e.fabric||(e.fabric={});a.Shadow?a.warn("fabric.Shadow is already defined."):(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(d){"string"===typeof d&&(d=this._parseShadow(d));for(var c in d)this[c]=d[c];this.id=a.Object.__uid++},_parseShadow:function(d){d=d.trim();var c=a.Shadow.reOffsetsAndBlur.exec(d)||[];return{color:(d.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(c[1],
10)||0,offsetY:parseInt(c[2],10)||0,blur:parseInt(c[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var c="SourceAlpha";!a||a.fill!==this.color&&a.stroke!==this.color||(c="SourceGraphic");return'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+c+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'},
toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var d={},c=a.Shadow.prototype;this.color!==c.color&&(d.color=this.color);this.blur!==c.blur&&(d.blur=this.blur);this.offsetX!==c.offsetX&&(d.offsetX=this.offsetX);this.offsetY!==c.offsetY&&(d.offsetY=this.offsetY);return d}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof exports?
exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var e=fabric.util.object.extend,a=fabric.util.getElementOffset,d=fabric.util.removeFromArray,c=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,c){c||(c={});this._initStatic(a,c);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,
clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],performanceMode:!1,dirtyRects:[],onBeforeScaleRotate:function(){},_initStatic:function(a,c){this._objects=[];this._createLowerCanvas(a);this._initOptions(c);this._setImageSmoothing();c.overlayImage&&this.setOverlayImage(c.overlayImage,this.renderAll.bind(this));c.backgroundImage&&this.setBackgroundImage(c.backgroundImage,this.renderAll.bind(this));c.backgroundColor&&this.setBackgroundColor(c.backgroundColor,
this.renderAll.bind(this));c.overlayColor&&this.setOverlayColor(c.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=a(this.lowerCanvasEl);return this},setOverlayImage:function(a,c,f){return this.__setBgOverlayImage("overlayImage",a,c,f)},setBackgroundImage:function(a,c,f){return this.__setBgOverlayImage("backgroundImage",a,c,f)},setOverlayColor:function(a,c){return this.__setBgOverlayColor("overlayColor",a,c)},setBackgroundColor:function(a,c){return this.__setBgOverlayColor("backgroundColor",
a,c)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled;a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;a.mozImageSmoothingEnabled=this.imageSmoothingEnabled;a.msImageSmoothingEnabled=this.imageSmoothingEnabled;a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,c,f,d){"string"===typeof c?fabric.util.loadImage(c,function(c){this[a]=new fabric.Image(c,d);f&&f()},this):(this[a]=c,f&&f());return this},__setBgOverlayColor:function(a,
c,f){if(c&&c.source){var d=this;fabric.util.loadImage(c.source,function(e){d[a]=new fabric.Pattern({source:e,repeat:c.repeat,offsetX:c.offsetX,offsetY:c.offsetY});f&&f()})}else this[a]=c,f&&f();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");a.style||(a.style={});if(!a)throw c;this._initCanvasElement(a);return a},_initCanvasElement:function(a){fabric.util.createCanvasElement(a);if("undefined"===typeof a.getContext)throw c;},_initOptions:function(a){for(var c in a)this[c]=
a[c];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);
fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a){return this._setDimension("width",a)},setHeight:function(a){return this._setDimension("height",a)},setDimensions:function(a){for(var c in a)this._setDimension(c,a[c]);return this},_setDimension:function(a,c){this.lowerCanvasEl[a]=
c;this.lowerCanvasEl.style[a]=c+"px";this.upperCanvasEl&&(this.upperCanvasEl[a]=c,this.upperCanvasEl.style[a]=c+"px");this.cacheCanvasEl&&(this.cacheCanvasEl[a]=c);this.wrapperEl&&(this.wrapperEl.style[a]=c+"px");this[a]=c;this.calcOffset();this.renderAll();return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){this.viewportTransform=a;this.renderAll();a=0;for(var c=this._objects.length;a<c;a++)this._objects[a].setCoords();
return this},zoomToPoint:function(a,c){var f=a;a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=c;this.viewportTransform[3]=c;var d=fabric.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=f.x-d.x;this.viewportTransform[5]+=f.y-d.y;this.renderAll();f=0;for(d=this._objects.length;f<d;f++)this._objects[f].setCoords();return this},setZoom:function(a){this.zoomToPoint(new fabric.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=
-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var c=this._objects.length;a<c;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,c){if(c){a.save();var f=this.viewportTransform;a.transform(f[0],f[1],f[2],f[3],f[4],f[5]);
c.render(a);a.restore();this.controlsAboveOverlay||c._renderControls(a)}},_onObjectAdded:function(a){this.stateful&&a.setupState();a.canvas=this;a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);
return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var c=this[!0===a&&this.interactive?"contextTop":"contextContainer"],f=this.getActiveGroup();this.performanceMode?this._clearDirtyRects():
(this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),a||this.clearContext(c));this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,c);this._renderBackground(c);this.performanceMode?this._renderDirtyObjects(c):this._renderObjects(c,f);this._renderActiveGroup(c,f);this.clipTo&&c.restore();this._renderOverlay(c);this.controlsAboveOverlay&&this.interactive&&this.drawControls(c);this.fire("after:render");return this},_clearDirtyRects:function(){for(var a=
[],c=0;c<this.dirtyRects.length;c++){var f=this.dirtyRects[c],a=a.concat(this.iterativelyGetObjectsInsideRect(f,a));this.getContext().clearRect(f.x1,f.y1,f.x2-f.x1,f.y2-f.y1)}for(c=0;c<a.length;c++)a[c].dirty=!0;this.dirtyRects=[]},_renderObjects:function(a,c){var f,d;if(c)for(f=0,d=this._objects.length;f<d;++f)this._objects[f]&&!c.contains(this._objects[f])&&this._draw(a,this._objects[f]);else for(f=0,d=this._objects.length;f<d;++f)this._draw(a,this._objects[f])},_renderDirtyObjects:function(a){for(var c=
0,f=this._objects.length;c<f;++c)this._objects[c]&&this._objects[c].dirty&&this._draw(a,this._objects[c])},_renderActiveGroup:function(a,c){if(c){var f=[];this.forEachObject(function(a){c.contains(a)&&f.push(a)});c._set("objects",f);this._draw(a,c)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&
this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(a,this.overlayImage)},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);this.selection&&this._groupSelector&&this._drawSelection();var c=this.getActiveGroup();c&&c.render(a);
this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(a){var c=this.getCenter();this._centerObject(a,new fabric.Point(c.left,
c.top));this.renderAll();return this},_centerObject:function(a,c){a.setPositionByOrigin(c,"center","center");return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,c){var f=this.getActiveGroup();f&&this.discardActiveGroup();var d={objects:this._toObjects(a,c)};e(d,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,
d,c);f&&(this.setActiveGroup(new fabric.Group(f.getObjects(),{originX:"center",originY:"center"})),f.forEachObject(function(a){a.set("active",!0)}),this._currentTransform&&(this._currentTransform.target=this.getActiveGroup()));return d},_toObjects:function(a,c){return this.getObjects().map(function(f){return this._toObject(f,a,c)},this)},_toObject:function(a,c,f){var d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);c=a[c](f);this.includeDefaultValues||(a.includeDefaultValues=
d);return c},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},toSVG:function(a,c){a||(a={});var f=[];this._setSVGPreamble(f,a);this._setSVGHeader(f,
a);this._setSVGBgOverlayColor(f,"backgroundColor");this._setSVGBgOverlayImage(f,"backgroundImage");this._setSVGObjects(f,c);this._setSVGBgOverlayColor(f,"overlayColor");this._setSVGBgOverlayImage(f,"overlayImage");f.push("</svg>");return f.join("")},_setSVGPreamble:function(a,c){c.suppressPreamble||a.push('<?xml version="1.0" encoding="',c.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,
c){a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',c.viewBox?c.viewBox.width:this.width,'" ','height="',c.viewBox?c.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,c.viewBox?'viewBox="'+c.viewBox.x+" "+c.viewBox.y+" "+c.viewBox.width+" "+c.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,
"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,c){var f=this.getActiveGroup();f&&this.discardActiveGroup();for(var d=0,e=this.getObjects(),k=e.length;d<k;d++)a.push(e[d].toSVG(c));f&&(this.setActiveGroup(new fabric.Group(f.getObjects())),f.forEachObject(function(a){a.set("active",!0)}))},_setSVGBgOverlayImage:function(a,c){this[c]&&this[c].toSVG&&a.push(this[c].toSVG())},_setSVGBgOverlayColor:function(a,
c){this[c]&&this[c].source?a.push('<rect x="',this[c].offsetX,'" y="',this[c].offsetY,'" ','width="',"repeat-y"===this[c].repeat||"no-repeat"===this[c].repeat?this[c].source.width:this.width,'" height="',"repeat-x"===this[c].repeat||"no-repeat"===this[c].repeat?this[c].source.height:this.height,'" fill="url(#'+c+'Pattern)"',"></rect>"):this[c]&&"overlayColor"===c&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[c],'"',"></rect>")},sendToBack:function(a){d(this._objects,
a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){d(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,c){var f=this._objects.indexOf(a);0!==f&&(f=this._findNewLowerIndex(a,f,c),d(this._objects,a),this._objects.splice(f,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,c,f){if(f)for(f=c,c-=1;0<=c;--c){if(a.intersectsWithObject(this._objects[c])||a.isContainedWithinObject(this._objects[c])||
this._objects[c].isContainedWithinObject(a)){f=c;break}}else f=c-1;return f},bringForward:function(a,c){var f=this._objects.indexOf(a);f!==this._objects.length-1&&(f=this._findNewUpperIndex(a,f,c),d(this._objects,a),this._objects.splice(f,0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,c,f){if(f)for(f=c,c+=1;c<this._objects.length;++c){if(a.intersectsWithObject(this._objects[c])||a.isContainedWithinObject(this._objects[c])||this._objects[c].isContainedWithinObject(a)){f=
c;break}}else f=c+1;return f},moveTo:function(a,c){d(this._objects,a);this._objects.splice(c,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"},addDirtyRect:function(a){this.dirtyRects.push(a);return this}});e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);
e(fabric.StaticCanvas.prototype,fabric.DataURLExporter);e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var c=fabric.util.createCanvasElement();if(!c||!c.getContext)return null;var f=c.getContext("2d");if(!f)return null;switch(a){case "getImageData":return"undefined"!==typeof f.getImageData;case "setLineDash":return"undefined"!==typeof f.setLineDash;case "toDataURL":return"undefined"!==typeof c.toDataURL;case "toDataURLWithQuality":try{return c.toDataURL("image/jpeg",
0),!0}catch(d){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(e){this.shadow=new fabric.Shadow(e);return this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color;e.lineWidth=this.width;e.lineCap=this.strokeLineCap;e.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var e=this.canvas.contextTop;e.shadowColor=this.shadow.color;e.shadowBlur=this.shadow.blur;e.shadowOffsetX=
this.shadow.offsetX;e.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="";e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}});
(function(){var e=fabric.util.array.min,a=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a;this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a);this._captureDrawingPath(a);this._render()},onMouseMove:function(a){this._captureDrawingPath(a);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(a){a=new fabric.Point(a.x,a.y);this._reset();
this._addPoint(a);this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(a){a=new fabric.Point(a.x,a.y);this._addPoint(a)},_render:function(){var a=this.canvas.contextTop,c=this.canvas.viewportTransform,b=this._points[0],e=this._points[1];a.save();a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);a.beginPath();2===this._points.length&&b.x===e.x&&b.y===e.y&&(b.x-=0.5,
e.x+=0.5);a.moveTo(b.x,b.y);for(var c=1,f=this._points.length;c<f;c++)e=b.midPointFrom(e),a.quadraticCurveTo(b.x,b.y,e.x,e.y),b=this._points[c],e=this._points[c+1];a.lineTo(b.x,b.y);a.stroke();a.restore()},_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minX,this.box.minY)},getPathBoundingBox:function(d){for(var c=[],b=[],g=d[0],f=d[1],h=g,l=1,k=d.length;l<k;l++){var m=g.midPointFrom(f);c.push(h.x);c.push(m.x);b.push(h.y);
b.push(m.y);g=d[l];f=d[l+1];h=m}c.push(g.x);b.push(g.y);return{minX:e(c),minY:e(b),maxX:a(c),maxY:a(b)}},convertPointsToSVGPath:function(a,c,b){var e=[],f=new fabric.Point(a[0].x-c,a[0].y-b),h=new fabric.Point(a[1].x-c,a[1].y-b);e.push("M ",a[0].x-c," ",a[0].y-b," ");for(var l=1,k=a.length;l<k;l++){var m=f.midPointFrom(h);e.push("Q ",f.x," ",f.y," ",m.x," ",m.y," ");f=new fabric.Point(a[l].x-c,a[l].y-b);l+1<a.length&&(h=new fabric.Point(a[l+1].x-c,a[l+1].y-b))}e.push("L ",f.x," ",f.y," ");return e},
createPath:function(a){a=new fabric.Path(a);a.fill=null;a.stroke=this.color;a.strokeWidth=this.width;a.strokeLineCap=this.strokeLineCap;a.strokeLineJoin=this.strokeLineJoin;this.shadow&&(this.shadow.affectStroke=!0,a.setShadow(this.shadow));return a},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var a=this._getSVGPathData().join("");if("M 0 0 Q 0 0 0 0 L 0 0"===a)this.canvas.renderAll();else{var c=this.box.minX+(this.box.maxX-this.box.minX)/2,b=this.box.minY+(this.box.maxY-this.box.minY)/
2;this.canvas.contextTop.arc(c,b,3,0,2*Math.PI,!1);a=this.createPath(a);a.set({left:c,top:b,originX:"center",originY:"center"});this.canvas.add(a);a.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:a})}}})})();
fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e;this.points=[]},drawDot:function(e){e=this.addPoint(e);var a=this.canvas.contextTop,d=this.canvas.viewportTransform;a.save();a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);a.fillStyle=e.fill;a.beginPath();a.arc(e.x,e.y,e.radius,0,2*Math.PI,!1);a.closePath();a.fill();a.restore()},onMouseDown:function(e){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(e)},
onMouseMove:function(e){this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],d=0,c=this.points.length;d<c;d++){var b=this.points[d],b=new fabric.Circle({radius:b.radius,left:b.x,top:b.y,originX:"center",originY:"center",fill:b.fill});this.shadow&&b.setShadow(this.shadow);a.push(b)}a=new fabric.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(e){e=new fabric.Point(e.x,e.y);var a=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();e.radius=a;e.fill=d;this.points.push(e);return e}});
fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e;this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(e);this.render()},onMouseMove:function(e){this.addSprayChunk(e);this.render()},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var a=[],d=0,c=this.sprayChunks.length;d<c;d++)for(var b=this.sprayChunks[d],g=0,f=b.length;g<f;g++){var h=new fabric.Rect({width:b[g].width,height:b[g].width,left:b[g].x+1,top:b[g].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow);a.push(h)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));a=new fabric.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},_getOptimizedRects:function(e){for(var a={},d,c=0,b=e.length;c<b;c++)d=e[c].left+""+e[c].top,a[d]||(a[d]=e[c]);e=[];for(d in a)e.push(a[d]);return e},render:function(){var e=this.canvas.contextTop;e.fillStyle=this.color;var a=this.canvas.viewportTransform;e.save();e.transform(a[0],a[1],a[2],a[3],a[4],a[5]);for(var a=0,d=this.sprayChunkPoints.length;a<d;a++){var c=this.sprayChunkPoints[a];"undefined"!==typeof c.opacity&&(e.globalAlpha=
c.opacity);e.fillRect(c.x,c.y,c.width,c.width)}e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];for(var a,d,c,b=this.width/2,g=0;g<this.density;g++)a=fabric.util.getRandomInt(e.x-b,e.x+b),d=fabric.util.getRandomInt(e.y-b,e.y+b),c=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,a=new fabric.Point(a,d),a.width=c,this.randomOpacity&&(a.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a);
this.sprayChunks.push(this.sprayChunkPoints)}});
fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=fabric.document.createElement("canvas"),a=e.getContext("2d");e.width=e.height=25;a.fillStyle=this.color;a.beginPath();a.arc(10,10,10,0,2*Math.PI,!1);a.closePath();a.fill();return e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){e=this.callSuper("createPath",e);e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return e}});
(function(){var e=fabric.util.getPointer,a=fabric.util.degreesToRadians,d=fabric.util.radiansToDegrees,c=Math.atan2,b=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={});this._initStatic(a,b);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",
selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(a){var b=
this._currentTransform;b.target.set({scaleX:b.original.scaleX,scaleY:b.original.scaleY,left:b.original.left,top:b.original.top});this._shouldCenterTransform(a,b.target)?"rotate"===b.action?this._setOriginToCenter(b.target):("center"!==b.originX&&(b.mouseXSign="right"===b.originX?-1:1),"center"!==b.originY&&(b.mouseYSign="bottom"===b.originY?-1:1),b.originX="center",b.originY="center"):(b.originX=b.original.originX,b.originY=b.original.originY)},containsPoint:function(a,b){var c=this.getPointer(a,
!0),d=this._normalizePointer(b,c);return b.containsPoint(d)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c=this.getActiveGroup(),d=b.x,e=b.y;c&&"group"!==a.type&&c.contains(a)&&(c=new fabric.Point(c.left,c.top),c=fabric.util.transformPoint(c,this.viewportTransform,!0),d-=c.x,e-=c.y);return{x:d,y:e}},isTargetTransparent:function(a,b,c){var d=a.hasBorders,e=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;this._draw(this.contextCache,a);a.hasBorders=d;a.transparentCorners=e;
a=fabric.util.isTransparent(this.contextCache,b,c,this.targetFindTolerance);this.clearContext(this.contextCache);return a},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a,b){if(b){var c=this._currentTransform,d;"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?d=this.centeredScaling||b.centeredScaling:"rotate"===c.action&&
(d=this.centeredRotation||b.centeredRotation);return d?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};if("ml"===b||"tl"===b||"bl"===b)c.x="right";else if("mr"===b||"tr"===b||"br"===b)c.x="left";if("tl"===b||"mt"===b||"tr"===b)c.y="bottom";else if("bl"===b||"mb"===b||"br"===b)c.y="top";return c},_getActionFromCorner:function(a,b){var c="drag";b&&(c="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":"scale");return c},_setupCurrentTransform:function(b,
c){if(c){var d=this.getPointer(b),e=c._findTargetCorner(this.getPointer(b,!0)),g=this._getActionFromCorner(c,e),e=this._getOriginFromCorner(c,e);this._currentTransform={target:c,action:g,scaleX:c.scaleX,scaleY:c.scaleY,offsetX:d.x-c.left,offsetY:d.y-c.top,originX:e.x,originY:e.y,ex:d.x,ey:d.y,left:c.left,top:c.top,theta:a(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,originX:e.x,originY:e.y};this._resetCurrentTransform(b)}},
_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_scaleObject:function(a,b,c){var d=this._currentTransform,e=d.target,g=e.get("lockScalingX"),p=e.get("lockScalingY");if(!g||!p){var q=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY);a=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY);this._setLocalMouse(a,d);this._setObjectScale(a,
d,g,p,c);e.setPositionByOrigin(q,d.originX,d.originY)}},_setObjectScale:function(a,b,c,d,e){var g=b.target;b.newScaleX=g.scaleX;b.newScaleY=g.scaleY;"equally"!==e||c||d?e?"x"!==e||g.get("lockUniScaling")?"y"!==e||g.get("lockUniScaling")||(b.newScaleY=a.y/(g.height+g.strokeWidth),d||g.set("scaleY",b.newScaleY)):(b.newScaleX=a.x/(g.width+g.strokeWidth),c||g.set("scaleX",b.newScaleX)):(b.newScaleX=a.x/(g.width+g.strokeWidth),b.newScaleY=a.y/(g.height+g.strokeWidth),c||g.set("scaleX",b.newScaleX),d||
g.set("scaleY",b.newScaleY)):this._scaleObjectEqually(a,g,b);this._flipObject(b)},_scaleObjectEqually:function(a,b,c){a=a.y+a.x;var d=(b.height+b.strokeWidth)*c.original.scaleY+(b.width+b.strokeWidth)*c.original.scaleX;c.newScaleX=c.original.scaleX*a/d;c.newScaleY=c.original.scaleY*a/d;b.set("scaleX",c.newScaleX);b.set("scaleY",c.newScaleY)},_flipObject:function(a){0>a.newScaleX&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&("top"===a.originY?a.originY=
"bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,c){var d=c.target;"right"===c.originX?a.x*=-1:"center"===c.originX&&(a.x=2*a.x*c.mouseXSign,0>a.x&&(c.mouseXSign=-c.mouseXSign));"bottom"===c.originY?a.y*=-1:"center"===c.originY&&(a.y=2*a.y*c.mouseYSign,0>a.y&&(c.mouseYSign=-c.mouseYSign));b(a.x)>d.padding?a.x=0>a.x?a.x+d.padding:a.x-d.padding:a.x=0;b(a.y)>d.padding?a.y=0>a.y?a.y+d.padding:a.y-d.padding:a.y=0},_rotateObject:function(a,b){var e=this._currentTransform;if(!e.target.get("lockRotation")){var g=
c(e.ey-e.top,e.ex-e.left),m=c(b-e.top,a-e.left),g=d(m-g+e.theta);0>g&&(g=360+g);e.target.angle=g}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,c=this._groupSelector,d=c.left,e=c.top,g=b(d),n=b(e);a.fillStyle=this.selectionColor;a.fillRect(c.ex-(0<d?0:-d),c.ey-(0<e?0:-e),g,n);a.lineWidth=this.selectionLineWidth;a.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?
(d=c.ex+0.5-(0<d?0:g),c=c.ey+0.5-(0<e?0:n),a.beginPath(),fabric.util.drawDashedLine(a,d,c,d+g,c,this.selectionDashArray),fabric.util.drawDashedLine(a,d,c+n-1,d+g,c+n-1,this.selectionDashArray),fabric.util.drawDashedLine(a,d,c,d,c+n,this.selectionDashArray),fabric.util.drawDashedLine(a,d+g-1,c,d+g-1,c+n,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(c.ex+0.5-(0<d?0:g),c.ey+0.5-(0<e?0:n),g,n)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&
this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,!0))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!b&&this.containsPoint(a,c))return c;c=this._searchPossibleTargets(a);this._fireOverOutEvents(c);return c}},_fireOverOutEvents:function(a){a?
this._hoveredTarget!==a&&(this.fire("mouse:over",{target:a}),a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,b)&&(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing||!this.isTargetTransparent(b,
c.x,c.y)))return!0},_searchPossibleTargets:function(a){for(var b,c=this.getPointer(a,!0),d=this._objects.length;d--;)if(this._checkTarget(a,this._objects[d],c)){this.relatedTarget=this._objects[d];b=this._objects[d];break}return b},getPointer:function(a,b,c){c||(c=this.upperCanvasEl);a=e(a,c);var d=c.getBoundingClientRect();a.x-=this._offset.left;a.y-=this._offset.top;b||(a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform)));0===d.width||0===d.height?c=b=1:(b=c.width/
d.width,c=c.height/d.height);return{x:a.x*b,y:a.y*c}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=
this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=
this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0});a.width=b;a.height=c;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},
setActiveObject:function(a,b){this._setActiveObject(a);this.renderAll();this.fire("object:selected",{target:a,e:b});a.fire("selected",{e:b});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",
!0)},setActiveGroup:function(a,b){this._setActiveGroup(a);a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;b<c;b++)a[b].set("active",!1);
this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();b&&this.fire("before:selection:cleared",{target:b,e:a});this.deactivateAll();b&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var b=this.getActiveGroup();b?this._drawGroupControls(a,b):this._drawObjectsControls(a)},_drawGroupControls:function(a,b){b._renderControls(a)},_drawObjectsControls:function(a){for(var b=0,
c=this._objects.length;b<c;++b)this._objects[b]&&this._objects[b].active&&(this._objects[b]._renderControls(a),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[b])}});for(var g in fabric.StaticCanvas)"prototype"!==g&&(fabric.Canvas[g]=fabric.StaticCanvas[g]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},a=fabric.util.addListener,d=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();a(fabric.window,"resize",this._onResize);a(this.upperCanvasEl,"mousedown",this._onMouseDown);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"mousewheel",this._onMouseWheel);
a(this.upperCanvasEl,"touchstart",this._onMouseDown);a(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof Event&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=
this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){d(fabric.window,"resize",this._onResize);d(this.upperCanvasEl,"mousedown",this._onMouseDown);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"mousewheel",
this._onMouseWheel);d(this.upperCanvasEl,"touchstart",this._onMouseDown);d(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof Event&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,
b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onMouseDown:function(c){this.__onMouseDown(c);a(fabric.document,"touchend",this._onMouseUp);a(fabric.document,"touchmove",this._onMouseMove);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"touchmove",this._onMouseMove);
"touchstart"===c.type?d(this.upperCanvasEl,"mousedown",this._onMouseDown):(a(fabric.document,"mouseup",this._onMouseUp),a(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(c){this.__onMouseUp(c);d(fabric.document,"mouseup",this._onMouseUp);d(fabric.document,"touchend",this._onMouseUp);d(fabric.document,"mousemove",this._onMouseMove);d(fabric.document,"touchmove",this._onMouseMove);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"touchmove",this._onMouseMove);
if("touchend"===c.type){var b=this;setTimeout(function(){a(b.upperCanvasEl,"mousedown",b._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var d=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==d)||!a&&d||!a&&!d&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},
__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else{this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var d=this._shouldRender(b,this.getPointer(a));this._maybeGroupObjects(a);b&&(b.isMoving=!1);d&&this.renderAll();this._handleCursorAndEvent(a,b)}},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var d=this;setTimeout(function(){d._setCursorFromEvent(a,b)},
50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform.target;a._scaling&&(a._scaling=!1);a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;
a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);var b=fabric.util.invertTransform(this.viewportTransform),b=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseDown(b);this.fire("mouse:down",{e:a})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=
fabric.util.invertTransform(this.viewportTransform),b=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:a})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a})},__onMouseDown:function(a){if(("which"in a?1===a.which:1===a.button)||fabric.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);
else if(!this._currentTransform){var b=this.findTarget(a),d=this.getPointer(a,!0);this._previousPointer=d;var f=this._shouldRender(b,d),e=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,d):e&&(this._handleGrouping(a,b),b=this.getActiveGroup());b&&b.selectable&&!e&&(this._beforeTransform(a,b),this._setupCurrentTransform(a,b));f&&this.renderAll();this.fire("mouse:down",{target:b,e:a});b&&b.fire("mousedown",{e:a})}},_beforeTransform:function(a,b){this.stateful&&b.saveState();
if(b._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,d){this.deactivateAllWithDispatch(a);b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:d.x,ey:d.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;
var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(a){var b,d;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);
else{var f=this._groupSelector;f?(d=this.getPointer(a,!0),f.left=d.x-f.ex,f.top=d.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),!b||b&&!b.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,b));this.fire("mouse:move",{target:b,e:a});b&&b.fire("mousemove",{e:a})}},_transformObject:function(a){var b=this.getPointer(a),d=this._currentTransform;d.reset=!1;d.target.isMoving=!0;this._beforeScaleTransform(a,d);this._performTransformAction(a,
d,b);this.renderAll()},_performTransformAction:function(a,b,d){var f=d.x;d=d.y;var e=b.target,l=b.action;"rotate"===l?(this._rotateObject(f,d),this._fire("rotating",e,a)):"scale"===l?(this._onScale(a,b,f,d),this._fire("scaling",e,a)):"scaleX"===l?(this._scaleObject(f,d,"x"),this._fire("scaling",e,a)):"scaleY"===l?(this._scaleObject(f,d,"y"),this._fire("scaling",e,a)):(this._translateObject(f,d),this._fire("moving",e,a),this.setCursor(this.moveCursor))},_fire:function(a,b,d){this.fire("object:"+a,
{target:b,e:d});b.fire(a,{e:d})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var d=this._shouldCenterTransform(a,b.target);if(d&&("center"!==b.originX||"center"!==b.originY)||!d&&"center"===b.originX&&"center"===b.originY)this._resetCurrentTransform(a),b.reset=!0}},_onScale:function(a,b,d,f){!a.shiftKey&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(a,b.target),b.currentAction=
"scaleEqually",this._scaleObject(d,f,"equally")):(b.currentAction="scale",this._scaleObject(d,f))},_setCursorFromEvent:function(a,b){if(b&&b.selectable){var d=this.getActiveGroup();(d=b._findTargetCorner&&(!d||!d.contains(b))&&b._findTargetCorner(this.getPointer(a,!0)))?this._setCornerCursor(d,b):this.setCursor(b.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),!1;return!0},_setCornerCursor:function(a,b){if(a in e)this.setCursor(this._getRotatedCornerCursor(a,b));else if("mtr"===
a&&b.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(a,b){var d=Math.round(b.getAngle()%360/45);0>d&&(d+=8);d+=e[a];return this.cursorMap[d%8]}})})();
(function(){var e=Math.min,a=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,c){var b=this.getActiveObject();return a.shiftKey&&(this.getActiveGroup()||b&&b!==c)&&this.selection},_handleGrouping:function(a,c){if(c===this.getActiveGroup()&&(c=this.findTarget(a,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,a):this._createActiveGroup(c,a);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(a,c){var b=this.getActiveGroup();
if(b.contains(a)){if(b.removeWithUpdate(a),this._resetObjectTransform(b),a.set("active",!1),1===b.size()){this.discardActiveGroup(c);this.setActiveObject(b.item(0));return}}else b.addWithUpdate(a),this._resetObjectTransform(b);this.fire("selection:created",{target:b,e:c});b.set("active",!0)},_createActiveGroup:function(a,c){if(this._activeObject&&a!==this._activeObject){var b=this._createGroup(a);b.addWithUpdate();this.setActiveGroup(b);this._activeObject=null;this.fire("selection:created",{target:b,
e:c})}a.set("active",!0)},_createGroup:function(a){var c=this.getObjects();a=c.indexOf(this._activeObject)<c.indexOf(a)?[this._activeObject,a]:[a,this._activeObject];return new fabric.Group(a,{originX:"center",originY:"center",canvas:this})},_groupSelectedObjects:function(a){var c=this._collectObjects();1===c.length?this.setActiveObject(c[0],a):1<c.length&&(c=new fabric.Group(c.reverse(),{originX:"center",originY:"center",canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,a),c.saveCoords(),this.fire("selection:created",
{target:c}),this.renderAll())},_collectObjects:function(){var d=[],c;c=this._groupSelector.ex;for(var b=this._groupSelector.ey,g=c+this._groupSelector.left,f=b+this._groupSelector.top,h=new fabric.Point(e(c,g),e(b,f)),l=new fabric.Point(a(c,g),a(b,f)),b=c===g&&b===f,g=this._objects.length;g--&&!((c=this._objects[g])&&c.selectable&&c.visible&&(c.intersectsWithRect(h,l)||c.isContainedWithinRect(h,l)||c.containsPoint(h)||c.containsPoint(l))&&(c.set("active",!0),d.push(c),b)););return d},_maybeGroupObjects:function(a){this.selection&&
this._groupSelector&&this._groupSelectedObjects(a);if(a=this.getActiveGroup())a.setObjectsCoords().setCoords(),a.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var a=e.format||"png",d=e.quality||1,c=e.multiplier||1;e={left:e.left,top:e.top,width:e.width,height:e.height};return 1!==c?this.__toDataURLWithMultiplier(a,d,e,c):this.__toDataURL(a,d,e)},__toDataURL:function(e,a,d){this.renderAll(!0);var c=this.upperCanvasEl||this.lowerCanvasEl;d=this.__getCroppedCanvas(c,d);"jpg"===e&&(e="jpeg");e=fabric.StaticCanvas.supports("toDataURLWithQuality")?(d||c).toDataURL("image/"+
e,a):(d||c).toDataURL("image/"+e);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return e},__getCroppedCanvas:function(e,a){var d,c;if("left"in a||"top"in a||"width"in a||"height"in a)d=fabric.util.createCanvasElement(),c=d.getContext("2d"),d.width=a.width||this.width,d.height=a.height||this.height,c.drawImage(e,-a.left||0,-a.top||0);return d},__toDataURLWithMultiplier:function(e,a,d,c){var b=this.getWidth(),g=this.getHeight(),f=b*c,h=g*c,l=this.getActiveObject(),k=this.getActiveGroup(),
m=this.contextTop||this.contextContainer;1<c&&this.setWidth(f).setHeight(h);m.scale(c,c);d.left&&(d.left*=c);d.top&&(d.top*=c);d.width?d.width*=c:1>c&&(d.width=f);d.height?d.height*=c:1>c&&(d.height=h);k?this._tempRemoveBordersControlsFromGroup(k):l&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);e=this.__toDataURL(e,a,d);this.width=b;this.height=g;m.scale(1/c,1/c);this.setWidth(b).setHeight(g);k?this._restoreBordersControlsOnGroup(k):l&&this.setActiveObject&&this.setActiveObject(l);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return e},toDataURLWithMultiplier:function(e,a,d){return this.toDataURL({format:e,multiplier:a,quality:d})},_tempRemoveBordersControlsFromGroup:function(e){e.origHasControls=e.hasControls;e.origBorderColor=e.borderColor;e.hasControls=!0;e.borderColor="rgba(0,0,0,0)";e.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(e){e.hideControls=e.origHideControls;
e.borderColor=e.origBorderColor;e.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,a,d){return this.loadFromJSON(e,a,d)},loadFromJSON:function(e,a,d){if(e){var c="string"===typeof e?JSON.parse(e):e;this.clear();var b=this;this._enlivenObjects(c.objects,function(){b._setBgOverlay(c,a)},d);return this}},_setBgOverlay:function(e,a){var d=this,c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var b=function(){c.backgroundImage&&
c.overlayImage&&c.backgroundColor&&c.overlayColor&&(d.renderAll(),a&&a())};this.__setBgOverlay("backgroundImage",e.backgroundImage,c,b);this.__setBgOverlay("overlayImage",e.overlayImage,c,b);this.__setBgOverlay("backgroundColor",e.background,c,b);this.__setBgOverlay("overlayColor",e.overlay,c,b);b()}else a&&a()},__setBgOverlay:function(e,a,d,c){var b=this;if(a)if("backgroundImage"===e||"overlayImage"===e)fabric.Image.fromObject(a,function(a){b[e]=a;d[e]=!0;c&&c()});else this["set"+fabric.util.string.capitalize(e,
!0)](a,function(){d[e]=!0;c&&c()});else d[e]=!0},_enlivenObjects:function(e,a,d){var c=this;if(e&&0!==e.length){var b=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(e,function(d){d.forEach(function(a,b){c.insertAt(a,b,!0)});c.renderOnAddRemove=b;a&&a()},null,d)}else a&&a()},_toDataURL:function(e,a){this.clone(function(d){a(d.toDataURL(e))})},_toDataURLWithMultiplier:function(e,a,d){this.clone(function(c){d(c.toDataURLWithMultiplier(e,a))})},clone:function(e,a){var d=JSON.stringify(this.toJSON(a));
this.cloneWithoutData(function(a){a.loadFromJSON(d,function(){e&&e(a)})})},cloneWithoutData:function(e){var a=fabric.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var d=new fabric.Canvas(a);d.clipTo=this.clipTo;this.backgroundImage?(d.setBackgroundImage(this.backgroundImage.src,function(){d.renderAll();e&&e(d)}),d.backgroundImageOpacity=this.backgroundImageOpacity,d.backgroundImageStretch=this.backgroundImageStretch):e&&e(d)}});
(function(){var e=fabric.util.degreesToRadians,a=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(a,c){if(!this.isDrawingMode&&a.touches&&2===a.touches.length&&"gesture"===c.gesture){var b=this.findTarget(a);"undefined"!==typeof b&&(this.onBeforeScaleRotate(b),this._rotateObjectByAngle(c.rotation),this._scaleObjectBy(c.scale));this.fire("touch:gesture",{target:b,e:a,self:c})}},__onDrag:function(a,c){this.fire("touch:drag",{e:a,self:c})},
__onOrientationChange:function(a,c){this.fire("touch:orientation",{e:a,self:c})},__onShake:function(a,c){this.fire("touch:shake",{e:a,self:c})},_scaleObjectBy:function(a,c){var b=this._currentTransform,e=b.target,f=e.get("lockScalingX"),h=e.get("lockScalingY");f&&h||(e._scaling=!0,c?"x"!==c||e.get("lockUniScaling")?"y"!==c||e.get("lockUniScaling")||h||e.set("scaleY",b.scaleY*a):f||e.set("scaleX",b.scaleX*a):(f||e.set("scaleX",b.scaleX*a),h||e.set("scaleY",b.scaleY*a)))},_rotateObjectByAngle:function(d){var c=
this._currentTransform;c.target.get("lockRotation")||(c.target.angle=a(e(d)+c.theta))}})})();
(function(e){var a=e.fabric||(e.fabric={});e=a.util.object.extend;var d=a.util.toFixed,c=a.util.string.capitalize,b=a.util.degreesToRadians,g=a.StaticCanvas.supports("setLineDash");a.Object||(a.Object=a.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,
centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,
lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,dirty:!0,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(b){!b.fill||!b.fill.colorStops||b.fill instanceof a.Gradient||this.set("fill",new a.Gradient(b.fill))},_initPattern:function(b){!b.fill||
!b.fill.source||b.fill instanceof a.Pattern||this.set("fill",new a.Pattern(b.fill));!b.stroke||!b.stroke.source||b.stroke instanceof a.Pattern||this.set("stroke",new a.Pattern(b.stroke))},_initClipping:function(b){b.clipTo&&"string"===typeof b.clipTo&&(b=a.util.getFunctionBody(b.clipTo),"undefined"!==typeof b&&(this.clipTo=new Function("ctx",b)))},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(a,c){this.group&&
this.group.transform(a,c);a.globalAlpha=this.opacity;var d=c?this._getLeftTopCoords():this.getCenterPoint();a.translate(d.x,d.y);a.rotate(b(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(b){var c=a.Object.NUM_FRACTION_DIGITS,c={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,c),top:d(this.top,c),width:d(this.width,c),height:d(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&
this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,c),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,c),scaleX:d(this.scaleX,c),scaleY:d(this.scaleY,c),angle:d(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),
backgroundColor:this.backgroundColor};this.includeDefaultValues||(c=this._removeDefaultValues(c));a.util.populateWithProperties(this,c,b);return c},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(b){var c=a.util.getKlass(b.type).prototype;c.stateProperties.forEach(function(a){b[a]===c[a]&&delete b[a]});return b},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,
b){"object"===typeof a?this._setObject(a):(this[a]!==b&&(this.submitBoundsAsDirtyRect(),this.dirty=!0),"function"===typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b));return this},_set:function(b,c){if("scaleX"===b||"scaleY"===b)c=this._constrainScale(c);"scaleX"===b&&0>c?(this.flipX=!this.flipX,c*=-1):"scaleY"===b&&0>c?(this.flipY=!this.flipY,c*=-1):"width"===b||"height"===b?this.minScaleLimit=d(Math.min(0.1,1/Math.max(this.width,this.height)),2):"shadow"!==b||!c||c instanceof a.Shadow||
(c=new a.Shadow(c));this[b]=c;return this},toggle:function(a){var b=this.get(a);"boolean"===typeof b&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(b,c){this.dirty=!1;if(0!==this.width&&0!==this.height&&this.visible){b.save();this._setupFillRule(b);this._transform(b,c);this._setStrokeStyles(b);this._setFillStyles(b);var d=
this.transformMatrix;d&&this.group&&(b.translate(-this.group.width/2,-this.group.height/2),b.transform(d[0],d[1],d[2],d[3],d[4],d[5]));this._setShadow(b);this.clipTo&&a.util.clipContext(this,b);this._render(b,c);this.clipTo&&b.restore();this._removeShadow(b);this._restoreFillRule(b);b.restore()}},_transform:function(a,b){var c=this.transformMatrix;c&&!this.group&&a.setTransform(c[0],c[1],c[2],c[3],c[4],c[5]);b||this.transform(a)},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,
a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill)},_renderControls:function(c,d){var e=this.getViewportTransform();c.save();if(this.active&&!d){var g;this.group&&(g=a.util.transformPoint(this.group.getCenterPoint(),e),c.translate(g.x,g.y),c.rotate(b(this.group.angle)));g=a.util.transformPoint(this.getCenterPoint(),
e,null!=this.group);this.group&&(g.x*=this.group.scaleX,g.y*=this.group.scaleY);c.translate(g.x,g.y);c.rotate(b(this.angle));this.drawBorders(c);this.drawControls(c)}c.restore()},_setShadow:function(a){this.shadow&&(a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&(this.fill.toLive&&
(a.save(),a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)),"destination-over"===this.fillRule?a.fill("evenodd"):a.fill(),this.fill.toLive&&a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g?(a.setLineDash(this.strokeDashArray),this._stroke&&
this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):this._stroke?this._stroke(a):a.stroke(),this._removeShadow(a),a.restore())},clone:function(b,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),b):new a.Object(this.toObject(c))},cloneAsImage:function(b){var c=this.toDataURL();a.util.loadImage(c,function(c){b&&b(new a.Image(c))});return this},toDataURL:function(b){b||(b={});var c=a.util.createCanvasElement(),d=this.getBoundingRect();
c.width=d.width;c.height=d.height;a.util.wrapElement(c,"div");d=new a.Canvas(c);"jpg"===b.format&&(b.format="jpeg");"jpeg"===b.format&&(d.backgroundColor="#fff");var e={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new a.Point(c.width/2,c.height/2),"center","center");c=this.canvas;d.add(this);b=d.toDataURL(b);this.set(e).setCoords();this.canvas=c;d.dispose();return b},isType:function(a){return this.type===a},complexity:function(){return 0},
toJSON:function(a){return this.toObject(a)},setGradient:function(b,c){c||(c={});var d={colorStops:[]};d.type=c.type||(c.r1||c.r2?"radial":"linear");d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2)d.coords.r1=c.r1,d.coords.r2=c.r2;for(var e in c.colorStops){var g=new a.Color(c.colorStops[e]);d.colorStops.push({offset:e,color:g.toRgb(),opacity:g.getAlpha()})}return this.set(b,a.Gradient.forObject(this,d))},setPatternFill:function(b){return this.set("fill",new a.Pattern(b))},setShadow:function(b){return this.set("shadow",
b?new a.Shadow(b):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;b&&this._setOriginToCenter();this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},
getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var c=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:b.x-c.x,y:b.y-c.y}},submitBoundsAsDirtyRect:function(){if("undefined"!==typeof this.canvas){var a=this.getCoords();this.canvas.addDirtyRect(a)}return this},getCoords:function(){var a,b,c,d;"left"===this.originX&&(a=this.left||0,b=(this.left||0)+(this.width+1)*this.scaleX);"right"===this.originX&&(a=(this.left||0)-(this.width+1)*this.scaleX,b=this.left||0);"center"===
this.originX&&(a=(this.left||0)-(this.width+1)*this.scaleX/2,b=(this.left||0)+(this.width+1)*this.scaleX/2);"top"===this.originY&&(c=this.top||0,d=(this.top||0)+(this.height+1)*this.scaleY);"center"===this.originY&&(c=(this.top||0)-(this.height+1)*this.scaleY/2,d=(this.top||0)+(this.height+1)*this.scaleY/2);"bottom"===this.originY&&(c=(this.top||0)-(this.height+1)*this.scaleY,d=this.top||0);return{x1:a,y1:c,x2:b,y2:d}},_setupFillRule:function(a){this.fillRule&&(this._prevFillRule=a.globalCompositeOperation,
a.globalCompositeOperation=this.fillRule)},_restoreFillRule:function(a){this.fillRule&&this._prevFillRule&&(a.globalCompositeOperation=this._prevFillRule)}}),a.util.createAccessors(a.Object),a.Object.prototype.rotate=a.Object.prototype.setAngle,e(a.Object.prototype,a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.__uid=0)})("undefined"!==typeof exports?exports:this);
(function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(a,d,c){var b=a.x,g=a.y,f=this.stroke?this.strokeWidth:0;"left"===d?b=a.x+(this.getWidth()+f*this.scaleX)/2:"right"===d&&(b=a.x-(this.getWidth()+f*this.scaleX)/2);"top"===c?g=a.y+(this.getHeight()+f*this.scaleY)/2:"bottom"===c&&(g=a.y-(this.getHeight()+f*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(b,g),a,e(this.angle))},translateToOriginPoint:function(a,
d,c){var b=a.x,g=a.y,f=this.stroke?this.strokeWidth:0;"left"===d?b=a.x-(this.getWidth()+f*this.scaleX)/2:"right"===d&&(b=a.x+(this.getWidth()+f*this.scaleX)/2);"top"===c?g=a.y-(this.getHeight()+f*this.scaleY)/2:"bottom"===c&&(g=a.y+(this.getHeight()+f*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(b,g),a,e(this.angle))},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,
d){var c=this.getCenterPoint();return this.translateToOriginPoint(c,a,d)},toLocalPoint:function(a,d,c){var b=this.getCenterPoint(),g=this.stroke?this.strokeWidth:0;d&&c?(d="left"===d?b.x-(this.getWidth()+g*this.scaleX)/2:"right"===d?b.x+(this.getWidth()+g*this.scaleX)/2:b.x,c="top"===c?b.y-(this.getHeight()+g*this.scaleY)/2:"bottom"===c?b.y+(this.getHeight()+g*this.scaleY)/2:b.y):(d=this.left,c=this.top);return fabric.util.rotatePoint(new fabric.Point(a.x,a.y),b,-e(this.angle)).subtractEquals(new fabric.Point(d,
c))},setPositionByOrigin:function(a,d,c){a=this.translateToCenterPoint(a,d,c);a=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(a){var d=e(this.angle),c=this.getWidth()/2,b=Math.cos(d)*c,c=Math.sin(d)*c,g=this.getWidth(),f=Math.cos(d)*g,d=Math.sin(d)*g;"center"===this.originX&&"left"===a||"right"===this.originX&&"center"===a?(this.left-=b,this.top-=c):"left"===this.originX&&"center"===a||"center"===this.originX&&"right"===
a?(this.left+=b,this.top+=c):"left"===this.originX&&"right"===a?(this.left+=f,this.top+=d):"right"===this.originX&&"left"===a&&(this.left-=f,this.top-=d);this.setCoords();this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);
this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();
(function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(a,d){var c=this.oCoords,b=new fabric.Point(c.tl.x,c.tl.y),e=new fabric.Point(c.tr.x,c.tr.y),f=new fabric.Point(c.bl.x,c.bl.y),c=new fabric.Point(c.br.x,c.br.y);return"Intersection"===fabric.Intersection.intersectPolygonRectangle([b,e,c,f],a,d).status},intersectsWithObject:function(a){function d(a){return{tl:new fabric.Point(a.tl.x,a.tl.y),tr:new fabric.Point(a.tr.x,
a.tr.y),bl:new fabric.Point(a.bl.x,a.bl.y),br:new fabric.Point(a.br.x,a.br.y)}}var c=d(this.oCoords);a=d(a.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonPolygon([c.tl,c.tr,c.br,c.bl],[a.tl,a.tr,a.br,a.bl]).status},isContainedWithinObject:function(a){var d=a.getBoundingRect();a=new fabric.Point(d.left,d.top);d=new fabric.Point(d.left+d.width,d.top+d.height);return this.isContainedWithinRect(a,d)},isContainedWithinRect:function(a,d){var c=this.getBoundingRect();return c.left>=
a.x&&c.left+c.width<=d.x&&c.top>=a.y&&c.top+c.height<=d.y},containsPoint:function(a){var d=this._getImageLines(this.oCoords);a=this._findCrossPoints(a,d);return 0!==a&&1===a%2},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,d){var c,b,e,f=0,h;for(h in d)if(e=d[h],!(e.o.y<a.y&&e.d.y<a.y||e.o.y>=a.y&&e.d.y>=a.y)&&(e.o.x===e.d.x&&e.o.x>=a.x?c=e.o.x:(c=(e.d.y-e.o.y)/(e.d.x-e.o.x),b=a.y-
0*a.x,e=e.o.y-c*e.o.x,c=-(b-e)/(0-c)),c>=a.x&&(f+=1),2===f))break;return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],d=fabric.util.array.min(a),a=fabric.util.array.max(a),a=Math.abs(d-a),c=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],b=
fabric.util.array.min(c),c=fabric.util.array.max(c),c=Math.abs(b-c);return{left:d,top:b,width:a,height:c}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){a=this._constrainScale(a);0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1);this.scaleY=this.scaleX=a;this.setCoords();return this},scaleToWidth:function(a){var d=
this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/d)},scaleToHeight:function(a){var d=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/d)},setCoords:function(){var a=1<this.strokeWidth?this.strokeWidth:0,d=e(this.angle),c=this.getViewportTransform(),b=function(a){return fabric.util.transformPoint(a,c)},g=this.width,f=this.height,h="round"===this.strokeLineCap||"square"===this.strokeLineCap,l="line"===this.type&&1===this.width,k="line"===this.type&&
1===this.height,m=h&&k||"line"!==this.type,h=h&&l||"line"!==this.type;l?g=a:k&&(f=a);m&&(g+=a);h&&(f+=a);this.currentWidth=g*this.scaleX;this.currentHeight=f*this.scaleY;0>this.currentWidth&&(this.currentWidth=Math.abs(this.currentWidth));var f=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),a=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),g=Math.cos(a+d)*f,f=Math.sin(a+d)*f,m=Math.sin(d),h=Math.cos(d),l=this.getCenterPoint(),
n=new fabric.Point(this.currentWidth,this.currentHeight),p=new fabric.Point(l.x-g,l.y-f),q=new fabric.Point(p.x+n.x*h,p.y+n.x*m),t=new fabric.Point(p.x-n.y*m,p.y+n.y*h),x=new fabric.Point(p.x+n.x/2*h,p.y+n.x/2*m),g=b(p),f=b(q),l=b(new fabric.Point(q.x-n.y*m,q.y+n.y*h)),k=b(t),p=b(new fabric.Point(p.x-n.y/2*m,p.y+n.y/2*h)),s=b(x),q=b(new fabric.Point(q.x-n.y/2*m,q.y+n.y/2*h)),m=b(new fabric.Point(t.x+n.x/2*h,t.y+n.x/2*m)),b=b(new fabric.Point(x.x,x.y)),h=Math.cos(a+d)*this.padding*Math.sqrt(2),d=Math.sin(a+
d)*this.padding*Math.sqrt(2),g=g.add(new fabric.Point(-h,-d)),f=f.add(new fabric.Point(d,-h)),l=l.add(new fabric.Point(h,d)),k=k.add(new fabric.Point(-d,h)),p=p.add(new fabric.Point((-h-d)/2,(-d+h)/2)),s=s.add(new fabric.Point((d-h)/2,-(d+h)/2)),q=q.add(new fabric.Point((d+h)/2,(d-h)/2)),m=m.add(new fabric.Point((h-d)/2,(h+d)/2)),b=b.add(new fabric.Point((d-h)/2,-(d+h)/2));this.oCoords={tl:g,tr:f,br:l,bl:k,ml:p,mt:s,mr:q,mb:m,mtr:b};this._setCornerCoords&&this._setCornerCoords();return this}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(e){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e);return this},bringForward:function(e){this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e);return this},moveTo:function(e){this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e);return this}});
fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var e=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",a=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",d=this.strokeWidth?this.strokeWidth:"0",c=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",a,"; stroke-width: ",d,"; stroke-dasharray: ",c,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?
this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",e,"; opacity: ","undefined"!==typeof this.opacity?this.opacity:"1",";",this.shadow&&"text"!==this.type?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){var e=fabric.util.toFixed,a=this.getAngle(),d=this.getViewportTransform(),c=fabric.util.transformPoint(this.getCenterPoint(),d),b=fabric.Object.NUM_FRACTION_DIGITS,c=
"translate("+e(c.x,b)+" "+e(c.y,b)+")",a=0!==a?" rotate("+e(a,b)+")":"",e=1===this.scaleX&&1===this.scaleY&&1===d[0]&&1===d[3]?"":" scale("+e(this.scaleX*d[0],b)+" "+e(this.scaleY*d[3],b)+")";return[c,a,e,this.flipX?"matrix(-1 0 0 1 0 0) ":"",this.flipY?"matrix(1 0 0 -1 0 0)":""].join("")},_createBaseSVGMarkup:function(){var e=[];this.fill&&this.fill.toLive&&e.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&e.push(this.stroke.toSVG(this,!1));this.shadow&&e.push(this.shadow.toSVG(this));
return e}});fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(e){return this.get(e)!==this.originalState[e]},this)},saveState:function(e){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);e&&e.stateProperties&&e.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var d=a.x;a=a.y;var c,b;for(b in this.oCoords)if(this.isControlVisible(b)&&("mtr"!==b||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==b&&"mr"!==b&&"mb"!==b&&"ml"!==b)&&(c=this._getImageLines(this.oCoords[b].corner),c=this._findCrossPoints({x:d,y:a},c),0!==c&&1===c%2))return this.__corner=b;
return!1},_setCornerCoords:function(){var a=this.oCoords,d=e(this.angle),c=e(45-this.angle),b=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,g=b*Math.cos(c),c=b*Math.sin(c),b=Math.sin(d),d=Math.cos(d);a.tl.corner={tl:{x:a.tl.x-c,y:a.tl.y-g},tr:{x:a.tl.x+g,y:a.tl.y-c},bl:{x:a.tl.x-g,y:a.tl.y+c},br:{x:a.tl.x+c,y:a.tl.y+g}};a.tr.corner={tl:{x:a.tr.x-c,y:a.tr.y-g},tr:{x:a.tr.x+g,y:a.tr.y-c},br:{x:a.tr.x+c,y:a.tr.y+g},bl:{x:a.tr.x-g,y:a.tr.y+c}};a.bl.corner={tl:{x:a.bl.x-c,y:a.bl.y-g},bl:{x:a.bl.x-g,y:a.bl.y+
c},br:{x:a.bl.x+c,y:a.bl.y+g},tr:{x:a.bl.x+g,y:a.bl.y-c}};a.br.corner={tr:{x:a.br.x+g,y:a.br.y-c},bl:{x:a.br.x-g,y:a.br.y+c},br:{x:a.br.x+c,y:a.br.y+g},tl:{x:a.br.x-c,y:a.br.y-g}};a.ml.corner={tl:{x:a.ml.x-c,y:a.ml.y-g},tr:{x:a.ml.x+g,y:a.ml.y-c},bl:{x:a.ml.x-g,y:a.ml.y+c},br:{x:a.ml.x+c,y:a.ml.y+g}};a.mt.corner={tl:{x:a.mt.x-c,y:a.mt.y-g},tr:{x:a.mt.x+g,y:a.mt.y-c},bl:{x:a.mt.x-g,y:a.mt.y+c},br:{x:a.mt.x+c,y:a.mt.y+g}};a.mr.corner={tl:{x:a.mr.x-c,y:a.mr.y-g},tr:{x:a.mr.x+g,y:a.mr.y-c},bl:{x:a.mr.x-
g,y:a.mr.y+c},br:{x:a.mr.x+c,y:a.mr.y+g}};a.mb.corner={tl:{x:a.mb.x-c,y:a.mb.y-g},tr:{x:a.mb.x+g,y:a.mb.y-c},bl:{x:a.mb.x-g,y:a.mb.y+c},br:{x:a.mb.x+c,y:a.mb.y+g}};a.mtr.corner={tl:{x:a.mtr.x-c+b*this.rotatingPointOffset,y:a.mtr.y-g-d*this.rotatingPointOffset},tr:{x:a.mtr.x+g+b*this.rotatingPointOffset,y:a.mtr.y-c-d*this.rotatingPointOffset},bl:{x:a.mtr.x-g+b*this.rotatingPointOffset,y:a.mtr.y+c-d*this.rotatingPointOffset},br:{x:a.mtr.x+c+b*this.rotatingPointOffset,y:a.mtr.y+g-d*this.rotatingPointOffset}}},
drawBorders:function(a){if(!this.hasBorders)return this;var d=this.padding,c=2*d,b=this.getViewportTransform();a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var e=1/this._constrainScale(this.scaleX),f=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;var h=this.getWidth(),l=this.getHeight(),k=1<this.strokeWidth?this.strokeWidth:0,m="round"===this.strokeLineCap||"square"===this.strokeLineCap,n="line"===this.type&&1===this.width,
p="line"===this.type&&1===this.height,q=m&&p||"line"!==this.type,m=m&&n||"line"!==this.type;n?h=k/e:p&&(l=k/f);q&&(h+=k/e);m&&(l+=k/f);e=fabric.util.transformPoint(new fabric.Point(h,l),b,!0);b=e.x;e=e.y;this.group&&(b*=this.group.scaleX,e*=this.group.scaleY);a.strokeRect(~~(-(b/2)-d)-0.5,~~(-(e/2)-d)-0.5,~~(b+c)+1,~~(e+c)+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(d=(-e-2*d)/2,a.beginPath(),a.moveTo(0,d),a.lineTo(0,d-this.rotatingPointOffset),
a.closePath(),a.stroke());a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;var d=this.cornerSize,c=d/2,b=this.getViewportTransform(),e=1<this.strokeWidth?this.strokeWidth:0,f=this.width,h=this.height,l="round"===this.strokeLineCap||"square"===this.strokeLineCap,k="line"===this.type&&1===this.width,m="line"===this.type&&1===this.height,n=l&&m||"line"!==this.type,l=l&&k||"line"!==this.type;k?f=e:m&&(h=e);n&&(f+=e);l&&(h+=e);f*=this.scaleX;h*=this.scaleY;e=fabric.util.transformPoint(new fabric.Point(f,
h),b,!0);b=e.x;e=e.y;f=-(b/2);h=-(e/2);k=this.padding;d=c-d;m=this.transparentCorners?"strokeRect":"fillRect";a.save();a.lineWidth=1;a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",a,m,f-c-k,h-c-k);this._drawControl("tr",a,m,f+b-c+k,h-c-k);this._drawControl("bl",a,m,f-c-k,h+e+d+k);this._drawControl("br",a,m,f+b+d+k,h+e+d+k);this.get("lockUniScaling")||(this._drawControl("mt",a,m,f+b/2-c,h-c-k),this._drawControl("mb",a,m,
f+b/2-c,h+e+d+k),this._drawControl("mr",a,m,f+b+d+k,h+e/2-c),this._drawControl("ml",a,m,f-c-k,h+e/2-c));this.hasRotatingPoint&&this._drawControl("mtr",a,m,f+b/2-c,h-this.rotatingPointOffset-this.cornerSize/2-k);a.restore();return this},_drawControl:function(a,d,c,b,e){var f=this.cornerSize;this.isControlVisible(a)&&("undefined"!==typeof G_vmlCanvasManager||this.transparentCorners||d.clearRect(b,e,f,f),d[c](b,e,f,f))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,
d){this._getControlsVisibility()[a]=d;return this},setControlsVisibility:function(a){a||(a={});for(var d in a)this.setControlVisible(d,a[d]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,a){a=a||{};var d=function(){},c=a.onComplete||d,b=a.onChange||d,g=this;fabric.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){e.set("left",a);g.renderAll();b()},onComplete:function(){e.setCoords();c()}});return this},fxCenterObjectV:function(e,a){a=a||{};var d=function(){},c=a.onComplete||d,b=a.onChange||d,g=this;fabric.util.animate({startValue:e.get("top"),
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(a){e.set("top",a);g.renderAll();b()},onComplete:function(){e.setCoords();c()}});return this},fxRemove:function(e,a){a=a||{};var d=function(){},c=a.onComplete||d,b=a.onChange||d,g=this;fabric.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",!1)},onChange:function(a){e.set("opacity",a);g.renderAll();b()},onComplete:function(){g.remove(e);c()}});return this}});
fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"===typeof arguments[0]){var e=[],a,d;for(a in arguments[0])e.push(a);for(var c=0,b=e.length;c<b;c++)a=e[c],d=c!==b-1,this._animate(a,arguments[0][a],arguments[1],d)}else this._animate.apply(this,arguments);return this},_animate:function(e,a,d,c){var b=this,g;a=a.toString();d=d?fabric.util.object.clone(d):{};~e.indexOf(".")&&(g=e.split("."));var f=g?this.get(g[0])[g[1]]:this.get(e);"from"in d||(d.from=f);
a=~a.indexOf("=")?f+parseFloat(a.replace("=","")):parseFloat(a);fabric.util.animate({startValue:d.from,endValue:a,byValue:d.by,easing:d.easing,duration:d.duration,abort:d.abort&&function(){return d.abort.call(b)},onChange:function(a){g?b[g[0]][g[1]]=a:b.set(e,a);c||d.onChange&&d.onChange()},onComplete:function(){c||(b.setCoords(),d.onComplete&&d.onComplete())}})}});
(function(e){function a(a,b){var c=a.origin,d=a.axis1,e=a.axis2,g=a.dimension,p=b.nearest,q=b.center,t=b.farthest;return function(){switch(this.get(c)){case p:return Math.min(this.get(d),this.get(e));case q:return Math.min(this.get(d),this.get(e))+0.5*this.get(g);case t:return Math.max(this.get(d),this.get(e))}}}var d=e.fabric||(e.fabric={}),c=d.util.object.extend,b={x1:1,x2:1,y1:1,y2:1},g=d.StaticCanvas.supports("setLineDash");d.Line?d.warn("fabric.Line is already defined"):(d.Line=d.util.createClass(d.Object,
{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1)||1;this.height=Math.abs(this.y2-this.y1)||1;this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,c){this[a]=c;"undefined"!==typeof b[a]&&this._setWidthHeight();
return this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a){a.beginPath();if(this.group&&"path-group"===this.group.type){var b=this.getCenterPoint();a.translate(b.x,b.y);this.transformMatrix||a.translate(-this.group.width/2,-this.group.height/2)}if(!this.strokeDashArray||
this.strokeDashArray&&g){var b=this.x1<=this.x2?-1:1,c=this.y1<=this.y2?-1:1;a.moveTo(1===this.width?0:b*this.width/2,1===this.height?0:c*this.height/2);a.lineTo(1===this.width?0:-1*b*this.width/2,1===this.height?0:-1*c*this.height/2)}a.lineWidth=this.strokeWidth;b=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=b},_renderDashedStroke:function(a){var b=this.x1<=this.x2?-1:1,c=this.y1<=this.y2?-1:1,b=1===this.width?0:b*this.width/2,c=1===this.height?
0:c*this.height/2;a.beginPath();d.util.drawDashedLine(a,b,c,-b,-c,this.strokeDashArray);a.closePath()},toObject:function(a){return c(this.callSuper("toObject",a),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),
d.Line.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),d.Line.fromElement=function(a,b){var e=d.parseAttributes(a,d.Line.ATTRIBUTE_NAMES);return new d.Line([e.x1||0,e.y1||0,e.x2||0,e.y2||0],c(e,b))},d.Line.fromObject=function(a){return new d.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=2*Math.PI,c=a.util.object.extend;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",radius:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0)},_set:function(a,c){this.callSuper("_set",a,c);"radius"===a&&this.setRadius(c);return this},toObject:function(a){return c(this.callSuper("toObject",a),{radius:this.get("radius")})},toSVG:function(a){var c=this._createBaseSVGMarkup();
c.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(c.join("")):c.join("")},_render:function(a,c){a.beginPath();a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity;a.arc(c?this.left:0,c?this.top:0,this.radius,0,d,!1);this._renderFill(a);this.stroke&&this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},
setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),a.Circle.fromElement=function(b,d){d||(d={});var f=a.parseAttributes(b,a.Circle.ATTRIBUTE_NAMES);if(!("radius"in f&&0<f.radius))throw Error("value of `r` attribute is required and can not be negative");"left"in f||(f.left=0);"top"in f||(f.top=0);"transformMatrix"in f||(f.left-=d.width?d.width/2:0,f.top-=d.height?d.height/
2:0);f=new a.Circle(c(f,d));f.cx=parseFloat(b.getAttribute("cx"))||0;f.cy=parseFloat(b.getAttribute("cy"))||0;return f},a.Circle.fromObject=function(b){return new a.Circle(b)})})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var c=this.width/2,b=this.height/2;a.beginPath();a.moveTo(-c,b);a.lineTo(0,-b);a.lineTo(c,b);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(d){var c=this.width/2,b=
this.height/2;d.beginPath();a.util.drawDashedLine(d,-c,b,0,-b,this.strokeDashArray);a.util.drawDashedLine(d,0,-b,c,b,this.strokeDashArray);a.util.drawDashedLine(d,c,b,-c,b,this.strokeDashArray);d.closePath()},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=this.width/2,e=this.height/2,b=[-b+" "+e,"0 "+-e,b+" "+e].join();c.push("<polygon ",'points="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(c.join("")):c.join("")},complexity:function(){return 1}}),
a.Triangle.fromObject=function(d){return new a.Triangle(d)})})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=2*Math.PI,c=a.util.object.extend;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0);this.set("width",2*this.get("rx"));this.set("height",2*this.get("ry"))},toObject:function(a){return c(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var c=
this._createBaseSVGMarkup();c.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(c.join("")):c.join("")},render:function(a,c){if(0!==this.rx&&0!==this.ry)return this.callSuper("render",a,c)},_render:function(a,c){a.beginPath();a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity;a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(c?this.left:0,c?this.top*this.rx/this.ry:0,this.rx,0,d,
!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),a.Ellipse.fromElement=function(b,d){d||(d={});var f=a.parseAttributes(b,a.Ellipse.ATTRIBUTE_NAMES);"left"in f||(f.left=0);"top"in f||(f.top=0);"transformMatrix"in f||(f.left-=d.width?d.width/2:0,f.top-=d.height?d.height/2:0);f=new a.Ellipse(c(f,d));f.cx=parseFloat(b.getAttribute("cx"))||0;f.cy=parseFloat(b.getAttribute("cy"))||0;return f},
a.Ellipse.fromObject=function(b){return new a.Ellipse(b)})})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Rect?console.warn("fabric.Rect is already defined"):(e=a.Object.prototype.stateProperties.concat(),e.push("rx","ry","x","y"),a.Rect=a.util.createClass(a.Object,{stateProperties:e,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy();this.x=a.x||0;this.y=a.y||0},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a){if(1===
this.width&&1===this.height)a.fillRect(0,0,1,1);else{var b=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,f=this.width,e=this.height,l=-f/2,k=-e/2,m=this.group&&"path-group"===this.group.type,n=0!==b||0!==d;a.beginPath();a.globalAlpha=m?a.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&m&&a.translate(this.width/2+this.x,this.height/2+this.y);!this.transformMatrix&&m&&a.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/
2+this.y);a.moveTo(l+b,k);a.lineTo(l+f-b,k);n&&a.bezierCurveTo(l+f-0.4477152502*b,k,l+f,k+0.4477152502*d,l+f,k+d);a.lineTo(l+f,k+e-d);n&&a.bezierCurveTo(l+f,k+e-0.4477152502*d,l+f-0.4477152502*b,k+e,l+f-b,k+e);a.lineTo(l+b,k+e);n&&a.bezierCurveTo(l+0.4477152502*b,k+e,l,k+e-0.4477152502*d,l,k+e-d);a.lineTo(l,k+d);n&&a.bezierCurveTo(l,k+0.4477152502*d,l+0.4477152502*b,k,l+b,k);a.closePath();this._renderFill(a);this._renderStroke(a)}},_renderDashedStroke:function(c){var b=-this.width/2,d=-this.height/
2,f=this.width,e=this.height;c.beginPath();a.util.drawDashedLine(c,b,d,b+f,d,this.strokeDashArray);a.util.drawDashedLine(c,b+f,d,b+f,d+e,this.strokeDashArray);a.util.drawDashedLine(c,b+f,d+e,b,d+e,this.strokeDashArray);a.util.drawDashedLine(c,b,d+e,b,d,this.strokeDashArray);c.closePath()},_normalizeLeftTopProperties:function(a){"left"in a&&this.set("left",a.left+this.getWidth()/2);this.set("x",a.left||0);"top"in a&&this.set("top",a.top+this.getHeight()/2);this.set("y",a.top||0);return this},toObject:function(a){a=
d(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),
a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=function(c,b){if(!c)return null;var e=a.parseAttributes(c,a.Rect.ATTRIBUTE_NAMES);e.left=e.left||0;e.top=e.top||0;var f=new a.Rect(d(b?a.util.object.clone(b):{},e));f._normalizeLeftTopProperties(e);return f},a.Rect.fromObject=function(c){return new a.Rect(c)})})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.toFixed;a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,initialize:function(a,b,d){b=b||{};this.set("points",a);this.callSuper("initialize",b);this._calcDimensions(d)},_calcDimensions:function(c){return a.Polygon.prototype._calcDimensions.call(this,c)},toObject:function(c){return a.Polygon.prototype.toObject.call(this,c)},toSVG:function(a){for(var b=[],e=this._createBaseSVGMarkup(),
f=0,h=this.points.length;f<h;f++)b.push(d(this.points[f].x,2),",",d(this.points[f].y,2)," ");e.push("<polyline ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(e.join("")):e.join("")},_render:function(a){var b;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var d=0,f=this.points.length;d<f;d++)b=this.points[d],a.lineTo(b.x,b.y);this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(c){var b,d;c.beginPath();
for(var f=0,e=this.points.length;f<e;f++)b=this.points[f],d=this.points[f+1]||b,a.util.drawDashedLine(c,b.x,b.y,d.x,d.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElement=function(c,b){if(!c)return null;b||(b={});var d=a.parsePointsAttribute(c.getAttribute("points")),f=a.parseAttributes(c,a.Polyline.ATTRIBUTE_NAMES);"transformMatrix"in f||a.util.normalizePoints(d,b);return new a.Polyline(d,
a.util.object.extend(f,b),!0)},a.Polyline.fromObject=function(c){return new a.Polyline(c.points,c,!0)})})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,g=a.util.toFixed;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Object,{type:"polygon",points:null,initialize:function(a,b,c){b=b||{};this.points=a;this.callSuper("initialize",b);this._calcDimensions(c)},_calcDimensions:function(a){var d=this.points,e=c(d,"x"),g=c(d,"y"),m=b(d,"x"),d=b(d,"y");this.width=m-e||1;this.height=d-g||1;this.minX=e;this.minY=g;if(!a){var n=
this.width/2+this.minX,p=this.height/2+this.minY;this.points.forEach(function(a){a.x-=n;a.y-=p},this)}},toObject:function(a){return d(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.points.length;d<e;d++)b.push(g(this.points[d].x,2),",",g(this.points[d].y,2)," ");c.push("<polygon ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(c.join("")):c.join("")},
_render:function(a){var b;a.beginPath();a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity;a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;c<d;c++)b=this.points[c],a.lineTo(b.x,b.y);this._renderFill(a);if(this.stroke||this.strokeDashArray)a.closePath(),this._renderStroke(a)},_renderDashedStroke:function(b){var c,d;b.beginPath();for(var e=0,g=this.points.length;e<g;e++)c=this.points[e],d=this.points[e+1]||this.points[0],a.util.drawDashedLine(b,c.x,c.y,d.x,
d.y,this.strokeDashArray);b.closePath()},complexity:function(){return this.points.length}}),a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=function(b,c){if(!b)return null;c||(c={});var e=a.parsePointsAttribute(b.getAttribute("points")),g=a.parseAttributes(b,a.Polygon.ATTRIBUTE_NAMES);"transformMatrix"in g||a.util.normalizePoints(e,c);return new a.Polygon(e,d(g,c),!0)},a.Polygon.fromObject=function(b){return new a.Polygon(b.points,b,!0)})})("undefined"!==typeof exports?
exports:this);
(function(e){function a(a){return"H"===a[0]?a[1]:a[a.length-2]}function d(a){return"V"===a[0]?a[1]:a[a.length-1]}var c=e.fabric||(e.fabric={}),b=c.util.array.min,g=c.util.array.max,f=c.util.object.extend,h=Object.prototype.toString,l=c.util.drawArc,k={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},m={m:"l",M:"L"};c.Path?c.warn("fabric.Path is already defined"):(c.Path=c.util.createClass(c.Object,{type:"path",path:null,initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");var c=
"[object Array]"===h.call(a);if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))c||(this.path=this._parsePath()),this._initializePath(b),b.sourcePath&&this.setSourcePath(b.sourcePath)},_initializePath:function(a){var b="width"in a&&null!=a.width,c="height"in a&&null!=a.width,d="left"in a,e="top"in a,g=d?this.left:0,h=e?this.top:0;b&&c?(e||(this.top=this.height/2),d||(this.left=this.width/2)):(f(this,this._parseDimensions()),b&&(this.width=a.width),c&&(this.height=a.height));this.pathOffset=
this.pathOffset||this._calculatePathOffset(g,h)},_calculatePathOffset:function(a,b){return{x:this.left-a-this.width/2,y:this.top-b-this.height/2}},_render:function(a,b){var c,d=null,f=0,e=0,g=0,h=0,k=0,m=0,u,A,D,B,w=-(this.width/2+this.pathOffset.x),E=-(this.height/2+this.pathOffset.y);b&&(w+=this.width/2,E+=this.height/2);for(var H=0,G=this.path.length;H<G;++H){c=this.path[H];switch(c[0]){case "l":g+=c[1];h+=c[2];a.lineTo(g+w,h+E);break;case "L":g=c[1];h=c[2];a.lineTo(g+w,h+E);break;case "h":g+=
c[1];a.lineTo(g+w,h+E);break;case "H":g=c[1];a.lineTo(g+w,h+E);break;case "v":h+=c[1];a.lineTo(g+w,h+E);break;case "V":h=c[1];a.lineTo(g+w,h+E);break;case "m":g+=c[1];h+=c[2];f=g;e=h;a.moveTo(g+w,h+E);break;case "M":g=c[1];h=c[2];f=g;e=h;a.moveTo(g+w,h+E);break;case "c":u=g+c[5];A=h+c[6];k=g+c[3];m=h+c[4];a.bezierCurveTo(g+c[1]+w,h+c[2]+E,k+w,m+E,u+w,A+E);g=u;h=A;break;case "C":g=c[5];h=c[6];k=c[3];m=c[4];a.bezierCurveTo(c[1]+w,c[2]+E,k+w,m+E,g+w,h+E);break;case "s":u=g+c[3];A=h+c[4];k=k?2*g-k:g;
m=m?2*h-m:h;a.bezierCurveTo(k+w,m+E,g+c[1]+w,h+c[2]+E,u+w,A+E);k=g+c[1];m=h+c[2];g=u;h=A;break;case "S":u=c[3];A=c[4];k=2*g-k;m=2*h-m;a.bezierCurveTo(k+w,m+E,c[1]+w,c[2]+E,u+w,A+E);g=u;h=A;k=c[1];m=c[2];break;case "q":u=g+c[3];A=h+c[4];k=g+c[1];m=h+c[2];a.quadraticCurveTo(k+w,m+E,u+w,A+E);g=u;h=A;break;case "Q":u=c[3];A=c[4];a.quadraticCurveTo(c[1]+w,c[2]+E,u+w,A+E);g=u;h=A;k=c[1];m=c[2];break;case "t":u=g+c[1];A=h+c[2];null===d[0].match(/[QqTt]/)?(k=g,m=h):"t"===d[0]?(k=2*g-D,m=2*h-B):"q"===d[0]&&
(k=2*g-k,m=2*h-m);D=k;B=m;a.quadraticCurveTo(k+w,m+E,u+w,A+E);g=u;h=A;k=g+c[1];m=h+c[2];break;case "T":u=c[1];A=c[2];k=2*g-k;m=2*h-m;a.quadraticCurveTo(k+w,m+E,u+w,A+E);g=u;h=A;break;case "a":l(a,g+w,h+E,[c[1],c[2],c[3],c[4],c[5],c[6]+g+w,c[7]+h+E]);g+=c[6];h+=c[7];break;case "A":l(a,g+w,h+E,[c[1],c[2],c[3],c[4],c[5],c[6]+w,c[7]+E]);g=c[6];h=c[7];break;case "z":case "Z":g=f,h=e,a.closePath()}d=c}},render:function(a,b){if(this.visible){a.save();b&&a.translate(-this.width/2,-this.height/2);var d=this.transformMatrix;
d&&a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);b||this.transform(a);this._setStrokeStyles(a);this._setFillStyles(a);this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);a.beginPath();a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity;this._render(a,b);this._renderFill(a);this._renderStroke(a);this.clipTo&&a.restore();this._removeShadow(a);a.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=
f(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(a.sourcePath=this.sourcePath);this.transformMatrix&&(a.transformMatrix=this.transformMatrix);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,f=this.path.length;d<f;d++)b.push(this.path[d].join(" "));b=b.join(" ");c.push('<g transform="',
this.group?"":this.getSvgTransform(),'">',"<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,d,f=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,e,g=0,h=this.path.length;g<h;g++){c=this.path[g];e=c.slice(1).trim();for(b.length=0;d=f.exec(e);)b.push(d[0]);c=[c.charAt(0)];
e=0;for(var l=b.length;e<l;e++)d=parseFloat(b[e]),isNaN(d)||c.push(d);d=c[0];e=k[d.toLowerCase()];l=m[d]||d;if(c.length-1>e)for(var v=1,u=c.length;v<u;v+=e)a.push([d].concat(c.slice(v,v+e))),d=l;else a.push(c)}return a},_parseDimensions:function(){var a=[],c=[],d={};this.path.forEach(function(b,f){this._getCoordsFromCommand(b,f,a,c,d)},this);var f=b(a),e=b(c),h=g(a),l=g(c),h=h-f,l=l-e;return{left:this.left+(f+h/2),top:this.top+(e+l/2),width:h,height:l}},_getCoordsFromCommand:function(b,c,f,e,g){var h=
!1;"H"!==b[0]&&(g.x=0===c?a(b):a(this.path[c-1]));"V"!==b[0]&&(g.y=0===c?d(b):d(this.path[c-1]));b[0]===b[0].toLowerCase()&&(h=!0);b=this._getXY(b,h,g);c=parseInt(b.x,10);isNaN(c)||f.push(c);c=parseInt(b.y,10);isNaN(c)||e.push(c)},_getXY:function(b,c,f){var e=c?f.x+a(b):"V"===b[0]?f.x:a(b);b=c?f.y+d(b):"H"===b[0]?f.y:d(b);return{x:e,y:b}}}),c.Path.fromObject=function(a,b){"string"===typeof a.path?c.loadSVGFromURL(a.path,function(d){d=d[0];var f=a.path;delete a.path;c.util.object.extend(d,a);d.setSourcePath(f);
b(d)}):b(new c.Path(a.path,a))},c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(a,b,d){a=c.parseAttributes(a,c.Path.ATTRIBUTE_NAMES);b&&b(new c.Path(a.d,f(a,d)))},c.Path.async=!0)})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend,c=a.util.array.invoke,b=a.Object.prototype.toObject;a.PathGroup?a.warn("fabric.PathGroup is already defined"):(a.PathGroup=a.util.createClass(a.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(b);b.widthAttr&&(this.scaleX=b.widthAttr/b.width);b.heightAttr&&(this.scaleY=b.heightAttr/b.height);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},
render:function(b){if(this.visible){b.save();var c=this.transformMatrix;c&&b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this.transform(b);this._setShadow(b);this.clipTo&&a.util.clipContext(this,b);for(var c=0,d=this.paths.length;c<d;++c)this.paths[c].render(b,!0);this.clipTo&&b.restore();this._removeShadow(b);b.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){a=d(b.call(this,
a),{paths:c(this.getObjects(),"toObject",a)});this.sourcePath&&(a.sourcePath=this.sourcePath);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){for(var b=this.getObjects(),c=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],d=0,e=b.length;d<e;d++)c.push(b[d].toSVG(a));c.push("</g>");return a?a(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+
"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),a.PathGroup.fromObject=function(b,c){"string"===typeof b.paths?a.loadSVGFromURL(b.paths,function(d){var e=b.paths;delete b.paths;
d=a.util.groupSVGElements(d,b,e);c(d)}):a.util.enlivenObjects(b.paths,function(d){delete b.paths;c(new a.PathGroup(d,b))})},a.PathGroup.async=!0)})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,g=a.util.array.invoke;if(!a.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();
b&&d(this,b);this._setOpacityIfSame();this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop();a.set({originalLeft:b,originalTop:c,left:b-this.left,top:c-this.top});a.setCoords();a.__origHasControls=a.hasControls;a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();a&&(this._objects.push(a),
a.group=this);this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,
opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var c=this._objects.length;for(this[a]=b;c--;)this._objects[c].set(a,b)}else this[a]=b},toObject:function(a){return d(this.callSuper("toObject",a),{objects:g(this._objects,"toObject",a)})},render:function(b){this.dirty=!1;if(this.visible){b.save();this.clipTo&&a.util.clipContext(this,b);for(var c=0,d=this._objects.length;c<
d;c++)this._renderObject(this._objects[c],b);this.clipTo&&b.restore();b.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;c<d;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){var c=a.hasRotatingPoint;a.visible&&(a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=c)},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_moveFlippedObject:function(a){var b=a.get("originX"),
c=a.get("originY"),d=a.getCenterPoint();a.set({originX:"center",originY:"center",left:d.x,top:d.y});this._toggleFlipping(a);d=a.getPointByOrigin(b,c);a.set({originX:b,originY:c,left:d.x,top:d.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=a.__origHasControls;
delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getLeft(),c=this.getTop(),d=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b+d.left,top:c+d.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),
top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_setOpacityIfSame:function(){var a=
this.getObjects(),b=a[0]?a[0].get("opacity"):1;a.every(function(a){return a.get("opacity")===b})&&(this.opacity=b)},_calcBounds:function(a){for(var b=[],c=[],d,f=0,e=this._objects.length;f<e;++f){d=this._objects[f];d.setCoords();for(var g in d.oCoords)b.push(d.oCoords[g].x),c.push(d.oCoords[g].y)}this.set(this._getBounds(b,c,a))},_getBounds:function(d,f,e){var g=a.util.invertTransform(this.getViewportTransform()),n=a.util.transformPoint(new a.Point(c(d),c(f)),g);d=a.util.transformPoint(new a.Point(b(d),
b(f)),g);f={width:d.x-n.x||0,height:d.y-n.y||0};e||(f.left=(n.x+d.x)/2||0,f.top=(n.y+d.y)/2||0);return f},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">'],c=0,d=this._objects.length;c<d;c++)b.push(this._objects[c].toSVG(a));b.push("</g>");return a?a(b.join("")):b.join("")},get:function(a){if(a in f){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):
this[a]}});a.Group.fromObject=function(b,c){a.util.enlivenObjects(b.objects,function(d){delete b.objects;c&&c(new a.Group(d,b))})};a.Group.async=!0}})("undefined"!==typeof exports?exports:this);
(function(e){var a=fabric.util.object.extend;e.fabric||(e.fabric={});e.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(a,c){c||(c={});this.filters=[];this.callSuper("initialize",c);this._initElement(a,c);this._initConfig(c);c.filters&&(this.filters=c.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(a,c){a!==this._element&&(this.dirty=!0,this.submitBoundsAsDirtyRect());
this._originalElement=this._element=a;this._initConfig();0!==this.filters.length&&this.applyFilters(c);return this},setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},render:function(a,c){this.dirty=!1;if(this.visible){a.save();var b=this.transformMatrix,e=this.group&&"path-group"===this.group.type;e&&a.translate(-this.group.width/2,-this.group.height/2);b&&a.transform(b[0],
b[1],b[2],b[3],b[4],b[5]);c||this.transform(a);e&&a.translate(this.width/2,this.height/2);this._setShadow(a);this.clipTo&&fabric.util.clipContext(this,a);this._render(a);this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a);this._renderStroke(a);this.clipTo&&a.restore();a.restore()}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(a){var c=-this.width/
2,b=-this.height/2,e=this.width,f=this.height;a.save();this._setStrokeStyles(a);a.beginPath();fabric.util.drawDashedLine(a,c,b,c+e,b,this.strokeDashArray);fabric.util.drawDashedLine(a,c+e,b,c+e,b+f,this.strokeDashArray);fabric.util.drawDashedLine(a,c+e,b+f,c,b+f,this.strokeDashArray);fabric.util.drawDashedLine(a,c,b+f,c,b,this.strokeDashArray);a.closePath();a.restore()},toObject:function(d){return a(this.callSuper("toObject",d),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(a){return a&&
a.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(a){var c=[];c.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>");if(this.stroke||this.strokeDashArray){var b=this.fill;this.fill=null;c.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" width="',this.width,
'" height="',this.height,'" style="',this.getSvgStyles(),'"/>');this.fill=b}c.push("</g>");return a?a(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,c){this.constructor.fromObject(this.toObject(c),a)},applyFilters:function(a){if(this._originalElement)if(0===this.filters.length)this._element=this._originalElement,a&&a();else{var c=this._originalElement,
b=fabric.util.createCanvasElement(),e=fabric.util.createImage(),f=this;b.width=c.width;b.height=c.height;b.getContext("2d").drawImage(c,0,0,c.width,c.height);this.filters.forEach(function(a){a&&a.applyTo(b)});e.width=c.width;e.height=c.height;fabric.isLikelyNode?(e.src=b.toBuffer(void 0,fabric.Image.pngCompression),f._element=e,a&&a()):(e.onload=function(){f._element=e;a&&a();e.onload=b=c=null},e.src=b.toDataURL("image/png"));return this}},_render:function(a){this._element&&a.drawImage(this._element,
-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,c){a.filters&&a.filters.length?
fabric.util.enlivenObjects(a.filters,function(a){c&&c(a)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0;this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,c){fabric.util.loadImage(a.src,function(b){fabric.Image.prototype._initFilters.call(a,
a,function(e){a.filters=e||[];e=new fabric.Image(b,a);c&&c(e)})},null,a.crossOrigin)},fabric.Image.fromURL=function(a,c,b){fabric.util.loadImage(a,function(a){c(new fabric.Image(a,b))},null,b&&b.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(["x","y","width","height","xlink:href"]),fabric.Image.fromElement=function(d,c,b){d=fabric.parseAttributes(d,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(d["xlink:href"],c,a(b?fabric.util.object.clone(b):{},d))},fabric.Image.async=
!0,fabric.Image.pngCompression=1)})("undefined"!==typeof exports?exports:this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.getAngle()%360;return 0<e?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(e){e=e||{};var a=function(){},d=e.onComplete||a,c=e.onChange||a,b=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){b.setAngle(a);
c()},onComplete:function(){b.setCoords();d()},onStart:function(){b.set("active",!1)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){e.straighten();this.renderAll();return this},fxStraightenObject:function(e){e.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Brightness=a.util.createClass(a.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var d=a.data,f=this.brightness,e=0,l=d.length;e<l;e+=4)d[e]+=f,d[e+1]+=f,d[e+2]+=f;b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{brightness:this.brightness})}});
a.Image.filters.Brightness.fromObject=function(c){return new a.Image.filters.Brightness(c)}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Convolute=a.util.createClass(a.Image.filters.BaseFilter,{type:"Convolute",initialize:function(c){c=c||{};this.opaque=c.opaque;this.matrix=c.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=a.util.createCanvasElement().getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,b)},applyTo:function(a){var b=this.matrix,d=a.getContext("2d"),f=d.getImageData(0,0,a.width,a.height);a=Math.round(Math.sqrt(b.length));
for(var e=Math.floor(a/2),l=f.data,k=f.width,f=f.height,m=this._createImageData(k,f),n=m.data,p=this.opaque?1:0,q=0;q<f;q++)for(var t=0;t<k;t++){for(var x=q,s=t,r=4*(q*k+t),C=0,y=0,v=0,u=0,A=0;A<a;A++)for(var D=0;D<a;D++){var B=x+A-e,w=s+D-e;0>B||B>f||0>w||w>k||(B=4*(B*k+w),w=b[A*a+D],C+=l[B]*w,y+=l[B+1]*w,v+=l[B+2]*w,u+=l[B+3]*w)}n[r]=C;n[r+1]=y;n[r+2]=v;n[r+3]=u+p*(255-u)}d.putImageData(m,0,0)},toObject:function(){return d(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});a.Image.filters.Convolute.fromObject=
function(c){return new a.Image.filters.Convolute(c)}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.GradientTransparency=a.util.createClass(a.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var d=a.data,f=this.threshold,e=d.length,l=0,k=d.length;l<k;l+=4)d[l+3]=f+255*(e-l)/e;b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{threshold:this.threshold})}});
a.Image.filters.GradientTransparency.fromObject=function(c){return new a.Image.filters.GradientTransparency(c)}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={});a.Image.filters.Grayscale=a.util.createClass(a.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);for(var b=a.data,e=4*a.width*a.height,f=0,h;f<e;)h=(b[f]+b[f+1]+b[f+2])/3,b[f]=h,b[f+1]=h,b[f+2]=h,f+=4;c.putImageData(a,0,0)}});a.Image.filters.Grayscale.fromObject=function(){return new a.Image.filters.Grayscale}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={});a.Image.filters.Invert=a.util.createClass(a.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,e=b.length,f;for(f=0;f<e;f+=4)b[f]=255-b[f],b[f+1]=255-b[f+1],b[f+2]=255-b[f+2];c.putImageData(a,0,0)}});a.Image.filters.Invert.fromObject=function(){return new a.Image.filters.Invert}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Mask=a.util.createClass(a.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=-1<[0,1,2,3].indexOf(a.channel)?a.channel:0},applyTo:function(c){if(this.mask){var b=c.getContext("2d");c=b.getImageData(0,0,c.width,c.height);var d=c.data,f=this.mask.getElement(),e=a.util.createCanvasElement(),l=this.channel,k=4*c.width*c.height;e.width=f.width;e.height=f.height;e.getContext("2d").drawImage(f,
0,0,f.width,f.height);e=e.getContext("2d").getImageData(0,0,f.width,f.height).data;for(f=0;f<k;f+=4)d[f+3]=e[f+l];b.putImageData(c,0,0)}},toObject:function(){return d(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});a.Image.filters.Mask.fromObject=function(c,b){a.util.loadImage(c.mask.src,function(d){c.mask=new a.Image(d,c.mask);b&&b(new a.Image.filters.Mask(c))})};a.Image.filters.Mask.async=!0})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Noise=a.util.createClass(a.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var d=a.data,f=this.noise,e,l=0,k=d.length;l<k;l+=4)e=(0.5-Math.random())*f,d[l]+=e,d[l+1]+=e,d[l+2]+=e;b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{noise:this.noise})}});a.Image.filters.Noise.fromObject=
function(c){return new a.Image.filters.Noise(c)}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Pixelate=a.util.createClass(a.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var d=a.data,f=a.height,e=a.width,l,k,m,n,p,q,t;for(k=0;k<f;k+=this.blocksize)for(m=0;m<e;m+=this.blocksize){l=4*k*e+4*m;n=d[l];p=d[l+1];q=d[l+2];t=d[l+3];for(var x=k,s=k+this.blocksize;x<s;x++)for(var r=
m,C=m+this.blocksize;r<C;r++)l=4*x*e+4*r,d[l]=n,d[l+1]=p,d[l+2]=q,d[l+3]=t}b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{blocksize:this.blocksize})}});a.Image.filters.Pixelate.fromObject=function(c){return new a.Image.filters.Pixelate(c)}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.RemoveWhite=a.util.createClass(a.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var d=a.data,f=this.distance,e=255-this.threshold,l=Math.abs,k,m,n,p=0,q=d.length;p<q;p+=4)k=d[p],m=d[p+1],n=d[p+2],k>e&&m>e&&n>e&&l(k-m)<f&&l(k-n)<f&&l(m-n)<f&&
(d[p+3]=1);b.putImageData(a,0,0)},toObject:function(){return d(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});a.Image.filters.RemoveWhite.fromObject=function(c){return new a.Image.filters.RemoveWhite(c)}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={});a.Image.filters.Sepia=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,e=b.length,f,h;for(f=0;f<e;f+=4)h=0.3*b[f]+0.59*b[f+1]+0.11*b[f+2],b[f]=h+100,b[f+1]=h+50,b[f+2]=h+255;c.putImageData(a,0,0)}});a.Image.filters.Sepia.fromObject=function(){return new a.Image.filters.Sepia}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={});a.Image.filters.Sepia2=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,e=b.length,f,h,l,k;for(f=0;f<e;f+=4)h=b[f],l=b[f+1],k=b[f+2],b[f]=(0.393*h+0.769*l+0.189*k)/1.351,b[f+1]=(0.349*h+0.686*l+0.168*k)/1.203,b[f+2]=(0.272*h+0.534*l+0.131*k)/2.14;c.putImageData(a,0,0)}});a.Image.filters.Sepia2.fromObject=function(){return new a.Image.filters.Sepia2}})("undefined"!==
typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Tint=a.util.createClass(a.Image.filters.BaseFilter,{type:"Tint",initialize:function(c){c=c||{};this.color=c.color||"#000000";this.opacity="undefined"!==typeof c.opacity?c.opacity:(new a.Color(this.color)).getAlpha()},applyTo:function(c){var b=c.getContext("2d");c=b.getImageData(0,0,c.width,c.height);var d=c.data,f=d.length,e,l,k,m,n,p,q,t;e=(new a.Color(this.color)).getSource();l=e[0]*this.opacity;k=e[1]*this.opacity;
m=e[2]*this.opacity;t=1-this.opacity;for(e=0;e<f;e+=4)n=d[e],p=d[e+1],q=d[e+2],d[e]=l+n*t,d[e+1]=k+p*t,d[e+2]=m+q*t;b.putImageData(c,0,0)},toObject:function(){return d(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});a.Image.filters.Tint.fromObject=function(c){return new a.Image.filters.Tint(c)}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend;a.Image.filters.Multiply=a.util.createClass(a.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{};this.color=a.color||"#000000"},applyTo:function(c){var b=c.getContext("2d");c=b.getImageData(0,0,c.width,c.height);var d=c.data,f=d.length,e,l;l=(new a.Color(this.color)).getSource();for(e=0;e<f;e+=4)d[e]*=l[0]/255,d[e+1]*=l[1]/255,d[e+2]*=l[2]/255;b.putImageData(c,0,0)},toObject:function(){return d(this.callSuper("toObject"),
{color:this.color})}});a.Image.filters.Multiply.fromObject=function(c){return new a.Image.filters.Multiply(c)}})("undefined"!==typeof exports?exports:this);
(function(e){var a=e.fabric||(e.fabric={}),d=a.util.object.extend,c=a.util.object.clone,b=a.util.toFixed,g=a.StaticCanvas.supports("setLineDash");a.Text?a.warn("fabric.Text is already defined"):(e=a.Object.prototype.stateProperties.concat(),e.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,
fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:e,stroke:null,shadow:null,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(){if(!this.__skipDimension){var b=a.util.createCanvasElement();
this._render(b.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){"undefined"===typeof Cufon||!0===this.useNative?this._renderViaNative(a):this._renderViaCufon(a)},_renderViaNative:function(b){var c=this.text.split(this._reNewline);this._setTextStyles(b);this.width=this._getTextWidth(b,c);this.height=this._getTextHeight(b,c);this.clipTo&&a.util.clipContext(this,b);this._renderTextBackground(b,
c);this._translateForTextAlign(b);this._renderText(b,c);"left"!==this.textAlign&&"justify"!==this.textAlign&&b.restore();this._renderTextDecoration(b,c);this.clipTo&&b.restore();this._setBoundaries(b,c);this._totalLineHeight=0},_renderText:function(a,b){a.save();this._setShadow(a);this._setupFillRule(a);this._renderTextFill(a,b);this._renderTextStroke(a,b);this._restoreFillRule(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&
(a.save(),a.translate("center"===this.textAlign?this.width/2:this.width,0))},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,d=b.length;c<d;c++){var e=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(e);this._boundaries.push({height:this.fontSize*this.lineHeight,width:e,left:g})}},_setTextStyles:function(a){this._setFillStyles(a);this._setStrokeStyles(a);a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(a,
b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,d=1,e=b.length;d<e;d++){var g=a.measureText(b[d]).width;g>c&&(c=g)}return c},_renderChars:function(a,b,c,d,e){b[a](c,d,e)},_renderTextLine:function(a,b,c,d,e,g){e-=this.fontSize/4;if("justify"!==this.textAlign)this._renderChars(a,b,c,d,e,g);else{var p=b.measureText(c).width,q=this.width;if(q>p){p=c.split(/\s+/);c=b.measureText(c.replace(/\s+/g,"")).width;for(var q=(q-c)/(p.length-
1),t=c=0,x=p.length;t<x;t++)this._renderChars(a,b,p[t],d+c,e,g),c+=b.measureText(p[t]).width+q}else this._renderChars(a,b,c,d,e,g)}},_getLeftOffset:function(){return a.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a,b){if(this.fill||this._skipFillStrokeCheck){this._boundaries=[];for(var c=0,d=0,e=b.length;d<e;d++){var g=this._getHeightOfLine(a,d,b),c=c+g;this._renderTextLine("fillText",a,b[d],this._getLeftOffset(),this._getTopOffset()+c,d)}}},
_renderTextStroke:function(a,b){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var c=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var d=0,e=b.length;d<e;d++){var n=this._getHeightOfLine(a,d,b),c=c+n;this._renderTextLine("strokeText",a,b[d],this._getLeftOffset(),this._getTopOffset()+c,d)}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*
this.lineHeight},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;for(var c=0,d=b.length;c<d;c++)if(""!==b[c]){var e=this._getLineWidth(a,
b[c]),g=this._getLineLeftOffset(e);a.fillRect(this._getLeftOffset()+g,this._getTopOffset()+c*this.fontSize*this.lineHeight,e,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_getLineWidth:function(a,b){return"justify"===this.textAlign?this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(g){for(var l=0,q=b.length;l<q;l++){var t=e._getLineWidth(a,b[l]),x=
e._getLineLeftOffset(t);a.fillRect(e._getLeftOffset()+x,~~(g+l*e._getHeightOfLine(a,l,b)-d),t,1)}}if(this.textDecoration){var d=this._getTextHeight(a,b)/2,e=this;-1<this.textDecoration.indexOf("underline")&&c(this.fontSize*this.lineHeight);-1<this.textDecoration.indexOf("line-through")&&c(this.fontSize*this.lineHeight-this.fontSize/2);-1<this.textDecoration.indexOf("overline")&&c(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[a.isLikelyNode?this.fontWeight:this.fontStyle,
a.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",a.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.dirty=!1;if(this.visible){a.save();this._transform(a,b);var c=this.transformMatrix,d=this.group&&"path-group"===this.group.type;d&&a.translate(-this.group.width/2,-this.group.height/2);c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);d&&a.translate(this.left,this.top);this._render(a);a.restore()}},toObject:function(a){a=d(this.callSuper("toObject",
a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=[],c=this.text.split(this._reNewline),d=this._getSVGLeftTopOffsets(c),e=this._getSVGTextAndBg(d.lineTop,d.textLeft,c),
c=this._getSVGShadows(d.lineTop,c);d.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;this._wrapSVGTextAndBg(b,e,c,d);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){return{textLeft:-(this.width/2),textTop:this.useNative?this.fontSize-1:this.height/2-a.length*this.fontSize-this._totalLineHeight,lineTop:this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight}},_wrapSVGTextAndBg:function(a,c,d,e){a.push('<g transform="',this.getSvgTransform(),
'">',c.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',b(e.textLeft,2)," ",b(e.textTop,2),')">',d.join(""),c.textSpans.join(""),"</text>","</g>")},_getSVGShadows:function(c,
d){var e=[],g,m,n=1;if(!this.shadow||!this._boundaries)return e;g=0;for(m=d.length;g<m;g++)""!==d[g]?(e.push('<tspan x="',b((this._boundaries&&this._boundaries[g]?this._boundaries[g].left:0)+n+this.shadow.offsetX,2),0===g||this.useNative?'" y':'" dy','="',b(this.useNative?c*g-this.height/2+this.shadow.offsetY:c+(0===g?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",a.util.string.escapeXml(d[g]),"</tspan>"),n=1):n++;return e},_getSVGTextAndBg:function(a,b,c){var d=[],
e=[],g=1;this._setSVGBg(e);for(var p=0,q=c.length;p<q;p++)""!==c[p]?(this._setSVGTextLineText(c[p],p,d,a,g,e),g=1):g++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(e,p,b,a);return{textSpans:d,textBgRects:e}},_setSVGTextLineText:function(c,d,e,g,m){var n=this._boundaries&&this._boundaries[d]?b(this._boundaries[d].left,2):0;e.push('<tspan x="',n,'" ',0===d||this.useNative?"y":"dy",'="',b(this.useNative?g*d-this.height/2:g*m,2),'" ',this._getFillAttributes(this.fill),">",a.util.string.escapeXml(c),
"</tspan>")},_setSVGTextLineBg:function(a,c,d,e){a.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',b(d+this._boundaries[c].left,2),'" y="',b(e*c-this.height/2,2),'" width="',b(this._boundaries[c].width,2),'" height="',b(this._boundaries[c].height,2),'"></rect>')},_setSVGBg:function(a){this.backgroundColor&&this._boundaries&&a.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',b(-this.width/2,2),'" y="',b(-this.height/2,2),'" width="',b(this.width,2),'" height="',
b(this.height,2),'"></rect>')},_getFillAttributes:function(b){var c=b&&"string"===typeof b?new a.Color(b):"";return c&&c.getSource()&&1!==c.getAlpha()?'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+b+'"'},_set:function(a,b){"fontFamily"===a&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+b+"$3"));this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=
a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(b,c){if(!b)return null;var d=a.parseAttributes(b,a.Text.ATTRIBUTE_NAMES);c=a.util.object.extend(c?a.util.object.clone(c):{},d);"dx"in d&&(c.left+=d.dx);"dy"in d&&(c.top+=d.dy);"fontSize"in c||(c.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE);c.originX||(c.originX="left");var d=new a.Text(b.textContent,c),e=0;"left"===d.originX&&
(e=d.getWidth()/2);"right"===d.originX&&(e=-d.getWidth()/2);d.set({left:d.getLeft()+e,top:d.getTop()-d.getHeight()/2});return d},a.Text.fromObject=function(b){return new a.Text(b.text,c(b))},a.util.createAccessors(a.Text))})("undefined"!==typeof exports?exports:this);
fabric.util.object.extend(fabric.Text.prototype,{_renderViaCufon:function(e){var a=Cufon.textOptions||(Cufon.textOptions={});a.left=this.left;a.top=this.top;a.context=e;a.color=this.fill;var d=this._initDummyElementForCufon();this.transform(e);Cufon.replaceElement(d,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.shadow&&this.shadow.toString(),textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,
stroke:this.stroke,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor});this.width=a.width;this.height=a.height;this._totalLineHeight=a.totalLineHeight;this._fontAscent=a.fontAscent;this._boundaries=a.boundaries;this.setCoords()},_initDummyElementForCufon:function(){var e=fabric.document.createElement("pre");fabric.document.createElement("div").appendChild(e);"undefined"===typeof G_vmlCanvasManager?e.innerHTML=this.text:e.innerText=this.text.replace(/\r?\n/gi,
"\r");e.style.fontSize=this.fontSize+"px";e.style.letterSpacing="normal";return e}});
(function(){var e=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},
initialize:function(a,d){this.styles=d?d.styles||{}:{};this.callSuper("initialize",a,d);this.initBehavior();fabric.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var a=this.styles,d;for(d in a)for(var c in a[d])for(var b in a[d][c])return!1;return!0},setSelectionStart:function(a){this.selectionStart!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));
this.selectionStart=a;this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=a)},setSelectionEnd:function(a){this.selectionEnd!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionEnd=a;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=a)},getSelectionStyles:function(a,d){if(2===arguments.length){for(var c=[],b=a;b<d;b++)c.push(this.getSelectionStyles(b));return c}c=this.get2DCursorLocation(a);return this.styles[c.lineIndex]?
this.styles[c.lineIndex][c.charIndex]||{}:{}},setSelectionStyles:function(a){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,a);else for(var d=this.selectionStart;d<this.selectionEnd;d++)this._extendStyles(d,a);return this},_extendStyles:function(a,d){var c=this.get2DCursorLocation(a);this.styles[c.lineIndex]||(this.styles[c.lineIndex]={});this.styles[c.lineIndex][c.charIndex]||(this.styles[c.lineIndex][c.charIndex]={});fabric.util.object.extend(this.styles[c.lineIndex][c.charIndex],
d)},_render:function(a){this.callSuper("_render",a);this.ctx=a;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var a=this.text.split(""),d;this.selectionStart===this.selectionEnd?(d=this._getCursorBoundaries(a,"cursor"),this.renderCursor(d)):(d=this._getCursorBoundaries(a,"selection"),this.renderSelection(a,d))}},get2DCursorLocation:function(a){"undefined"===typeof a&&(a=this.selectionStart);a=this.text.slice(0,a).split(this._reNewline);return{lineIndex:a.length-
1,charIndex:a[a.length-1].length}},getCurrentCharStyle:function(a,d){var c=this.styles[a]&&this.styles[a][0===d?0:d-1];return{fontSize:c&&c.fontSize||this.fontSize,fill:c&&c.fill||this.fill,textBackgroundColor:c&&c.textBackgroundColor||this.textBackgroundColor,textDecoration:c&&c.textDecoration||this.textDecoration,fontFamily:c&&c.fontFamily||this.fontFamily,fontWeight:c&&c.fontWeight||this.fontWeight,fontStyle:c&&c.fontStyle||this.fontStyle,stroke:c&&c.stroke||this.stroke,strokeWidth:c&&c.strokeWidth||
this.strokeWidth}},getCurrentCharFontSize:function(a,d){return this.styles[a]&&this.styles[a][0===d?0:d-1]&&this.styles[a][0===d?0:d-1].fontSize||this.fontSize},getCurrentCharColor:function(a,d){return this.styles[a]&&this.styles[a][0===d?0:d-1]&&this.styles[a][0===d?0:d-1].fill||this.cursorColor},_getCursorBoundaries:function(a,d){var c=this.get2DCursorLocation(),b=this.text.split(this._reNewline),e=Math.round(this._getLeftOffset()),f=-this.height/2,c=this._getCursorBoundariesOffsets(a,d,c,b);return{left:e,
top:f,leftOffset:c.left+c.lineLeft,topOffset:c.top}},_getCursorBoundariesOffsets:function(a,d,c,b){var e=0,f=0,h=0,l=0;c="cursor"===d?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(c.lineIndex,c.charIndex):0;for(var k=0;k<this.selectionStart;k++)"\n"===a[k]?(l=0,c+=this._getCachedLineHeight(f+("cursor"===d?1:0)),f++,h=0):(l+=this._getWidthOfChar(this.ctx,a[k],f,h),h++),e=this._getCachedLineOffset(f,b);this._clearCache();return{top:c,left:l,lineLeft:e}},_clearCache:function(){this.__lineWidths=
{};this.__lineHeights={};this.__lineOffsets={}},_getCachedLineHeight:function(a){return this.__lineHeights[a]||(this.__lineHeights[a]=this._getHeightOfLine(this.ctx,a))},_getCachedLineWidth:function(a,d){return this.__lineWidths[a]||(this.__lineWidths[a]=this._getWidthOfLine(this.ctx,a,d))},_getCachedLineOffset:function(a,d){var c=this._getCachedLineWidth(a,d);return this.__lineOffsets[a]||(this.__lineOffsets[a]=this._getLineLeftOffset(c))},renderCursor:function(a){var d=this.ctx;d.save();var c=this.get2DCursorLocation(),
b=c.lineIndex,c=c.charIndex,e=this.getCurrentCharFontSize(b,c),f=0===b&&0===c?this._getCachedLineOffset(b,this.text.split(this._reNewline)):a.leftOffset;d.fillStyle=this.getCurrentCharColor(b,c);d.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;d.fillRect(a.left+f,a.top+a.topOffset,this.cursorWidth/this.scaleX,e);d.restore()},renderSelection:function(a,d){var c=this.ctx;c.save();c.fillStyle=this.selectionColor;for(var b=this.get2DCursorLocation(this.selectionStart),e=this.get2DCursorLocation(this.selectionEnd),
f=b.lineIndex,h=e.lineIndex,l=this.text.split(this._reNewline),k=f;k<=h;k++){var m=this._getCachedLineOffset(k,l)||0,n=this._getCachedLineHeight(k),p=0;if(k===f)for(var q=0,t=l[k].length;q<t;q++)q>=b.charIndex&&(k!==h||q<e.charIndex)&&(p+=this._getWidthOfChar(c,l[k][q],k,q)),q<b.charIndex&&(m+=this._getWidthOfChar(c,l[k][q],k,q));else if(k>f&&k<h)p+=this._getCachedLineWidth(k,l)||5;else if(k===h)for(q=0,t=e.charIndex;q<t;q++)p+=this._getWidthOfChar(c,l[k][q],k,q);c.fillRect(d.left+m,d.top+d.topOffset,
p,n);d.topOffset+=n}c.restore()},_renderChars:function(a,d,c,b,e,f){if(this.isEmptyStyles())return this._renderCharsFast(a,d,c,b,e);this.skipTextAlign=!0;b-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var h=this.text.split(this._reNewline),l=this._getWidthOfLine(d,f,h),h=this._getHeightOfLine(d,f,h),k=this._getLineLeftOffset(l);c=c.split("");var m,l="";b+=k||0;d.save();for(var k=0,n=c.length;k<=n;k++){m=m||this.getCurrentCharStyle(f,k);var p=this.getCurrentCharStyle(f,
k+1);if(this._hasStyleChanged(m,p)||k===n)this._renderChar(a,d,f,k-1,l,b,e,h),l="",m=p;l+=c[k]}d.restore()},_renderCharsFast:function(a,d,c,b,e){this.skipTextAlign=!1;"fillText"===a&&this.fill&&this.callSuper("_renderChars",a,d,c,b,e);"strokeText"===a&&this.stroke&&this.callSuper("_renderChars",a,d,c,b,e)},_renderChar:function(a,d,c,b,e,f,h,l){var k;if(this.styles&&this.styles[c]&&(k=this.styles[c][b])){var m=k.stroke||this.stroke,n=k.fill||this.fill;d.save();a=this._applyCharStylesGetWidth(d,e,c,
b,k);c=this._getHeightOfChar(d,e,c,b);n&&d.fillText(e,f,h);m&&d.strokeText(e,f,h);this._renderCharDecoration(d,k,f,h,a,l,c);d.restore();d.translate(a,0)}else{if("strokeText"===a&&this.stroke)d[a](e,f,h);if("fillText"===a&&this.fill)d[a](e,f,h);a=this._applyCharStylesGetWidth(d,e,c,b);this._renderCharDecoration(d,null,f,h,a,l);d.translate(d.measureText(e).width,0)}},_hasStyleChanged:function(a,d){return a.fill!==d.fill||a.fontSize!==d.fontSize||a.textBackgroundColor!==d.textBackgroundColor||a.textDecoration!==
d.textDecoration||a.fontFamily!==d.fontFamily||a.fontWeight!==d.fontWeight||a.fontStyle!==d.fontStyle||a.stroke!==d.stroke||a.strokeWidth!==d.strokeWidth},_renderCharDecoration:function(a,d,c,b,e,f,h){var l=d?d.textDecoration||this.textDecoration:this.textDecoration;d=(d?d.fontSize:null)||this.fontSize;l&&(-1<l.indexOf("underline")&&this._renderCharDecorationAtOffset(a,c,b+this.fontSize/this._fontSizeFraction,e,0,this.fontSize/20),-1<l.indexOf("line-through")&&this._renderCharDecorationAtOffset(a,
c,b+this.fontSize/this._fontSizeFraction,e,h/2,d/20),-1<l.indexOf("overline")&&this._renderCharDecorationAtOffset(a,c,b,e,f-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(a,d,c,b,e,f){a.fillRect(d,c-e,b,f)},_renderTextLine:function(a,d,c,b,e,f){e+=this.fontSize/4;this.callSuper("_renderTextLine",a,d,c,b,e,f)},_renderTextDecoration:function(a,d){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",a,d)},_renderTextLinesBackground:function(a,
d){if(this.textBackgroundColor||this.styles){a.save();this.textBackgroundColor&&(a.fillStyle=this.textBackgroundColor);for(var c=0,b=this.fontSize/this._fontSizeFraction,e=0,f=d.length;e<f;e++){var h=this._getHeightOfLine(a,e,d);if(""!==d[e]){var l=this._getWidthOfLine(a,e,d),k=this._getLineLeftOffset(l);this.textBackgroundColor&&(a.fillStyle=this.textBackgroundColor,a.fillRect(this._getLeftOffset()+k,this._getTopOffset()+c+b,l,h));if(this.styles[e])for(var l=0,m=d[e].length;l<m;l++)if(this.styles[e]&&
this.styles[e][l]&&this.styles[e][l].textBackgroundColor){var n=d[e][l];a.fillStyle=this.styles[e][l].textBackgroundColor;a.fillRect(this._getLeftOffset()+k+this._getWidthOfCharsAt(a,e,l,d),this._getTopOffset()+c+b,this._getWidthOfChar(a,n,e,l,d)+1,h)}}c+=h}a.restore()}},_getCacheProp:function(a,d){return a+d.fontFamily+d.fontSize+d.fontWeight+d.fontStyle+d.shadow},_applyCharStylesGetWidth:function(a,d,c,b,g){c=(c=g||this.styles[c]&&this.styles[c][b])?e(c):{};this._applyFontStyles(c);b=this._getCacheProp(d,
c);if(this.isEmptyStyles()&&this._charWidthsCache[b]&&this.caching)return this._charWidthsCache[b];"string"===typeof c.shadow&&(c.shadow=new fabric.Shadow(c.shadow));g=c.fill||this.fill;a.fillStyle=g.toLive?g.toLive(a):g;c.stroke&&(a.strokeStyle=c.stroke&&c.stroke.toLive?c.stroke.toLive(a):c.stroke);a.lineWidth=c.strokeWidth||this.strokeWidth;a.font=this._getFontDeclaration.call(c);this._setShadow.call(c,a);if(!this.caching)return a.measureText(d).width;this._charWidthsCache[b]||(this._charWidthsCache[b]=
a.measureText(d).width);return this._charWidthsCache[b]},_applyFontStyles:function(a){a.fontFamily||(a.fontFamily=this.fontFamily);a.fontSize||(a.fontSize=this.fontSize);a.fontWeight||(a.fontWeight=this.fontWeight);a.fontStyle||(a.fontStyle=this.fontStyle)},_getStyleDeclaration:function(a,d){return this.styles[a]&&this.styles[a][d]?e(this.styles[a][d]):{}},_getWidthOfChar:function(a,d,c,b){var e=this._getStyleDeclaration(c,b);this._applyFontStyles(e);e=this._getCacheProp(d,e);if(this._charWidthsCache[e]&&
this.caching)return this._charWidthsCache[e];if(a)return a.save(),d=this._applyCharStylesGetWidth(a,d,c,b),a.restore(),d},_getHeightOfChar:function(a,d,c,b){return this.styles[c]&&this.styles[c][b]?this.styles[c][b].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(a,d,c,b){b=b||this.text.split(this._reNewline);b=b[d].split("")[c];return this._getWidthOfChar(a,b,d,c)},_getHeightOfCharAt:function(a,d,c,b){b=b||this.text.split(this._reNewline);b=b[d].split("")[c];return this._getHeightOfChar(a,
b,d,c)},_getWidthOfCharsAt:function(a,d,c,b){for(var e=0,f=0;f<c;f++)e+=this._getWidthOfCharAt(a,d,f,b);return e},_getWidthOfLine:function(a,d,c){return this._getWidthOfCharsAt(a,d,c[d].length,c)},_getTextWidth:function(a,d){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",a,d);for(var c=this._getWidthOfLine(a,0,d),b=1,e=d.length;b<e;b++){var f=this._getWidthOfLine(a,b,d);f>c&&(c=f)}return c},_getHeightOfLine:function(a,d,c){c=c||this.text.split(this._reNewline);var b=this._getHeightOfChar(a,
c[d][0],d,0);c=c[d].split("");for(var e=1,f=c.length;e<f;e++){var h=this._getHeightOfChar(a,c[e],d,e);h>b&&(b=h)}return b*this.lineHeight},_getTextHeight:function(a,d){for(var c=0,b=0,e=d.length;b<e;b++)c+=this._getHeightOfLine(a,b,d);return c},_getTopOffset:function(){return fabric.Text.prototype._getTopOffset.call(this)-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset()+
this.fontSize/this._fontSizeFraction,this.width,this.height),a.restore())},toObject:function(a){return fabric.util.object.extend(this.callSuper("toObject",a),{styles:e(this.styles)})}});fabric.IText.fromObject=function(a){return new fabric.IText(a.text,e(a))};fabric.IText.instances=[]})();
(function(){var e=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var a=this;setTimeout(function(){a.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers())})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",
function(){fabric.IText.prototype.exitEditingOnOthers.call()});this.canvas.on("mouse:up",function(){fabric.IText.instances.forEach(function(a){a.__isMousedown=!1})});this.canvas.on("object:selected",function(a){fabric.IText.prototype.exitEditingOnOthers.call(a.target)})},_tick:function(){var a=this;this._abortCursorAnimation||this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){a._onTickComplete()},onChange:function(){a.canvas&&a.canvas.renderAll()},abort:function(){return a._abortCursorAnimation}})},
_onTickComplete:function(){if(!this._abortCursorAnimation){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){a.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){a._tick()},onChange:function(){a.canvas&&a.canvas.renderAll()},abort:function(){return a._abortCursorAnimation}})},100)}},initDelayedCursor:function(a){var d=this,c=a?0:this.cursorDelay;a&&(this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),
this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll());this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){d._abortCursorAnimation=!1;d._tick()},c)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var a=this;setTimeout(function(){a._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=
0;this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(a){var d=0,c=a-1;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)d++,c--;for(;/\S/.test(this.text.charAt(c))&&-1<c;)d++,c--;return a-d},findWordBoundaryRight:function(a){var d=0,c=a;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)d++,
c++;for(;/\S/.test(this.text.charAt(c))&&c<this.text.length;)d++,c++;return a+d},findLineBoundaryLeft:function(a){for(var d=0,c=a-1;!/\n/.test(this.text.charAt(c))&&-1<c;)d++,c--;return a-d},findLineBoundaryRight:function(a){for(var d=0,c=a;!/\n/.test(this.text.charAt(c))&&c<this.text.length;)d++,c++;return a+d},getNumNewLinesInSelectedText:function(){for(var a=0,d=0,c=this.getSelectedText().split(""),b=c.length;d<b;d++)"\n"===c[d]&&a++;return a},searchWordBoundary:function(a,d){for(var c=this._reSpace.test(this.text.charAt(a))?
a-1:a,b=this.text.charAt(c),e=/[ \n\.,;!\?\-]/;!e.test(b)&&0<c&&c<this.text.length;)c+=d,b=this.text.charAt(c);e.test(b)&&"\n"!==b&&(c+=1===d?0:1);return c},selectWord:function(a){var d=this.searchWordBoundary(a,-1);a=this.searchWordBoundary(a,1);this.setSelectionStart(d);this.setSelectionEnd(a);this.initDelayedCursor(!0)},selectLine:function(a){var d=this.findLineBoundaryLeft(a);a=this.findLineBoundaryRight(a);this.setSelectionStart(d);this.setSelectionEnd(a);this.initDelayedCursor(!0)},enterEditing:function(){if(!this.isEditing&&
this.editable)return this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(a){a.selected=!1;a.isEditing&&a.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&
(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,
defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},
exitEditing:function(){this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){var a=this.text.split(this._reNewline),
d;for(d in this.styles)a[d]||delete this.styles[d]},_removeCharsFromTo:function(a,d){for(var c=d;c!==a;){var b=this.get2DCursorLocation(c).charIndex;c--;(b=this.get2DCursorLocation(c).charIndex>b)?this.removeStyleObject(b,c+1):this.removeStyleObject(0===this.get2DCursorLocation(c).charIndex,c)}this.text=this.text.slice(0,a)+this.text.slice(d)},insertChars:function(a){var d="\n"===this.text.slice(this.selectionStart,this.selectionStart+1);this.text=this.text.slice(0,this.selectionStart)+a+this.text.slice(this.selectionEnd);
this.selectionStart===this.selectionEnd&&this.insertStyleObjects(a,d,this.copiedStyles);this.selectionEnd=this.selectionStart+=a.length;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(a,d,c){this.shiftLineStyles(a,1);this.styles[a+1]||(this.styles[a+1]={});var b=this.styles[a][d-1],g={};if(c)g[0]=e(b);else for(var f in this.styles[a])parseInt(f,10)>=d&&(g[parseInt(f,
10)-d]=this.styles[a][f],delete this.styles[a][f]);this.styles[a+1]=g},insertCharStyleObject:function(a,d,c){var b=this.styles[a],g=e(b);0!==d||c||(d=1);for(var f in g){var h=parseInt(f,10);h>=d&&(b[h+1]=g[h])}this.styles[a][d]=c||e(b[d-1])},insertStyleObjects:function(a,d,c){if(!this.isEmptyStyles()){var b=this.get2DCursorLocation(),e=b.lineIndex,b=b.charIndex;this.styles[e]||(this.styles[e]={});"\n"===a?this.insertNewlineStyleObject(e,b,d):c?this._insertStyles(c):this.insertCharStyleObject(e,b)}},
_insertStyles:function(a){for(var d=0,c=a.length;d<c;d++){var b=this.get2DCursorLocation(this.selectionStart+d);this.insertCharStyleObject(b.lineIndex,b.charIndex,a[d])}},shiftLineStyles:function(a,d){var c=e(this.styles),b;for(b in this.styles){var g=parseInt(b,10);g>a&&(this.styles[g+d]=c[g])}},removeStyleObject:function(a,d){var c=this.get2DCursorLocation(d),b=c.lineIndex,c=c.charIndex;if(a){var g=this.text.split(this._reNewline)[b-1],g=g?g.length:0;this.styles[b-1]||(this.styles[b-1]={});for(c in this.styles[b])this.styles[b-
1][parseInt(c,10)+g]=this.styles[b][c];this.shiftLineStyles(b,-1)}else{(b=this.styles[b])&&delete b[c+(this.selectionStart===this.selectionEnd?-1:0)];var f=e(b);for(g in f){var h=parseInt(g,10);h>=c&&0!==h&&(b[h-1]=f[h],delete b[h])}}},insertNewline:function(){this.insertChars("\n")}})})();
fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(e){this.__newClickTime=+new Date;var a=this.canvas.getPointer(e.e);this.isTripleClick(a)?(this.fire("tripleclick",e),this._stopEvent(e.e)):this.isDoubleClick(a)&&(this.fire("dblclick",e),this._stopEvent(e.e));this.__lastLastClickTime=this.__lastClickTime;
this.__lastClickTime=this.__newClickTime;this.__lastPointer=a;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y&&this.__lastIsEditing},isTripleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&
e.preventDefault();e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(e){this.selectWord(this.getSelectionStartFromPointer(e.e))});this.on("tripleclick",function(e){this.selectLine(this.getSelectionStartFromPointer(e.e))})},initMousedownHandler:function(){this.on("mousedown",function(e){var a=this.canvas.getPointer(e.e);
this.__mousedownX=a.x;this.__mousedownY=a.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(e.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},initMousemoveHandler:function(){this.on("mousemove",function(e){this.__isMousedown&&this.isEditing&&(e=this.getSelectionStartFromPointer(e.e),e>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),
this.setSelectionEnd(e)):(this.setSelectionStart(e),this.setSelectionEnd(this.__selectionStartOnMouseDown)))})},_isObjectMoved:function(e){e=this.canvas.getPointer(e);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(e){this.__isMousedown=!1;this._isObjectMoved(e.e)||(this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(e){var a=this.getSelectionStartFromPointer(e);e.shiftKey?
a<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(a)):this.setSelectionEnd(a):(this.setSelectionStart(a),this.setSelectionEnd(a))},_getLocalRotatedPointer:function(e){var a=this.canvas.getPointer(e),a=new fabric.Point(a.x,a.y),d=new fabric.Point(this.left,this.top),a=fabric.util.rotatePoint(a,d,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(e,a)},getSelectionStartFromPointer:function(e){e=this._getLocalRotatedPointer(e);for(var a=this.text.split(this._reNewline),
d=0,c=0,b=0,g=0,f=0,h=a.length;f<h;f++){b+=this._getHeightOfLine(this.ctx,f)*this.scaleY;c=this._getWidthOfLine(this.ctx,f,a);c=this._getLineLeftOffset(c)*this.scaleX;this.flipX&&(a[f]=a[f].split("").reverse().join(""));for(var l=0,k=a[f].length;l<k;l++){var m=a[f][l],d=c,c=c+this._getWidthOfChar(this.ctx,m,f,this.flipX?k-l:l)*this.scaleX;if(b<=e.y||c<=e.x)g++;else return this._getNewSelectionStartFromOffset(e,d,c,g+f,k)}if(e.y<b)return this._getNewSelectionStartFromOffset(e,d,c,g+f,k)}return this.text.length},
_getNewSelectionStartFromOffset:function(e,a,d,c,b){e=c+(d-e.x>e.x-a?0:1);this.flipX&&(e=b-e);e>this.text.length&&(e=this.text.length);return e}});
fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));fabric.util.addListener(this.hiddenTextarea,
"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},
onKeyDown:function(e){if(this.isEditing){if(e.keyCode in this._keysMap)this[this._keysMap[e.keyCode]](e);else if(e.keyCode in this._ctrlKeysMap&&(e.ctrlKey||e.metaKey))this[this._ctrlKeysMap[e.keyCode]](e);else return;e.stopPropagation();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(e){this.selectionStart===this.selectionEnd&&this.moveCursorRight(e);this.removeChars(e)},copy:function(e){var a=this.getSelectedText();(e=this._getClipboardData(e))&&e.setData("text",a);this.copiedText=
a;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(e){var a=null;(a=(e=this._getClipboardData(e))?e.getData("text"):this.copiedText)&&this.insertChars(a)},cut:function(e){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(e))},_getClipboardData:function(e){return e&&(e.clipboardData||fabric.window.clipboardData)},onKeyPress:function(e){!this.isEditing||e.metaKey||e.ctrlKey||e.keyCode in this._keysMap||(this.insertChars(String.fromCharCode(e.which)),
e.stopPropagation())},getDownCursorOffset:function(e,a){var d=a?this.selectionEnd:this.selectionStart,c=this.text.split(this._reNewline),b=this.text.slice(0,d),g=this.text.slice(d),f=b.slice(b.lastIndexOf("\n")+1),b=g.match(/(.*)\n?/)[1],g=(g.match(/.*\n(.*)\n?/)||{})[1]||"",h=this.get2DCursorLocation(d);if(h.lineIndex===c.length-1||e.metaKey)return this.text.length-d;for(var d=this._getWidthOfLine(this.ctx,h.lineIndex,c),l=this._getLineLeftOffset(d),k=h.lineIndex,m=0,n=f.length;m<n;m++)d=f[m],l+=
this._getWidthOfChar(this.ctx,d,k,m);c=this._getIndexOnNextLine(h,g,l,c);return b.length+1+c},_getIndexOnNextLine:function(e,a,d,c){e=e.lineIndex+1;c=this._getWidthOfLine(this.ctx,e,c);var b=this._getLineLeftOffset(c),g=0,f;c=0;for(var h=a.length;c<h;c++){var l=this._getWidthOfChar(this.ctx,a[c],e,c),b=b+l;if(b>d){f=!0;e=b;b=Math.abs(b-l-d);g=Math.abs(e-d)<b?c+1:c;break}}f||(g=a.length);return g},moveCursorDown:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var a=this.getDownCursorOffset(e,
"right"===this._selectionDirection);e.shiftKey?this.moveCursorDownWithShift(a):this.moveCursorDownWithoutShift(a);this.initDelayedCursor()},moveCursorDownWithoutShift:function(e){this._selectionDirection="right";this.selectionStart+=e;this.selectionStart>this.text.length&&(this.selectionStart=this.text.length);this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(e){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?(this.selectionStart+=e,this._selectionDirection=
"left"):(this._selectionDirection="right",this.selectionEnd+=e,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},getUpCursorOffset:function(e,a){var d=a?this.selectionEnd:this.selectionStart,c=this.get2DCursorLocation(d);if(0===c.lineIndex||e.metaKey)return d;var b=this.text.slice(0,d),d=b.slice(b.lastIndexOf("\n")+1),b=(b.match(/\n?(.*)\n.*$/)||{})[1]||"",g=this.text.split(this._reNewline),f;f=this._getWidthOfLine(this.ctx,c.lineIndex,g);for(var h=this._getLineLeftOffset(f),
l=c.lineIndex,k=0,m=d.length;k<m;k++)f=d[k],h+=this._getWidthOfChar(this.ctx,f,l,k);c=this._getIndexOnPrevLine(c,b,h,g);return b.length-c+d.length},_getIndexOnPrevLine:function(e,a,d,c){e=e.lineIndex-1;c=this._getWidthOfLine(this.ctx,e,c);var b=this._getLineLeftOffset(c),g=0,f;c=0;for(var h=a.length;c<h;c++){var l=this._getWidthOfChar(this.ctx,a[c],e,c),b=b+l;if(b>d){f=!0;e=b;b=Math.abs(b-l-d);g=Math.abs(e-d)<b?c:c-1;break}}f||(g=a.length-1);return g},moveCursorUp:function(e){this.abortCursorAnimation();
this._currentCursorOpacity=1;var a=this.getUpCursorOffset(e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorUpWithShift(a):this.moveCursorUpWithoutShift(a);this.initDelayedCursor()},moveCursorUpWithShift:function(e){this.selectionStart!==this.selectionEnd&&"right"===this._selectionDirection?(this.selectionEnd-=e,this._selectionDirection="right"):(this.selectionStart-=e,0>this.selectionStart&&(this.selectionStart=0),this._selectionDirection="left")},moveCursorUpWithoutShift:function(e){this.selectionStart===
this.selectionEnd&&(this.selectionStart-=e);0>this.selectionStart&&(this.selectionStart=0);this.selectionEnd=this.selectionStart;this._selectionDirection="left"},moveCursorLeft:function(e){if(0!==this.selectionStart||0!==this.selectionEnd)this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorLeftWithShift(e):this.moveCursorLeftWithoutShift(e),this.initDelayedCursor()},_move:function(e,a,d){this[a]=e.altKey?this["findWordBoundary"+d](this[a]):e.metaKey?this["findLineBoundary"+
d](this[a]):this[a]+("Left"===d?-1:1)},_moveLeft:function(e,a){this._move(e,a,"Left")},_moveRight:function(e,a){this._move(e,a,"Right")},moveCursorLeftWithoutShift:function(e){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(e,"selectionStart");this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(e){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):(this._selectionDirection="left",
this._moveLeft(e,"selectionStart"),"\n"===this.text.charAt(this.selectionStart)&&this.selectionStart--,0>this.selectionStart&&(this.selectionStart=0))},moveCursorRight:function(e){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorRightWithShift(e):this.moveCursorRightWithoutShift(e),this.initDelayedCursor())},moveCursorRightWithShift:function(e){"left"===this._selectionDirection&&this.selectionStart!==
this.selectionEnd?this._moveRight(e,"selectionStart"):(this._selectionDirection="right",this._moveRight(e,"selectionEnd"),"\n"===this.text.charAt(this.selectionEnd-1)&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(e){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),
this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(e){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(e):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(e){0!==
this.selectionStart&&(e.metaKey?(e=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.selectionStart=e):e.altKey?(e=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.selectionStart=e):(e="\n"===this.text.slice(this.selectionStart-1,this.selectionStart),this.removeStyleObject(e),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)))}});
fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(e,a,d,c,b,g){this.styles[a]?this._setSVGTextLineChars(e,a,d,c,b,g):this.callSuper("_setSVGTextLineText",e,a,d,c,b)},_setSVGTextLineChars:function(e,a,d,c,b,g){c=0===a||this.useNative?"y":"dy";e=e.split("");b=0;for(var f=this._getSVGLineLeftOffset(a),h=this._getSVGLineTopOffset(a),l=this._getHeightOfLine(this.ctx,a),k=0,m=e.length;k<m;k++){var n=this.styles[a][k]||{};d.push(this._createTextCharSpan(e[k],n,f,h,c,b));var p=
this._getWidthOfChar(this.ctx,e[k],a,k);n.textBackgroundColor&&g.push(this._createTextCharBg(n,f,h,l,p,b));b+=p}},_getSVGLineLeftOffset:function(e){return this._boundaries&&this._boundaries[e]?fabric.util.toFixed(this._boundaries[e].left,2):0},_getSVGLineTopOffset:function(e){for(var a=0,d=0;d<=e;d++)a+=this._getHeightOfLine(this.ctx,d);return a-this.height/2},_createTextCharBg:function(e,a,d,c,b,g){return['<rect fill="',e.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+
c,')" x="',a+g,'" y="',d+c,'" width="',b,'" height="',c,'"></rect>'].join("")},_createTextCharSpan:function(e,a,d,c,b,g){var f=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},a));return['<tspan x="',d+g,'" ',b,'="',c,'" ',a.fontFamily?'font-family="'+a.fontFamily.replace(/"/g,"'")+'" ':"",a.fontSize?'font-size="'+a.fontSize+'" ':"",a.fontStyle?'font-style="'+a.fontStyle+'" ':"",a.fontWeight?'font-weight="'+a.fontWeight+'" ':"",a.textDecoration?
'text-decoration="'+a.textDecoration+'" ':"",'style="',f,'">',fabric.util.string.escapeXml(e),"</tspan>"].join("")}});
(function(){function e(a,d,e){var f=c.parse(a);f.port||(f.port=0===f.protocol.indexOf("https:")?443:80);a=(443===f.port?g:b).request({hostname:f.hostname,port:f.port,path:f.path,method:"GET"},function(a){var b="";d&&a.setEncoding(d);a.on("end",function(){e(b)});a.on("data",function(c){200===a.statusCode&&(b+=c)})});a.on("error",function(a){a.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+f.hostname+":"+f.port):fabric.log(a.message)});a.end()}function a(a,b){require("fs").readFile(a,
function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"===typeof document||"undefined"===typeof window){var d=require("xmldom").DOMParser,c=require("url"),b=require("http"),g=require("https"),f=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(b,c,d){function f(a){g.src=new Buffer(a,"binary");g._src=b;c&&c.call(d,g)}var g=new h;b&&(b instanceof Buffer||0===b.indexOf("data"))?(g.src=g._src=b,c&&c.call(d,g)):b&&0!==b.indexOf("http")?a(b,f):b?e(b,"binary",f):c&&c.call(d,
b)};fabric.loadSVGFromURL=function(b,c,d){b=b.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==b.indexOf("http")?a(b,function(a){fabric.loadSVGFromString(a.toString(),c,d)}):e(b,"",function(a){fabric.loadSVGFromString(a,c,d)})};fabric.loadSVGFromString=function(a,b,c){a=(new d).parseFromString(a);fabric.parseSVGDocument(a.documentElement,function(a,c){b&&b(a,c)},c)};fabric.util.getScript=function(a,b){e(a,"",function(a){eval(a);b&&b()})};fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,
function(c){var d=new fabric.Image(c);d._initConfig(a);d._initFilters(a,function(a){d.filters=a||[];b&&b(d)})})};fabric.createCanvasForNode=function(a,b,c,d){d=d||c;var e=fabric.document.createElement("canvas");a=new f(a||600,b||600,d);e.style={};e.width=a.width;e.height=a.height;c=new (fabric.Canvas||fabric.StaticCanvas)(e,c);c.contextContainer=a.getContext("2d");c.nodeCanvas=a;c.Font=f.Font;return c};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};
fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};var l=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a){l.call(this,a);this.nodeCanvas.width=a;return this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var k=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(a){k.call(this,a);this.nodeCanvas.height=a;return this};fabric.Canvas&&
(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}})();
